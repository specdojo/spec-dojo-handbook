# 会計概念データフロー図（現状）

凡例と記号の意味は[cdfd-mermaid-rules.md](cdfd-mermaid-rules.md)を参照してください。

## 会計プロセス概要

| プロセス   | 業務内容                                       | 担当 | 業務が発生するイベント | インプット                       | アウトプット                                    |
| ---------- | ---------------------------------------------- | ---- | ---------------------- | -------------------------------- | ----------------------------------------------- |
| レジ締め   | 売上金とレジ内現金を照合し、差額を確認する。   | 店主 | 閉店した               | 前回レジ締め情報、レジ現金       | 本日レジ締め情報                                |
| 売上記録   | 日次売上を帳簿に記録する。                     | 店主 | レジ締めが終わった     | 本日レジ締め情報                 | 売上台帳                                        |
| 金庫入金   | 日次売上を金庫に保管。                         | 店主 | 売り上げ記録が終わった | レジ現金                         | 本日売上情報、保管金（＝レジ現金 − 釣銭準備金） |
| つけ回収   | つけ払い分の入金を受け取り、つけ帳を更新。     | 店主 | 顧客がつけを払った     | 売上金、未収金情報               | 掛売領収書、掛売金                              |
| 仕入支払い | 問屋や仕入先への支払いを実施。                 | 店主 | 請求書を受領した       | 請求書、請求金額情報             | 支払い金額情報                                  |
| 会計記録   | 月次・年次で売上・仕入・経費をまとめ、帳簿化。 | 店主 | 月末や年末になった     | 月間・年間の売上・仕入・経費情報 | 月次、年次の決算情報                            |

## 日次売上

```mermaid
flowchart LR
  %% プロセス
  レジ締め("レジ締め<br>（担当: 店主）")
  売上記録("売上記録<br>（担当: 店主）")
  金庫入金("金庫入金<br>（担当: 店主）")

  %% イベント
  閉店{{"閉店した"}}
  レジ締め完了{{"レジ締め完了"}}
  売上締め完了{{"売上締め完了"}}

  %% データストア
  レジ記録[(レジ記録)]
  売上台帳[(売上台帳)]

  %% 物理保管
  レジ([レジ])
  金庫([金庫])

  %% レジ締め
  閉店 --> レジ締め
  レジ ==>|レジ現金| レジ締め
  レジ記録 -->|取引記録| レジ締め
  レジ締め -->|レジ締め情報| レジ記録
  レジ締め --> レジ締め完了

  %% 売上記録
  レジ締め完了 --> 売上記録
  レジ締め -->|日次売上情報| 売上記録
  売上記録 -->|販売情報| 売上台帳
  売上記録 --> 売上締め完了 --> 金庫入金

  %% 金庫入金
  レジ ==>|レジ現金| 金庫入金
  金庫入金 ==>|保管金| 金庫
```

## 例外処理：つけ回収

```mermaid
flowchart LR
  %% プロセス
  つけ回収("つけ回収<br>（担当: 店主）")

  %% イベント
  つけ支払{{"顧客がつけを払う"}}

  %% 外部主体
  顧客[顧客]

  %% データストア
  レジ記録[(レジ記録)]
  つけ帳[(つけ帳)]

  %% 物理保管
  レジ([レジ])

  %% つけ回収
  つけ支払 --> つけ回収
  顧客 ==>|現金（つけ回収）| つけ回収
  つけ帳 -->|未収金額| つけ回収
  つけ回収 -->|回収金額| つけ帳
  つけ回収 -->|売上金| レジ記録
  つけ回収 ==>|売上金| レジ
```

## 仕入支払い

```mermaid
flowchart LR
  %% プロセス
  仕入支払い("仕入支払い<br>（担当: 店主）")

  %% イベント
  請求書受領{{"請求書受領"}}

  %% データストア
  支払管理表[(支払管理表)]
  仕入台帳[(仕入台帳)]

  %% 物理保管
  銀行口座([銀行口座])
  仕入先口座([仕入先口座])

  %% 仕入支払い
  請求書受領 --> 仕入支払い
  仕入台帳 -->|請求情報| 仕入支払い
  銀行口座 -->|銀行預金| 仕入支払い
  仕入支払い -->|支払金| 仕入先口座
  仕入支払い -->|支払記録| 支払管理表
```

## 決算

```mermaid
flowchart TB
  %% プロセス
  会計記録("会計記録<br>（担当: 店主）")

  %% イベント
  月次処理{{"月末"}}
  年次処理{{"年末"}}

  %% データストア
  レジ記録[(レジ記録)]
  売上台帳[(売上台帳)]
  つけ帳[(つけ帳)]
  支払管理表[(支払管理表)]
  会計帳簿[(会計帳簿)]
  仕入台帳[(仕入台帳)]

  %% 物理保管
  レジ([レジ])
  金庫([金庫])
  銀行口座([銀行口座])

  %% 会計記録（月次・年次）
  月次処理 --> 会計記録
  年次処理 --> 会計記録
  レジ記録 -->|現金情報| 会計記録
  売上台帳 -->|売上情報| 会計記録
  支払管理表 -->|支払情報| 会計記録
  仕入台帳 -->|仕入情報| 会計記録
  つけ帳 -->|回収情報| 会計記録
  レジ -->|現金情報| 会計記録
  金庫 -->|保管金情報| 会計記録
  銀行口座 -->|銀行預金情報| 会計記録
  会計記録 -->|会計情報| 会計帳簿
```
