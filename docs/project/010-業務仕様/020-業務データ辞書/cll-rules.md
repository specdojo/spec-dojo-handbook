# 分類（Classification）作成ルール

業務上の分類（カテゴリ、種別、区分など）を一覧で整理するための標準ルールです。
分類は業務目的に応じて **業務分類（固定）／コード表（システム分類）／動的分類（ユーザー定義）** の3種類に分けて管理します。

分類は業務データ辞書（BDD）の enum や画面の選択肢、集計軸として重要な役割を持つため、ここでのルールは他仕様（BDD／ステータス／用語集）と一貫させることを目的とします。

## 0. 概要

分類（Classification）とは、**業務データを意味的にグループ化する構造**である。

分類は以下の 3 種類に分類される：

### 1. **業務分類（Business Classification）**

- 業務ロジックに基づいて固定的に存在する分類
- 例：商品区分、顧客種別、売上種別
- 値は少数で変動しないことが多い
- システム依存性は低い

### 2. **コード表（Code List / System Code List）**

- システムで使用されるコード値の一覧
- 都道府県コード、支払方法コード、税種別コードなど
- 多くの場合 **マスターテーブルとして保持する**
- BDD の enum と密接に対応

### 3. **動的分類（Dynamic Classification）**

- ユーザーが自由に作成・編集・削除できる分類
- タグ、ラベル、フォルダ分類など
- **BDD の enum にしてはいけない**
- システムテーブルで管理し、BDD では string または reference とする

## 1. メタデータ

分類一覧を1つの YAML ドキュメントとして管理する場合、以下のメタデータを用いる。

| 項目       | 説明                             | 必須 |
| ---------- | -------------------------------- | ---- |
| id         | 分類一覧ID（例：cls-xxx-xxxx）   | ○    |
| type       | `domain` 固定                    | ○    |
| title      | 分類一覧名                       | ○    |
| status     | `draft` / `ready` / `deprecated` | ○    |
| version    | バージョン                       | 任意 |
| owners     | 担当者                           | 任意 |
| tags       | タグ・分類                       | 任意 |
| supersedes | 置き換え関係（旧仕様→新仕様）    | 任意 |

### 1.1 ID規約

- 分類一覧IDは正規表現 **`^cls-[a-z0-9-]+$`** に合致すること
- `type: domain` は画面やAPI仕様と切り離して管理することを示す

## 2. 記述ルール（共通）

### 2.1 分類名の命名規則

- 日本語の単数形で記載する（例：商品区分、顧客種別）
- 略語のみの記載は禁止
- システム内部名称のみにしない

### 2.2 項目説明

分類の上位情報（BDD と一致する部分）：

| 列名             | 説明                                               |
| ---------------- | -------------------------------------------------- |
| **エンティティ** | 状態が属する業務上の主要対象（例：お金、注文など） |
| **項目**         | 状態を表す項目（フィールド）名                     |
| **種別**         | 「業務分類」「コード表」「動的分類」のいずれか     |
| **説明**         | 分類が何を意味するか                               |
| **例値**         | 任意のサンプル                                     |

### 2.3 値一覧

値を持つ分類では、以下の列を基本とする。

| 列名       | 説明                                        |
| ---------- | ------------------------------------------- |
| **値**     | システム上の識別子。`lower-kebab-case` 推奨 |
| **分類名** | 正式名称。BDD／用語集と整合させる           |
| **表示名** | UI や現場で使用される表示用名称             |
| **説明**   | 値の意味・成立条件など                      |

## 3. 分類の種類別ルール

### 3.1 業務分類（Business Classification）

#### 特徴

- 業務ロジック上必然的に存在する分類
- 値は少数で固定的
- システム実装に強く依存しない

#### BDD との対応

- `type: enum` として記載してよい
- 値が少ない場合は BDD の enum のみにしてもよい

#### ✔ 記述例

| 分類名   | 種別     | 説明                   |
| -------- | -------- | ---------------------- |
| 商品区分 | 業務分類 | 商品の業務上の上位分類 |

値一覧例：

| 値    | 分類目 | 表示名   | 説明       |
| ----- | ------ | -------- | ---------- |
| snack | お菓子 | おやつ   | 食品系商品 |
| toy   | 玩具   | おもちゃ | 玩具類     |

---

### 3.2 コード表（System Code List）

#### 特徴

- システム内で使用される **コード値の一覧**
- 多くの場合 **マスターテーブルとして管理すべき**
- 外部連携や識別子として利用される

#### マスターテーブル化すべき条件

以下のいずれかを満たす：

- 値が多い（10以上）
- 追加・変更・廃止の可能性がある
- 外部システム連携や帳票に必要
- 多言語化が必要
- BDD enum では収まらないメタ情報がある（例：税率、期間）

#### BDD enum で良いケース

- 値が3〜5個以下
- 業務ルールで固定されている
- ラベル変更の可能性が低い

#### コード表の標準列

| 値  | 分類名 | 表示名 | 説明 |
| --- | ------ | ------ | ---- |

---

### 3.3 動的分類（Dynamic Classification）

#### 特徴

- ユーザーが自由に追加・編集・削除可能
- タグ、ラベル、フォルダ分類などに用いられる

#### BDD の enum にしてはいけない

- 値の増減に対応できず仕様が破綻するため

#### BDD での扱い

- type: `string` または `reference` とする

#### 標準列

| 値 | 作成者 | 説明 |

---

## 4. BDD との関係（重要）

| 分類種類 | BDD の扱い                   |
| -------- | ---------------------------- |
| 業務分類 | enum 可能                    |
| コード表 | enum または マスターテーブル |
| 動的分類 | enum 禁止、別テーブルで管理  |

---

## 5. サンプル（商品区分）

### 5.1 メタデータ

```yaml
---
id: cls-product
type: domain
title: 商品区分
version: 0.1.0
status: draft
owners: []
tags: []
supersedes: []
---
```

### 5.2 項目説明

| エンティティ | 項目     | 種別     | 説明                     |
| ------------ | -------- | -------- | ------------------------ |
| 商品         | 商品区分 | 業務分類 | 商品の種類を表す上位分類 |

## 5.3 分類値一覧

| 値    | 分類名 | 表示名   | 説明       |
| ----- | ------ | -------- | ---------- |
| snack | お菓子 | おやつ   | 食品系商品 |
| toy   | 玩具   | おもちゃ | 玩具類     |
