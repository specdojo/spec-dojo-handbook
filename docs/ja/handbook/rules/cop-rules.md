---
id: cop-rules
title: カットオーバー計画 作成ルール
type: rulebook
status: draft
---

Cutover Plan (COP) Documentation Rules

本ドキュメントは、カットオーバー計画（本番切替手順）ドキュメント（`cop-<term>`）を統一形式で記述するためのルールです。
本番切替を分単位で実行できる状態にし、責任分界とロールバックを明確にするための内容を定義します。

## 1. 全体方針

`cop-<term>` は、当日の切替を **分単位で実行可能** にし、判断と責任の所在を明確にするための SSOT とする。

- 当日タイムラインと作業手順を時系列で定義する
- 切替判定ポイント（GO/NO-GO）を明記する
- ロールバック手順を **具体的かつ実行可能** に記述する
- 担当者/連絡系統/エスカレーションを明確にする
- 周知（ユーザ通知/停止告知）の手順を必須で含める

## 2. 位置づけと用語定義（必要に応じて）

`cop-<term>` と他ドキュメントの関係を示します。必要に応じて Mermaid を使用してよい。

## 3. ファイル命名・ID規則

- `id` は `cop-<term>`（kebab-case。例: `cop-cutover-day`）。
- ファイル名は `cop-010-カットオーバー計画-<term>.md` 等、プロジェクト内で一意になるように命名する。
- `<term>` は用語集(GL)の論理名キー（英小文字kebab-case）を用いる（表示名は title / ファイル名で日本語を使用してよい）。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [docs/shared/schemas/spec-frontmatter.schema.yaml](../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目       | 説明                                         | 必須 |
| ---------- | -------------------------------------------- | ---- |
| id         | COP ID（個別: `cop-<term>`）                 | ○    |
| type       | `migration` 固定                             | ○    |
| title      | カットオーバー計画: <対象名>                 | ○    |
| status     | `draft` / `ready` / `deprecated`             | ○    |
| based_on   | 根拠となる仕様ID（ID配列。未指定は `[]` 可） | 任意 |
| supersedes | 置き換え関係（ID配列。未指定は `[]` 可）     | 任意 |

### 4.2. 推奨ルール

- `based_on` には移行判断に直接利用した成果物（例: `mip-overview` / `br-*` / `issue-*`）のみ列挙する
- `based_on` / `supersedes` は ID 配列（未指定は `[]` 可）

## 5. 本文構成（標準テンプレ）

`cop-<term>` は以下の見出し構成を **順序固定** で配置します。

| 番号 | 見出し                       | 必須 |
| ---- | ---------------------------- | ---- |
| 1    | 概要（`<term>`）             | ○    |
| 2    | 当日タイムライン             | ○    |
| 3    | 作業手順チェックリスト       | ○    |
| 4    | 担当者/連絡系統              | ○    |
| 5    | 実施条件（事前完了条件）     | ○    |
| 6    | 切替判定ポイント（GO/NO-GO） | ○    |
| 7    | ロールバック手順             | ○    |
| 8    | 障害時判断・エスカレーション | ○    |
| 9    | 周知（ユーザ通知/停止告知）  | ○    |

## 6. 記述ガイド

### 6.1. 概要（`<term>`）

生成する `cop-<term>` 本文の見出しは **## 1. 概要（`<term>`）**

- 当日の切替対象と目的を 1〜3 行で示す
- `mip-overview` のカットオーバー概要と整合させる

### 6.2. 当日タイムライン

生成する `cop-<term>` 本文の見出しは **## 2. 当日タイムライン**

- 分単位の時刻（相対時刻）で並べる
- 完了条件と判定点を明記する

推奨フォーマット（表）:

| 時刻（相対） | イベント | 完了条件 | 判定点 |
| ------------ | -------- | -------- | ------ |

### 6.3. 作業手順チェックリスト

生成する `cop-<term>` 本文の見出しは **## 3. 作業手順チェックリスト**

- 作業を順序付きで列挙する
- 実施者と証跡（ログ/チェック欄）を含める

推奨フォーマット（表）:

| 手順 | 作業内容 | 実施者 | 証跡 |
| ---- | -------- | ------ | ---- |

### 6.4. 担当者/連絡系統

生成する `cop-<term>` 本文の見出しは **## 4. 担当者/連絡系統**

- 担当者、責務、連絡経路を明記する

推奨フォーマット（表）:

| 役割 | 担当 | 連絡先 | 備考 |
| ---- | ---- | ------ | ---- |

### 6.5. 実施条件（事前完了条件）

生成する `cop-<term>` 本文の見出しは **## 5. 実施条件（事前完了条件）**

- 実施前に完了しているべき条件を列挙する
- 未達の場合の扱い（延期/判断者）を明記する

### 6.6. 切替判定ポイント（GO/NO-GO）

生成する `cop-<term>` 本文の見出しは **## 6. 切替判定ポイント（GO/NO-GO）**

- 判定ポイントと判断基準を列挙する
- 判断主体を明記する

推奨フォーマット（表）:

| 判定点 | 条件 | 判断者 | 失敗時の扱い |
| ------ | ---- | ------ | ------------ |

### 6.7. ロールバック手順

生成する `cop-<term>` 本文の見出しは **## 7. ロールバック手順**

- 発動条件を明記する
- 手順と復旧方針（DNS/接続戻し、投入データ無効化等）を具体的に書く

### 6.8. 障害時判断・エスカレーション

生成する `cop-<term>` 本文の見出しは **## 8. 障害時判断・エスカレーション**

- 障害時の判断フローと連絡経路を明記する
- エスカレーション先と判断基準を明記する

### 6.9. 周知（ユーザ通知/停止告知）

生成する `cop-<term>` 本文の見出しは **## 9. 周知（ユーザ通知/停止告知）**

- 通知対象、通知手段、通知タイミングを明記する
- 周知内容に「停止時間」や「影響範囲」を含める

## 7. 禁止事項

| 禁止事項                                   | 理由                           |
| ------------------------------------------ | ------------------------------ |
| 当日タイムラインが分単位で記載されていない | 実行性が担保できないため       |
| ロールバック条件や手順を省略する           | 失敗時の判断ができないため     |
| 担当者や連絡系統が不明確                   | 判断と責任が曖昧になるため     |
| 周知（ユーザ通知/停止告知）を未記載にする  | 利用者混乱と事故につながるため |

## 8. サンプル（最小）

注：以下はルール文書内の例示です。生成する `cop-<term>` では `## 1...` から始まります。

```yaml
---
id: cop-cutover-day
type: migration
title: カットオーバー計画: 本番切替当日
status: draft
based_on: []
supersedes: []
---
```

### 8.1. 概要（cutover-day）

本番切替当日の作業手順と判定ポイントを定義する。

### 8.2. 当日タイムライン

| 時刻（相対） | イベント                                | 完了条件                | 判定点 |
| ------------ | --------------------------------------- | ----------------------- | ------ |
| T-120m       | 旧システム新規受付停止、ジョブ停止確認  | 受付停止確認/ジョブ停止 | GO1    |
| T-90m        | 最終差分抽出開始、完了ログ確認          | 抽出ログOK              | GO2    |
| T-60m        | 新DB投入開始（run_id=CO-20260401）      | 投入件数/チェックサムOK | GO3    |
| T-15m        | アプリ接続先切替、監視アラート正常確認  | 監視OK                  | GO4    |
| T+0          | 業務利用開始、初回ログイン/受注スモーク | スモークOK              | GO5    |

### 8.3. 作業手順チェックリスト

| 手順 | 作業内容                        | 実施者 | 証跡     |
| ---- | ------------------------------- | ------ | -------- |
| 1    | 旧受付停止とジョブ停止          | 運用   | 作業ログ |
| 2    | 差分抽出と完了ログ確認          | 移行   | 抽出ログ |
| 3    | 新DB投入と件数/チェックサム確認 | 移行   | 投入ログ |
| 4    | 接続先切替と監視確認            | 運用   | 監視ログ |
| 5    | スモーク（ログイン/受注登録）   | 業務   | 画面録画 |

### 8.4. 担当者/連絡系統

| 役割 | 担当 | 連絡先 | 備考         |
| ---- | ---- | ------ | ------------ |
| 運用 | Ops  | #ops   | 監視担当     |
| 移行 | Mig  | #mig   | データ投入   |
| 業務 | Biz  | #biz   | スモーク確認 |

### 8.5. 実施条件（事前完了条件）

- 移行リハーサルが合格している
- 主要バッチの事前停止が完了している

### 8.6. 切替判定ポイント（GO/NO-GO）

| 判定点 | 条件                      | 判断者 | 失敗時の扱い |
| ------ | ------------------------- | ------ | ------------ |
| GO3    | 投入件数/チェックサム一致 | PO     | ロールバック |
| GO4    | 監視アラート正常          | Ops    | ロールバック |

### 8.7. ロールバック手順

- 発動条件: 重大障害 or 残高差異発生
- DNS/接続戻し、投入データ無効化、旧系復帰

### 8.8. 障害時判断・エスカレーション

- エスカレーション: 運用責任者 → PO
- 判断基準: 重大障害の発生

### 8.9. 周知（ユーザ通知/停止告知）

- 通知対象: 全ユーザ
- 通知手段: メール/掲示
- 停止告知: T-120mに実施

## 9. 生成 AI への指示テンプレート

生成 AI に `cop-<term>` を作らせるときの指示テンプレートは `cop-instruction.md` を参照してください。
