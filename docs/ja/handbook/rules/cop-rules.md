---
id: cop-rules
title: カットオーバー計画 作成ルール
type: rulebook
status: draft
---

Cutover Plan (COP) Documentation Rules

本ドキュメントは、カットオーバー計画（本番切替手順）ドキュメント（`cop-index` / `cop-<term>`）を統一形式で記述するためのルールです。
本番切替を分単位で実行できる状態にし、責任分界とロールバックを明確にするための内容を定義します。

## 1. 全体方針

`cop-index`（必要に応じて `cop-<term>`）は、当日の切替を **分単位で実行可能** にし、判断と責任の所在を明確にするための SSOT とする。

- 当日タイムラインと作業手順を時系列で定義する
- 切替判定ポイント（GO/NO-GO）を明記する
- ロールバック手順を **具体的かつ実行可能** に記述する
- 担当者/連絡系統/エスカレーションを明確にする
- 周知（ユーザ通知/停止告知）の手順を必須で含める

運用方針（index/term 分割）:

- 原則 `cop-index` を作成し、カットオーバー計画の入口（SSOT）とする
- `cop-<term>` は、対象が複数（ウェーブ/領域/拠点/システム群）に分かれる、または担当チーム・手順が独立している場合に追加する
- `cop-<term>` を追加する場合でも、全体の前提・共通ルール・判断体系（GO/NO-GOの枠組み）は `cop-index` を正とする
- **「関連ドキュメント」セクションは必須**とし、分冊が無い場合でも `（本書のみ）` を明記して空欄にしない

## 2. 位置づけ

`cop-index` / `cop-<term>` と他ドキュメントの関係を示します。必要に応じて Mermaid を使用してよい。

- `mip-index`：移行の合意・判断のSSOT（成功条件・カットオーバー骨格を含む）
- `dmd-index` / `dmd-<term>`：データ移行の詳細設計（マッピング/変換/検証）
- `mtp-index` / `mtp-<term>`：リハーサル計画・検証設計（観点/手順/証跡）
- **`cop-index` / `cop-<term>`：当日実行の詳細手順（Runbook）**
- `otp-index` / `otp-<term>`：運用切替の詳細（監視設定/運用手順/窓口）

## 3. ファイル命名・ID規則

- `id` は `cop-index` または `cop-<term>`（kebab-case。例: `cop-cutover-day` / `cop-wave1`）。
- ファイル名は `cop-010-カットオーバー計画.md` / `cop-020-カットオーバー計画-<term>.md` 等、プロジェクト内で一意になるように命名する。
- `<term>` は用語集(GL)の論理名キー（英小文字kebab-case）を用いる（表示名は title / ファイル名で日本語を使用してよい）。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [docs/shared/schemas/spec-frontmatter.schema.yaml](../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目       | 説明                                         | 必須 |
| ---------- | -------------------------------------------- | ---- |
| id         | COP ID（`cop-index` または `cop-<term>`）    | ○    |
| type       | `migration` 固定                             | ○    |
| title      | カットオーバー計画: <対象名>                 | ○    |
| status     | `draft` / `ready` / `deprecated`             | ○    |
| based_on   | 根拠となる仕様ID（ID配列。未指定は `[]` 可） | 任意 |
| supersedes | 置き換え関係（ID配列。未指定は `[]` 可）     | 任意 |

### 4.2. 推奨ルール

- `based_on` には切替判断に直接利用した成果物（例: `mip-index` / `mtp-index` / `dmd-*` / `issue-*`）のみ列挙する
- `based_on` / `supersedes` は ID 配列（未指定は `[]` 可）

## 5. 本文構成（標準テンプレ）

`cop-index` / `cop-<term>` は以下の見出し構成を **順序固定** で配置します。

| 番号 | 見出し                       | 必須 |
| ---- | ---------------------------- | ---- |
| 1    | 概要（`index` / `<term>`）   | ○    |
| 2    | 当日タイムライン             | ○    |
| 3    | 作業手順チェックリスト       | ○    |
| 4    | 担当者/連絡系統              | ○    |
| 5    | 実施条件（事前完了条件）     | ○    |
| 6    | 切替判定ポイント（GO/NO-GO） | ○    |
| 7    | ロールバック手順             | ○    |
| 8    | 障害時判断・エスカレーション | ○    |
| 9    | 周知（ユーザ通知/停止告知）  | ○    |
| 10   | 関連ドキュメント             | ○    |

補足:

- `cop-index` は「全体」を扱い、分冊（`cop-<term>`）がある場合は各termへの導線と共通ルールを持つ
- `cop-<term>` は term固有の手順・判定・責務に寄せ、共通方針の重複記載を避ける（必要なら `cop-index` を参照する）
- 「関連ドキュメント」セクションは **必須**（分冊が無い場合も `（本書のみ）` と明記）

## 6. 記述ガイド

### 6.1. 概要（`index` / `<term>`）

生成する本文の見出しは **## 1. 概要（`index` / `<term>`）**

- 当日の切替対象と目的を 1〜3 行で示す
- `mip-index` のカットオーバー概要（骨格/判定点/ロールバック方針）と整合させる
- `cop-<term>` の場合は、対象範囲（何を含み/含まないか）と責務境界を明記する

### 6.2. 当日タイムライン

生成する本文の見出しは **## 2. 当日タイムライン**

- **分単位**の時刻で並べる（相対時刻を推奨）
- 完了条件と判定点（GO1/GO2...）を明記する
- `cop-index` は全体の骨格（主要マイルストーン）を、`cop-<term>` は実作業に必要な粒度を記載してよい

推奨フォーマット（表）:

| 時刻（相対） | イベント | 完了条件 | 判定点 |
| ------------ | -------- | -------- | ------ |

### 6.3. 作業手順チェックリスト

生成する本文の見出しは **## 3. 作業手順チェックリスト**

- 作業を順序付きで列挙する
- 実施者と証跡（ログ/チケット/チェック欄）を含める
- 可能なら「実行コマンド/手順書リンク」を備考に置いてよい（本文に長大なコマンド列を貼らない）

推奨フォーマット（表）:

| 手順 | 作業内容 | 実施者 | 証跡 | 備考 |
| ---- | -------- | ------ | ---- | ---- |

### 6.4. 担当者/連絡系統

生成する本文の見出しは **## 4. 担当者/連絡系統**

- 担当者、責務、連絡経路、エスカレーション先を明記する
- 個人名が出せない場合は「ロール名＋窓口（チャネル/電話/当番表）」で表現する

推奨フォーマット（表）:

| 役割 | 担当 | 連絡先 | 備考 |
| ---- | ---- | ------ | ---- |

### 6.5. 実施条件（事前完了条件）

生成する本文の見出しは **## 5. 実施条件（事前完了条件）**

- 実施前に完了しているべき条件を列挙する（例：リハーサル合格、バックアップ完了、監視準備完了）
- 未達の場合の扱い（延期/代替手順/判断者）を明記する

### 6.6. 切替判定ポイント（GO/NO-GO）

生成する本文の見出しは **## 6. 切替判定ポイント（GO/NO-GO）**

- 判定点、判断基準、判断者を列挙する
- 失敗時の扱いは **ロールバック / 延期（Go-Live中止）/ 代替手順** のいずれかを明記する
- `mip-index` の成功条件・GO/NO-GO最低条件と矛盾させない

推奨フォーマット（表）:

| 判定点 | 条件 | 判断者 | 失敗時の扱い（ロールバック/延期/代替手順） |
| ------ | ---- | ------ | ------------------------------------------ |

### 6.7. ロールバック手順

生成する本文の見出しは **## 7. ロールバック手順**

- 発動条件（どの判定点で何が起きたら）を明記する
- 復旧方針（旧系復帰/接続戻し/投入データ無効化/再切替は行わない等）を明記する
- 作業手順は実行可能な粒度（責務・証跡・完了条件）で書く

### 6.8. 障害時判断・エスカレーション

生成する本文の見出しは **## 8. 障害時判断・エスカレーション**

- 障害時の判断フローと連絡経路を明記する
- エスカレーション先と判断基準（重大度・SLO逸脱・復旧見込み等）を明記する

### 6.9. 周知（ユーザ通知/停止告知）

生成する本文の見出しは **## 9. 周知（ユーザ通知/停止告知）**

- 通知対象、通知手段、通知タイミングを明記する
- 周知内容に「停止時間」「影響範囲」「問い合わせ先」を含める
- 通知の証跡（配信ログ/掲載URL/チケット）を残すこと

### 6.10. 関連ドキュメント（必須）

生成する本文の見出しは **## 10. 関連ドキュメント**

- `cop-index` の場合：各 `cop-<term>` への導線を必ず記載する
- `cop-<term>` の場合：`cop-index` への導線（本体SSOT）を必ず記載する
- 分冊が無い場合でも `（本書のみ）` を明記する

推奨フォーマット（箇条書き）:

- `<doc-id>`：<説明>
- `<doc-id>`：<説明>

## 7. 禁止事項

| 禁止事項                                                      | 理由                               |
| ------------------------------------------------------------- | ---------------------------------- |
| 当日タイムラインが分単位で記載されていない                    | 実行性が担保できないため           |
| ロールバック条件や手順を省略する                              | 失敗時の判断ができないため         |
| 担当者や連絡系統が不明確                                      | 判断と責任が曖昧になるため         |
| 周知（ユーザ通知/停止告知）を未記載にする                     | 利用者混乱と事故につながるため     |
| `cop-<term>` に共通方針を重複記載し、`cop-index` と矛盾させる | SSOTが崩れ、当日参照が割れるため   |
| 「関連ドキュメント」セクションを省略する                      | 導線が失われ、参照先が分散するため |

## 8. サンプル（最小・整合版）

注：以下はルール文書内の例示です。生成する `cop-index` / `cop-<term>` では `## 1...` から始まります。

### 8.1. `cop-index`（全体SSOT・入口）

```yaml
---
id: cop-index
type: migration
title: カットオーバー計画: 全体
status: draft
based_on:
  - mip-index
  - mtp-index
supersedes: []
---
```

#### 8.1.1. 概要（index）

本番切替当日の作業タイムライン、判定点、責任分界、ロールバック方針を定義する。
本書はカットオーバー計画のSSOTであり、term固有の詳細手順は `cop-<term>` に分離する。

#### 8.1.2. 当日タイムライン

| 時刻（相対） | イベント                                | 完了条件            | 判定点 |
| ------------ | --------------------------------------- | ------------------- | ------ |
| T-120m       | 旧系受付停止・ジョブ停止確認            | 受付停止/停止ログOK | GO1    |
| T-90m        | 最終差分抽出                            | 抽出ログOK          | GO2    |
| T-60m        | 新DB投入（run_id=CO-20260401）          | 投入ログOK          | GO3    |
| T-15m        | 接続先切替・監視正常確認                | 監視OK              | GO4    |
| T+0          | 利用開始・初回スモーク（ログイン/受注） | スモークOK          | GO5    |

#### 8.1.3. 作業手順チェックリスト

| 手順 | 作業内容                        | 実施者 | 証跡     | 備考 |
| ---- | ------------------------------- | ------ | -------- | ---- |
| 1    | 旧受付停止とジョブ停止          | 運用   | 作業ログ |      |
| 2    | 差分抽出と完了ログ確認          | 移行   | 抽出ログ |      |
| 3    | 新DB投入と件数/チェックサム確認 | 移行   | 投入ログ |      |
| 4    | 接続先切替と監視確認            | 運用   | 監視ログ |      |
| 5    | スモーク（ログイン/受注登録）   | 業務   | 画面録画 |      |

#### 8.1.4. 担当者/連絡系統

| 役割 | 担当 | 連絡先 | 備考         |
| ---- | ---- | ------ | ------------ |
| 運用 | Ops  | #ops   | 監視担当     |
| 移行 | Mig  | #mig   | データ投入   |
| 業務 | Biz  | #biz   | スモーク確認 |
| PO   | PO   | #po    | 最終判断     |

#### 8.1.5. 実施条件（事前完了条件）

- `mtp-index` に基づく移行リハーサルが合格している
- バックアップ（旧/新）が取得済みである
- 監視・アラートが切替後の接続先に追随できる状態である
  未達の場合は延期（Go-Live中止）を基本とし、判断者はPOとする。

#### 8.1.6. 切替判定ポイント（GO/NO-GO）

| 判定点 | 条件                       | 判断者 | 失敗時の扱い（ロールバック/延期/代替手順） |
| ------ | -------------------------- | ------ | ------------------------------------------ |
| GO1    | 旧系の受付停止が確認できる | Ops    | 延期：旧系で継続                           |
| GO2    | 差分抽出ログOK             | Mig    | 代替手順：再抽出（最大1回）。失敗なら延期  |
| GO3    | 投入ログOK/整合性OK        | PO     | ロールバック：投入データ無効化→旧系継続    |
| GO4    | スモーク/監視OK            | PO     | ロールバック：接続先を旧系に戻す→延期判断  |
| GO5    | 初回業務が完了             | Biz    | 代替手順：限定運用。不可なら延期           |

#### 8.1.7. ロールバック手順

- 発動条件: GO3/GO4で致命的失敗、または重大障害が解消見込みなし
- 復旧方針:
  - GO3失敗: 新DB投入データを run_id 単位で無効化/隔離し、旧系継続（接続切替前のため復帰不要）
  - GO4失敗: 接続先を旧系へ戻す→新系投入データを run_id 単位で無効化/隔離→延期判断

- 証跡: ロールバック実施ログ、接続先戻し確認ログ、無効化対象一覧

#### 8.1.8. 障害時判断・エスカレーション

- エスカレーション: Ops → 移行責任者 → PO
- 判断基準（例）:
  - 重大障害（P1）が未解決
  - 停止許容時間を超過見込み
  - ロールバックに必要な前提（接続戻し/無効化）が満たせない

#### 8.1.9. 周知（ユーザ通知/停止告知）

- 通知対象: 全ユーザ/社内関係者
- 通知手段: メール/掲示/アプリ内通知（該当するもの）
- タイミング:
  - 事前告知: T-7d, T-1d
  - 当日告知: T-120m（受付停止の直前）

- 含める内容: 停止時間、影響範囲、問い合わせ先
- 証跡: 配信ログ、掲載URL、チケット

#### 8.1.10. 関連ドキュメント

- `cop-cutover-day`：本番切替当日の詳細手順（分単位の実行チェックリスト）
- `mtp-index`：移行リハーサル計画（合否基準/判断プロセス）
- `mip-index`：移行計画（成功条件/GO/NO-GO最低条件）
- `dmd-order-data`：データ移行設計（抽出/投入/検証の詳細）

---

### 8.2. `cop-<term>`（個別：例）

```yaml
---
id: cop-cutover-day
type: migration
title: カットオーバー計画: 本番切替当日
status: draft
based_on:
  - cop-index
  - mip-index
  - dmd-order-data
supersedes: []
---
```

#### 8.2.1. 概要（cutover-day）

本番切替当日の実行手順を分単位で定義し、判定点ごとの失敗時対応（ロールバック/延期/代替手順）を実行可能な形で示す。
共通方針・判断体系は `cop-index` を正とし、本書は当日作業の詳細に限定する。

#### 8.2.2. 当日タイムライン

| 時刻（相対） | イベント                                | 完了条件                 | 判定点 |
| ------------ | --------------------------------------- | ------------------------ | ------ |
| T-125m       | 事前周知の最終確認                      | 告知反映確認             |        |
| T-120m       | 旧系受付停止・ジョブ停止確認            | 受付停止/停止ログOK      | GO1    |
| T-95m        | バックアップ最終取得（旧/新）           | バックアップID記録       |        |
| T-90m        | 最終差分抽出                            | 抽出ログOK               | GO2    |
| T-75m        | 差分整合性（チェックサム/件数）事前確認 | 事前検証OK               |        |
| T-60m        | 新DB投入（run_id=CO-20260401）          | 投入ログOK               | GO3    |
| T-35m        | 投入後照合（件数/重要値）               | 照合レポートOK           |        |
| T-15m        | 接続先切替・監視正常確認                | スモークOK/監視OK        | GO4    |
| T-5m         | 周知（利用再開告知）                    | 告知反映確認             |        |
| T+0          | 利用開始・初回スモーク（ログイン/受注） | 初回業務完了（証跡採取） | GO5    |

#### 8.2.3. 作業手順チェックリスト

| 手順 | 作業内容                               | 実施者 | 証跡               | 備考 |
| ---- | -------------------------------------- | ------ | ------------------ | ---- |
| 1    | 旧系受付停止とジョブ停止               | Ops    | 作業ログ           |      |
| 2    | バックアップ最終取得（旧/新）          | Ops    | バックアップID記録 |      |
| 3    | 差分抽出の実行と完了ログ確認           | Mig    | 抽出ログ           |      |
| 4    | 新DB投入の実行（run_id付与）           | Mig    | 投入ログ           |      |
| 5    | 投入後照合（件数/重要値/チェックサム） | Mig    | 照合レポート       |      |
| 6    | 接続先切替（設定反映）                 | Ops    | 設定差分/反映ログ  |      |
| 7    | スモーク（ログイン/受注/請求）         | Biz    | 画面録画/操作ログ  |      |
| 8    | 監視アラート確認                       | Ops    | 監視ログ           |      |

#### 8.2.4. 担当者/連絡系統

| 役割 | 担当  | 連絡先 | 備考                |
| ---- | ----- | ------ | ------------------- |
| 運用 | Ops   | #ops   | 監視・切替          |
| 移行 | Mig   | #mig   | 抽出・投入・照合    |
| 業務 | Biz   | #biz   | スモーク/業務確認   |
| PO   | PO    | #po    | GO/NO-GO最終判断    |
| 連絡 | Comms | #comms | 通知文面/配信・掲示 |

#### 8.2.5. 実施条件（事前完了条件）

- `mtp-index` で定義したリハーサルが合格している
- 当日担当者がオンコール状態で連絡可能である
- バックアップ取得が可能な状態である（容量・権限・手順確認済み）
  未達の場合は原則延期（判断者: PO）。

#### 8.2.6. 切替判定ポイント（GO/NO-GO）

| 判定点 | 条件                            | 判断者 | 失敗時の扱い（ロールバック/延期/代替手順） |
| ------ | ------------------------------- | ------ | ------------------------------------------ |
| GO1    | 受付停止/ジョブ停止が確認できる | Ops    | 延期：旧系で継続                           |
| GO2    | 抽出ログOK                      | Mig    | 代替手順：再抽出（最大1回）。失敗なら延期  |
| GO3    | 投入ログOK/照合OK               | PO     | ロールバック：投入無効化→旧系継続          |
| GO4    | 接続切替後スモーク/監視OK       | PO     | ロールバック：接続戻し→延期判断            |
| GO5    | 初回業務完了                    | Biz    | 代替手順：限定運用。不可なら延期           |

#### 8.2.7. ロールバック手順

- 発動条件:
  - GO3で投入失敗または照合NG（重大）
  - GO4でスモークNGまたは重大アラート多発

- 復旧方針:
  - 接続先を旧系へ戻す（設定差分を戻し、反映ログを採取）
  - 新系投入データは run_id 単位で無効化/隔離（対象一覧を出力して保全）
  - 利用再開は旧系で行い、延期（再スケジュール）を決定する

- 完了条件:
  - 旧系でのログイン/受注スモークが成功
  - 監視が旧系を指し、重大アラートが収束
  - ロールバック証跡（ログ/一覧/判断記録）が保存されている

#### 8.2.8. 障害時判断・エスカレーション

- 連絡順:
  - Ops/Mig → 移行責任者 → PO（最終）

- 判断基準（例）:
  - 停止許容時間内に復旧見込みがない
  - ロールバック作業が成立しない（接続戻し不可、無効化不能等）
  - 重大障害（P1）が解消しない

#### 8.2.9. 周知（ユーザ通知/停止告知）

- 通知対象: 全ユーザ/社内
- 手段: メール/掲示/アプリ内通知（該当するもの）
- タイミング:
  - 事前: T-7d, T-1d
  - 当日停止開始: T-120m
  - 利用再開: T-5m（またはT+0直後）

- 内容: 停止時間、影響範囲、問い合わせ先、延期時の扱い
- 証跡: 配信ログ、掲示URL、チケット

#### 8.2.10. 関連ドキュメント

- `cop-index`：カットオーバー計画のSSOT（共通方針/判断体系/導線）
- `mip-index`：移行計画（成功条件/GO/NO-GO最低条件）
- `mtp-index`：移行リハーサル計画（事前合格条件）
- `dmd-order-data`：データ移行設計（抽出/投入/検証）
- （必要に応じて追加）`otp-index`：運用切替・ハイパーケア（監視/窓口）

## 9. 生成 AI への指示テンプレート

生成 AI に `cop-index` / `cop-<term>` を作らせるときの指示テンプレートは `cop-instruction.md` を参照してください。
