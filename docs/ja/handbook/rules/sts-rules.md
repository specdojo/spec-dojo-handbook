# 総合テスト仕様 − 個別仕様（STS-D）作成ルール

本ドキュメントは、
**総合テスト仕様（STS）を、業務シナリオ／検証対象単位に分解した個別仕様**
を統一形式で記述するための標準ルールです。

STS-D は、

- STS が定義した「何を保証するか」を前提に
- **どの業務シナリオ・利用状況で確認するか**
- **どの観点をそのシナリオで担保するか**

を明確にします。

---

## 0. 位置づけ（必読）

STS-D は **総合テストにおける仕様レベルの最下層**です。

```plaintext
TSP（テスト戦略・方針）
 └ STS（総合テスト仕様）
    └ STS-D（総合テスト仕様・個別）   ← 本書
       └ STD（総合テスト設計）
          └ STD-D（総合テスト設計・個別）
             └ テスト実行・結果
```

| 観点   | STS            | STS-D                        |
| ------ | -------------- | ---------------------------- |
| 粒度   | 全体           | シナリオ単位                 |
| 主語   | システム       | 業務シナリオ                 |
| 役割   | 何を保証するか | このシナリオで何を保証するか |
| ケース | 書かない       | **書かない**                 |

---

## 1. 全体方針

- STS-D は **業務シナリオ単位**で作成します。
- STS-D は **テストケース設計書ではありません**。
- STS-D では次を明確にします：
  - 対象となる業務シナリオ
  - 確認すべき観点（業務・非機能・運用）
  - 成立条件（合格の定義）

- ケース分解・入力値・期待値は **STD / STD-D に委ねます**。

---

## 2. 対象と単位

### 作成単位（原則）

- **業務シナリオ**
- **業務フロー**
- **利用状況（ユースケース）**

例：

- 受注〜出荷（通常）
- 在庫不足時の受注
- 外部連携失敗時の再処理
- 障害復旧後の業務再開

---

## 3. ファイル命名・ID規則

### ファイル名（推奨）

```sh
010-総合テスト仕様-受注〜出荷.md
020-総合テスト仕様-在庫不足対応.md
```

### ID ルール

| 項目   | ルール                                 |
| ------ | -------------------------------------- |
| prefix | `sts-`                                 |
| id     | `sts-order-flow`, `sts-stock-shortage` |

※ **ID は将来にわたり不変**となる論理名を用いる
（用語集の term を推奨）

---

## 4. 推奨 Frontmatter 項目

| 項目       | 説明                                  | 必須     |
| ---------- | ------------------------------------- | -------- |
| id         | STS-D ID（`sts-*`）                   | ○        |
| type       | `test` 固定                           | ○        |
| title      | 総合テスト仕様: <シナリオ名>          | ○        |
| status     | `draft / ready / deprecated`          | ○        |
| part_of    | `sts-main`                            | **必須** |
| based_on   | `bac-*`, `nfr-*`, `sac-*`             | **必須** |
| supersedes | 置換関係                              | 任意     |

---

## 5. 本文構成（標準テンプレ）

STS-D は以下の見出しを **必ずこの順序**で記述します。

1. 概要
2. 対象業務シナリオ
3. シナリオ成立条件
4. テスト観点
5. 非機能・運用観点
6. 合否判定基準
7. 対象外
8. メモ / 将来課題

---

## 6. 記述ガイド詳細

### 6.1 概要

- この STS-D が **どの業務シナリオを対象とするか** を簡潔に記述します。

例：

> 本仕様は、通常の受注から出荷までの業務フローがシステム全体として成立することを確認する。

---

### 6.2 対象業務シナリオ（必須）

- 業務の開始〜終了を **文章で要約**します。
- 画面遷移や操作手順の逐語列挙は禁止。

例：

- 顧客からの注文受付
- 在庫引当
- 出荷指示
- 出荷完了・在庫更新

---

### 6.3 シナリオ成立条件（必須）

「このシナリオが成立したと言える条件」を明文化します。

例：

- 注文が正常に完了している
- 在庫が正しく更新されている
- 出荷実績が参照可能である

---

### 6.4 テスト観点（必須）

STS で定義した観点を **このシナリオに適用した形**で整理します。

| 観点カテゴリ | 観点                         |
| ------------ | ---------------------------- |
| 業務         | フローが中断なく完結する     |
| 業務         | 例外が発生しない場合の正常系 |
| データ       | 注文・在庫・出荷の整合性     |
| 連携         | 外部連携が正常に完了する     |

※ ケース化しないこと

---

### 6.5 非機能・運用観点（必須）

NFR / SAC と **明示的に関連付け**ます。

| 観点     | 対応ID          |
| -------- | --------------- |
| 性能     | nfr-performance |
| 監査     | sac-audit       |
| 可観測性 | sac-monitoring  |

---

### 6.6 合否判定基準（必須）

- このシナリオ単位での **合格条件**を定義します。

例：

- 業務結果が全て期待通りである
- 重大不具合が発生しない
- 非機能要件に違反しない

---

### 6.7 対象外

- 本シナリオでは扱わない例外や境界条件

---

### 6.8 メモ / 将来課題

- 将来追加すべきシナリオ
- 条件未確定事項

---

## 7. 禁止事項

| 禁止事項               | 理由               |
| ---------------------- | ------------------ |
| 個別テストケースの列挙 | 設計レベルの責務   |
| 入力値・期待値の具体化 | STD / STD-D に委譲 |
| UI操作手順の逐語列挙   | UI変更に弱い       |
| 実装依存情報           | 再利用性が下がる   |

---

## 8. サンプル（最小）

```yaml
---
id: sts-order-flow
type: test
title: 総合テスト仕様: 受注〜出荷
status: draft
part_of: [sts-main]
based_on:
  - bac-order
  - nfr-performance
---
```

---

## 9. 生成AI向け指示テンプレート

> - 以下のルールに従って **総合テスト仕様 − 個別仕様（STS-D）** を 1 ファイル作成してください。
> - 対象は **1つの業務シナリオ** としてください。
> - ケース・入力値・期待値は記載せず、観点と成立条件を定義してください。
> - 実装詳細、SQL、UI操作の逐語列挙は禁止です。
