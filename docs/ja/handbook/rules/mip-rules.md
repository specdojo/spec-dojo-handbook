---
id: mip-rules
title: 移行計画 作成ルール
type: rulebook
status: draft
---

Migration Plan (MIP) Documentation Rules

本ドキュメントは、移行計画ドキュメント（`mip-overview`）を統一形式で記述するためのルールです。
移行全体を「1冊で説明できる状態」にし、関係者の合意と実行の基準点となる内容を定義します。

## 1. 全体方針

`mip-overview` は、移行計画の全体像を **運用可能な最小情報** で整理し、合意・実行・判断の基準とする。

- 目的は「移行全体を1冊で説明できる状態」にすること
- 共通方針・前提・スコープ・成功条件を **明確に固定** する
- 詳細な手順や実作業の粒度は、必要に応じて下位ドキュメントや運用手順へ寄せる
- 判断に必要な情報（停止許容時間、許容誤差、GO/NO-GO基準）を必ず含める
- カットオーバーは **概要（骨格）** を必ず含め、分単位の手順は別ドキュメントに分離する

## 2. 位置づけと用語定義（必要に応じて）

`mip-overview` と他ドキュメントの関係を示します。必要に応じて Mermaid による図を使用してよい。

- `mip-overview`：移行の合意・判断のSSOT（本体）
- `cop-*`：当日実行の詳細手順（Runbook）
- `dmd-*`：データ移行の詳細設計（マッピング/変換/検証）
- `mtp-*`：リハーサル計画・検証設計（観点/手順/証跡）
- `opt-*`：運用切替の詳細（監視設定/運用手順/窓口）

## 3. ファイル命名・ID規則

- `id` は `mip-overview` 固定。
- ファイル名は `mip-010-移行計画-概要.md` 等、プロジェクト内で一意になるように命名する。
- `id`（参照用の不変キー）とファイル名（可読性/並び順）は独立であり、ファイル名変更は許容する。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [docs/shared/schemas/spec-frontmatter.schema.yaml](../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目       | 説明                                         | 必須 |
| ---------- | -------------------------------------------- | ---- |
| id         | `mip-overview`（固定）                       | ○    |
| type       | `migration` 固定                             | ○    |
| title      | 移行計画: 概要（`<システム名>`）             | ○    |
| status     | `draft` / `ready` / `deprecated`             | ○    |
| based_on   | 根拠となる仕様ID（ID配列。未指定は `[]` 可） | 任意 |
| supersedes | 置き換え関係（ID配列。未指定は `[]` 可）     | 任意 |

### 4.2. 推奨ルール

- `based_on` には移行判断に直接利用した成果物（例: `br-*` / `nfr-*` / `issue-*`）のみ列挙する
- `based_on` / `supersedes` は ID 配列（未指定は `[]` 可）

## 5. 本文構成（標準テンプレ）

`mip-overview` は以下の見出し構成を **順序固定** で配置します。

| 番号 | 見出し                                                         | 必須 |
| ---- | -------------------------------------------------------------- | ---- |
| 1    | 移行の背景/目的                                                | ○    |
| 2    | 前提・制約                                                     | ○    |
| 3    | 移行方式と期間（方式/フェーズ/タイムライン）                   | ○    |
| 4    | 移行対象一覧（スコープ/非対象）                                | ○    |
| 5    | 成功条件・受入基準                                             | ○    |
| 6    | 体制・役割（GO判断含む）                                       | ○    |
| 7    | 移行リスクと対策                                               | ○    |
| 8    | カットオーバー概要（当日タイムライン/判定点/ロールバック方針） | ○    |
| 9    | 移行後ハイパーケア方針                                         | ○    |

## 6. 記述ガイド

### 6.1. 移行の背景/目的

生成する `mip-overview` 本文の見出しは **## 1. 移行の背景/目的**

- なぜ移行が必要かを 1〜3 行で明確にする
- 対象の範囲と期待する成果を簡潔に示す

### 6.2. 前提・制約

生成する `mip-overview` 本文の見出しは **## 2. 前提・制約**

- 移行の前提（対象環境、停止可能時間帯、使用可能なリソース）を列挙する
- 制約（法務/セキュリティ/契約/外部依存）を明記する

### 6.3. 移行方式と期間（方式/フェーズ/タイムライン）

生成する `mip-overview` 本文の見出しは **## 3. 移行方式と期間（方式/フェーズ/タイムライン）**

- 移行方式（例: 一斉/並行）を明記する
- 主要フェーズと期間（準備/移行/検証/切替/撤退）を時系列で示す

推奨フォーマット（表）:

| フェーズ | 期間 | 目的 | 成果物/完了条件 |
| -------- | ---- | ---- | --------------- |

### 6.4. 移行対象一覧（スコープ/非対象）

生成する `mip-overview` 本文の見出しは **## 4. 移行対象一覧（スコープ/非対象）**

- スコープを **一覧表** で示す
- 以下の観点を含める: 業務/機能/I/F/データ種別/非対象
- 詳細（テーブル/項目/変換ロジック）は書かず、下位ドキュメントへリンクする

推奨フォーマット（表）:

| 区分 | 対象 | 補足 |
| ---- | ---- | ---- |

### 6.5. 成功条件・受入基準

生成する `mip-overview` 本文の見出しは **## 5. 成功条件・受入基準**

- 停止許容時間、許容誤差、完了定義を明記する
- 合否判断に使う測定/証跡の種類と所在（例：照合レポート、CIログ、監査ログ等）を示す
- 測定対象はプロジェクトに合わせて、データ種別（マスタ/トラン）・期間・業務シナリオのうち最低2つ（データ種類＋期間、など）は必ず書く
- GO/NO-GO の最低限の判定条件を箇条書きで明文化する

推奨フォーマット（表）:

| 項目 | 基準 | 測定対象（対象データ/期間/業務） | 測定/証跡 | 判定者 | 失敗時の扱い（ロールバック/延期/代替手順） |
| ---- | ---- | -------------------------------- | --------- | ------ | ------------------------------------------ |

### 6.6. 体制・役割（GO判断含む）

生成する `mip-overview` 本文の見出しは **## 6. 体制・役割（GO判断含む）**

- 体制/責任分担を示す（責任者/実行者/承認者）
- GO/NO-GO の判断主体と判断基準（参照する成功条件）を明記する
- 連絡系統（エスカレーション先）を最小限で示す

推奨フォーマット（表）:

| 役割 | 担当 | 責務 | 連絡/判断 |
| ---- | ---- | ---- | --------- |

### 6.7. 移行リスクと対策

生成する `mip-overview` 本文の見出しは **## 7. 移行リスクと対策**

- リスク、影響、対策、検知方法、発動条件（必要に応じて）を整理する
- 重大リスクは「誰がいつ判断するか」を落とさない

推奨フォーマット（表）:

| リスク | 影響 | 対策 | 検知/判断 |
| ------ | ---- | ---- | --------- |

### 6.8. カットオーバー概要（当日タイムライン/判定点/ロールバック方針）

生成する `mip-overview` 本文の見出しは **## 8. カットオーバー概要（当日タイムライン/判定点/ロールバック方針）**

- 当日の流れを **骨格（マイルストーン）** で示す（分単位の詳細手順は書かない）
- 判定点（GO1/GO2…）と「失敗時の扱い（ロールバック/延期）」を明記する
- ロールバックの **発動条件** と **復旧の方針**（旧系復帰/データ無効化等）を明記する
  - 例：判定点で失敗した場合の扱いは ロールバック / 延期（Go-Live中止）/ 代替手順 のいずれかを明記する
- 詳細Runbook（`cop-*`）がある場合はリンクする

推奨フォーマット（表）:

| 時刻（相対） | イベント | 完了条件 | 判定点 |
| ------------ | -------- | -------- | ------ |

### 6.9. 移行後ハイパーケア方針

生成する `mip-overview` 本文の見出しは **## 9. 移行後ハイパーケア方針**

- 監視期間、体制、対応範囲を明記する
- 問い合わせ窓口とSLA目安があれば記載する
- 旧システムの扱い（参照期間/停止/アーカイブ）を方針レベルで書く

推奨フォーマット（表）:

| 項目 | 方針 |
| ---- | ---- |

## 7. 禁止事項

| 禁止事項                                                          | 理由                                                     |
| ----------------------------------------------------------------- | -------------------------------------------------------- |
| スコープ（対象/非対象）を曖昧に書く                               | 合意形成と実行判断が不能になるため                       |
| 成功条件・受入基準を記載しない                                    | GO判断の基準点がなくなるため                             |
| 体制・役割やGO判断主体を未記載にする                              | 責任が不明確になり判断が遅れるため                       |
| リスクと対策を列挙しない                                          | 失敗時の影響が拡大するため                               |
| カットオーバー概要（判定点/ロールバック方針）を省略する           | 当日判断と失敗時対応が不明確になるため                   |
| ハイパーケア方針を省略する                                        | 移行後の不具合対応が不明確になるため                     |
| テーブル/項目レベルのマッピングや変換ロジックを本書に詳細記載する | 下位ドキュメントと二重管理になり、更新不整合を起こすため |
| 分単位の作業チェックリストや手順書を本書に全面記載する            | Runbookの責務を侵食し、運用時に参照先が割れるため        |

## 8. サンプル（最小）

注：以下はルール文書内の例示です。生成する `mip-overview` では `## 1...` から始まります。

```yaml
---
id: mip-overview
type: migration
title: 移行計画: 概要（example）
status: draft
based_on: []
supersedes: []
---
```

### 8.1. 移行の背景/目的

既存システムの保守限界に伴い、新基盤へ移行するための計画を定義する。

### 8.2. 前提・制約

- 停止は休日深夜帯のみ（最大 6 時間）
- 外部決済は sandbox を使用

### 8.3. 移行方式と期間（方式/フェーズ/タイムライン）

並行移行とし、準備→データ移行→切替→撤退判定の順で実施する。

| フェーズ | 期間       | 目的                 | 成果物/完了条件    |
| -------- | ---------- | -------------------- | ------------------ |
| 準備     | 2026-03    | 手順/環境/権限の準備 | リハーサル実施可能 |
| 移行     | 2026-04-01 | 本番データ移行       | 移行ログOK         |
| 検証     | 2026-04-01 | 整合性検証           | 照合レポートOK     |
| 切替     | 2026-04-01 | 新系へ切替           | スモークOK         |
| 撤退判定 | 2026-04-15 | 旧系撤退判断         | 承認完了           |

### 8.4. 移行対象一覧（スコープ/非対象）

| 区分   | 対象                 | 補足                 |
| ------ | -------------------- | -------------------- |
| 業務   | 受注/請求            | 旧基盤から移行       |
| I/F    | 決済連携             | 切替当日に接続先変更 |
| データ | マスタ/トラン        | 詳細は dmd-\* を参照 |
| 非対象 | 過去アーカイブデータ | 参照のみ             |

### 8.5. 成功条件・受入基準

| 項目         | 基準      | 測定対象（対象データ/期間/業務）              | 測定/証跡              | 判定者     |
| ------------ | --------- | --------------------------------------------- | ---------------------- | ---------- |
| 停止許容時間 | 6時間以内 | カットオーバー当日（全作業）                  | カットオーバー作業ログ | 運用責任者 |
| 件数差異     | 0         | 受注/請求データ（移行対象期間：2024-01-01〜） | 照合レポート           | 業務責任者 |
| 許容誤差     | 0.1%未満  | 売上/売掛集計（移行対象期間：2024-01-01〜）   | 集計照合レポート       | 業務責任者 |

GO/NO-GO（最低条件）:

- 停止許容時間を満たす
- 主要データ照合が全て合格
- 重大障害が未解決でない

### 8.6. 体制・役割（GO判断含む）

| 役割   | 担当               | 責務             | 連絡/判断                    |
| ------ | ------------------ | ---------------- | ---------------------------- |
| GO判断 | プロダクトオーナー | GO/NO-GO決定     | 重大障害は即エスカレーション |
| 実行   | 移行チーム         | データ移行・切替 | 作業ログ記録                 |
| 運用   | 運用チーム         | 監視/一次対応    | SLAに従う                    |

### 8.7. 移行リスクと対策

| リスク       | 影響     | 対策              | 検知/判断        |
| ------------ | -------- | ----------------- | ---------------- |
| データ不整合 | 受注停止 | 検証ジョブの実行  | 件数差分の検知   |
| 切替遅延     | 停止延長 | リハーサル/並列化 | タイムライン遅延 |

### 8.8. カットオーバー概要（当日タイムライン/判定点/ロールバック方針）

| 時刻（相対） | イベント     | 完了条件     | 判定点 | 失敗時の扱い（ロールバック/延期/代替手順）                  |
| ------------ | ------------ | ------------ | ------ | ----------------------------------------------------------- |
| T-120m       | 旧系受付停止 | 停止確認     | GO1    | 延期（Go-Live中止）：旧系で業務継続                         |
| T-90m        | 最終差分抽出 | 抽出ログOK   | GO2    | 代替手順：抽出条件を切替→再抽出（上限1回）。失敗なら延期    |
| T-60m        | 新DB投入     | 投入ログOK   | GO3    | ロールバック：投入データ無効化（run_id単位で隔離）→旧系継続 |
| T-15m        | 接続先切替   | スモークOK   | GO4    | ロールバック：接続先を旧系へ戻す→延期判断（必要なら）       |
| T+0          | 利用開始     | 初回業務完了 | GO5    | 代替手順：限定運用（対象業務を絞って開始）。不可なら延期    |

ロールバック方針（例）:

- **延期（Go-Live中止）**：GO1/GO2で失敗 → 当日切替を中止し、旧系で業務継続（再スケジュール）
- **ロールバック（旧系復帰）**：GO4で失敗 → 接続先を旧系へ戻し、新系投入データは run_id 単位で無効化/隔離
- **代替手順**：GO2で失敗 → 抽出条件を切替して再抽出（最大1回）し、それでも失敗なら延期

### 8.9. 移行後ハイパーケア方針

| 項目       | 方針                             |
| ---------- | -------------------------------- |
| 期間       | 移行後 2 週間                    |
| 体制       | 専用当番（8:00-20:00）           |
| 対応範囲   | 障害一次対応、問い合わせ一次受付 |
| 窓口/SLA   | 30分以内に一次応答（目安）       |
| 旧システム | 3ヶ月参照専用、その後アーカイブ  |

## 9. 生成 AI への指示テンプレート

生成 AI に `mip-overview` を作らせるときの指示テンプレートは `mip-overview-instruction.md` を参照してください。
