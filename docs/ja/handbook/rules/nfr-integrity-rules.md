---
id: nfr-integrity-rules
title: 非機能要件 / 完全性 作成ルール
type: rulebook
status: draft
---

Non-Functional Requirements Integrity Documentation Rules

本ドキュメントは、非機能要件のうち完全性（正確性・整合性・改ざん耐性）を定義する `nfr-integrity` の作成ルールを定義する。
完全性要件は、データと処理結果が正しく追跡可能であることを基準化する。

## 1. 全体方針

- 完全性はデータ整合性、改ざん検知、監査追跡性で定義する。
- 参照整合・重複防止・履歴保証を検証可能な条件で記述する。
- 業務上重要な記録の欠落・不整合を許容しない基準にする。

## 2. 位置づけと用語定義（必要に応じて）

### 2.1. 位置づけ

- `nfr-integrity`：完全性要求の正本
- `nfr-index`：NFR全体の入口
- `sac-*` / `sts-*`：整合性検証の受入・試験仕様
- `adr-*`：例外判断記録

### 2.2. 用語定義

| 用語       | 定義                                             |
| ---------- | ------------------------------------------------ |
| 完全性     | データ・処理結果が正確かつ矛盾なく維持される性質 |
| 整合性違反 | 制約・業務ルールに反する不正状態                 |
| 監査証跡   | 操作履歴を追跡可能にする記録                     |

## 3. ファイル命名・ID規則

- ルールドキュメントIDは `nfr-integrity-rules`。
- 生成対象ドキュメントIDは `nfr-integrity` を推奨する。
- 要件IDは `nfr-int-<連番>` を推奨する。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [shared/schemas/spec-frontmatter.schema.yaml](../../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目    | 説明                                | 必須 |
| ------- | ----------------------------------- | ---- |
| id      | `nfr-integrity`                     | ○    |
| type    | `architecture` など共通スキーマ準拠 | ○    |
| title   | 非機能要件: 完全性                  | ○    |
| status  | `draft` / `ready` / `deprecated`    | ○    |
| part_of | `nfr-index`                         | 任意 |

### 4.2. 推奨ルール

- 改ざん防止・監査要件は運用/監査ポリシーとの整合を取る。

## 5. 本文構成（標準テンプレ）

`nfr-integrity` は以下の見出し構成を **順序固定** で配置する。

| 番号 | 見出し               | 必須 |
| ---- | -------------------- | ---- |
| 1    | 概要（対象・目的）   | ○    |
| 2    | 適用範囲・前提条件   | ○    |
| 3    | 完全性要件一覧       | ○    |
| 4    | 測定・検証方法       | ○    |
| 5    | 関連ドキュメント導線 | ○    |

## 6. 記述ガイド

### 6.1. 概要（対象・目的）

生成する本文の見出しは **## 1. 概要（対象・目的）**

- どの業務データの正確性を担保するかを明記する。

### 6.2. 適用範囲・前提条件

生成する本文の見出しは **## 2. 適用範囲・前提条件**

- 対象データ、整合性境界、例外条件を記述する。

### 6.3. 完全性要件一覧

生成する本文の見出しは **## 3. 完全性要件一覧**

- 表形式（`id` / `内容` / `指標` / `基準` / `備考`）で記述する。
- 指標例：整合性違反件数、監査証跡欠落率。

### 6.4. 測定・検証方法

生成する本文の見出しは **## 4. 測定・検証方法**

- 整合性チェック、監査レビュー、試験で判定する。

### 6.5. 関連ドキュメント導線

生成する本文の見出しは **## 5. 関連ドキュメント導線**

- `sac-*`、`sts-*`、`adr-*`、監査関連文書への導線を記載する。

## 7. 禁止事項

| 禁止事項                           | 理由                     |
| ---------------------------------- | ------------------------ |
| 整合性違反を「原則なし」で済ませる | 監査不能になるため       |
| 改ざん防止要件に検証方法がない     | 実効性が担保できないため |
| 監査証跡の保持基準を省略する       | 追跡不能になるため       |

## 8. サンプル

注：以下はルール文書内の例示です。生成する `nfr-integrity` では `## 1...` から始まります。

```yaml
---
id: nfr-integrity
type: architecture
title: 非機能要件: 完全性
status: draft
part_of: [nfr-index]
based_on: []
supersedes: []
---
```

### 8.1. 概要（対象・目的）（例）

本書は、GCS 基幹システムにおいて完全性（データ正確性・整合性・改ざん耐性）に関する
非機能要件を定義する。
業務上重要なデータ（受注・在庫・会計）の正確性を担保し、監査対応の
追跡可能性を確保することを目的とする。

### 8.2. 適用範囲・前提条件（例）

| 項目           | 内容                                       |
| -------------- | ------------------------------------------ |
| 対象データ     | 受注・在庫・会計トランザクションデータ     |
| 整合性境界     | サブシステム間（受注⇔在庫、在庫⇔会計）     |
| 監査要件       | SOC2 Type II 相当の操作履歴保持            |
| 例外条件       | テスト環境・開発環境のデータは対象外       |
| データ保持期間 | 監査証跡: 7 年、トランザクションログ: 3 年 |

### 8.3. 完全性要件一覧（例）

| id          | 内容                                         | 指標               | 基準     | 備考                          |
| ----------- | -------------------------------------------- | ------------------ | -------- | ----------------------------- |
| nfr-int-001 | 在庫残高データは整合性違反を許容しない       | 整合性違反件数     | 0 件/月  | 日次整合チェック              |
| nfr-int-002 | 監査対象操作は追跡可能であること             | 監査証跡欠落率     | 0%       | who/when/what 必須            |
| nfr-int-003 | 受注・在庫間の数量整合を日次で確認できること | クロス整合チェック | 日次完了 | 不整合時はアラート発報        |
| nfr-int-004 | 金額データの改ざんを検知できること           | 改ざん検知漏れ率   | 0%       | HMAC / デジタル署名           |
| nfr-int-005 | データ変更履歴は変更前後の値を保持すること   | 履歴保持率         | 100%     | before/after 形式             |
| nfr-int-006 | 重複トランザクションを防止すること           | 重複発生件数       | 0 件/月  | 冔等キー（order_id）で排除    |
| nfr-int-007 | 外部連携データの取り込みは検証済みであること | 検証バイパス率     | 0%       | スキーマ検証 + ビジネスルール |

### 8.4. 測定・検証方法（例）

| 要件ID      | 測定方法                                   | 判定タイミング   | 判定者    |
| ----------- | ------------------------------------------ | ---------------- | --------- |
| nfr-int-001 | 日次整合チェックバッチで不整合を検出       | 日次自動実行     | DBA / SRE |
| nfr-int-002 | 監査ログ収集基盤で欠落操作を検知           | リアルタイム監視 | SRE       |
| nfr-int-003 | 受注↔在庫クロスチェックスクリプト         | 日次バッチ完了後 | Ops       |
| nfr-int-004 | 署名検証テストを CI で実行                 | merge 毎         | QA        |
| nfr-int-005 | 履歴テーブルの before/after 網羅率を検査   | 四半期監査       | QA / DBA  |
| nfr-int-006 | 重複トランザクション検知アラートのカウント | リアルタイム監視 | SRE       |
| nfr-int-007 | 外部データ取り込み時の検証ログを確認       | 日次確認         | Ops       |

### 8.5. 関連ドキュメント導線（例）

| 種別         | ドキュメントID   | 目的                         | 備考 |
| ------------ | ---------------- | ---------------------------- | ---- |
| NFR 入口     | nfr-index        | 非機能要件全体の俯瞰         | 必須 |
| 受入条件     | sac-\*           | 完全性要件の合否判定基準     | 必須 |
| システム試験 | sts-\*           | 整合性検証・改ざん検知試験   | 必須 |
| 判断記録     | adr-\*           | 完全性に関する例外判断の追跡 | 必須 |
| 監査文書     | （外部監査基準） | SOC2 等の適合確認            | 任意 |

## 9. 生成 AI への指示テンプレート

生成 AI に `nfr-integrity` を作成させるときの指示テンプレートは [`nfr-integrity-instruction.md`](../instructions/nfr-integrity-instruction.md) を参照してください。
