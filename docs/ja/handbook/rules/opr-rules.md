---
id: opr-rules
title: 運用手順 作成ルール
type: rulebook
status: draft
---

Operations Procedure Runbook (OPR) Documentation Rules

本ドキュメントは、運用手順ドキュメント（`opr-index` / `opr-<term>`）を統一形式で記述するためのルールです。
運用作業を再現可能な手順として定義し、誰が実施しても同じ結果になる状態（属人化防止）を実現するための内容を定義します。

## 1. 全体方針

`opr-index`（必要に応じて `opr-<term>`）は、恒常運用の実行手順と証跡ルールを一元化する SSOT とする。

- 日次/週次/月次運用を再現可能な手順として定義する
- 障害/アラート対応を優先度別に明文化し、初動を標準化する
- 変更作業（設定変更/デプロイ/ロールバック）の統制を明確化する
- バックアップ確認・リストア演習・バッチ再実行を手順化する
- 証跡（ログ/チケット/チェックリスト/実施記録）を必須化する

### 1.1. index / term 分割方針

- 原則 `opr-index` を作成し、運用手順の入口（SSOT）とする
- `opr-<term>` は運用ドメイン（障害対応/監視/バッチ/権限/問い合わせ/変更等）が独立している場合に追加する
- `opr-<term>` を追加する場合でも、共通手順規約（証跡、承認、優先度定義、エスカレーション基準、テンプレ）は `opr-index` を正とする
- `opr-<term>` では、原則として **`opr-index` の差分（具体手順・個別判断）** を記述し、共通規約の重複記載を避ける

## 2. 位置づけと用語定義

### 2.1. 位置づけ（他ドキュメントとの関係）

`opr-index` / `opr-<term>` と他ドキュメントの関係を示します。必要に応じて Mermaid を用いた図を使用してよい。

- `opd-index` / `opd-<term>`：運用方針・統制（あるべき姿・判断基準）
- **`opr-index` / `opr-<term>`：運用手順・Runbook（再現可能な実行手順と証跡）**
  - OPD は「方針と統制（あるべき姿・判断基準）」、OPR は「手順と証跡（再現可能な作業）」を責務とする

### 2.2. 用語定義

| 用語     | 定義                                                                           |
| -------- | ------------------------------------------------------------------------------ |
| 証跡     | 実施結果を第三者が追跡可能にする記録（ログURL/チケットID/チェックリスト/添付） |
| 一次対応 | 影響拡大防止の暫定措置と状況確定（切り分け・通知・暫定復旧）                   |
| 恒久対応 | 根本原因の除去（修正・設定変更・再発防止）                                     |

## 3. ファイル命名・ID規則

- `id` は `opr-index` または `opr-<term>`（kebab-case。例: `opr-incident`）。
- ファイル名はプロジェクト内で一意になるように命名する（日本語可）。
  - 例: `運用手順.md` / `運用手順-障害対応.md`
  - 並び順が必要な場合は接頭辞の番号付与（例: `opr-010-...`）を **任意** で用いてよい
- `<term>` は用語集(GL)の論理名キー（英小文字kebab-case）を用いる（表示名は title / ファイル名で日本語を使用してよい）。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [docs/shared/schemas/spec-frontmatter.schema.yaml](../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目       | 説明                                         | 必須 |
| ---------- | -------------------------------------------- | ---- |
| id         | OPR ID（`opr-index` または `opr-<term>`）    | ○    |
| type       | `operations` 固定                            | ○    |
| title      | 運用手順: <対象名>                           | ○    |
| status     | `draft` / `ready` / `deprecated`             | ○    |
| based_on   | 根拠となる仕様ID（ID配列。未指定は `[]` 可） | 任意 |
| supersedes | 置き換え関係（ID配列。未指定は `[]` 可）     | 任意 |

### 4.2. 推奨ルール

- `based_on` には手順判断に直接利用した成果物（例: `opd-*` / `nfr-*` / `issue-*`）のみ列挙する
- `based_on` / `supersedes` は ID 配列（未指定は `[]` 可）

## 5. 本文構成（標準テンプレ）

`opr-index` / `opr-<term>` は以下の見出し構成を **順序固定** で配置します。

| 番号 | 見出し                                                         | 必須 |
| ---- | -------------------------------------------------------------- | ---- |
| 1    | 概要（`index` / `<term>`）                                     | ○    |
| 2    | 手順適用範囲・前提                                             | ○    |
| 3    | 日次/週次/月次点検手順                                         | ○    |
| 4    | 障害対応手順（P1/P2…、切り分け、一次対応、復旧）               | ○    |
| 5    | アラート対応手順（確認→暫定対応→恒久対応）                     | ○    |
| 6    | バックアップ確認・リストア手順（演習含む）                     | ○    |
| 7    | バッチ再実行・失敗時対応                                       | ○    |
| 8    | 運用変更作業（設定変更・デプロイ・ロールバック）               | ○    |
| 9    | アカウント付与/剥奪手順                                        | ○    |
| 10   | 問い合わせ一次対応手順（テンプレ・ナレッジ）                   | ○    |
| 11   | 証跡（ログ、チケット、チェックリスト、実施記録）               | ○    |
| 12   | 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携） | ○    |

補足:

- `opr-<term>` で該当しない章がある場合でも章は残し、内容は `（なし）` / `（opr-index参照）` / `（本書の範囲外）` のいずれかを明記する

## 6. 記述ガイド

### 6.1. 概要（`index` / `<term>`）

生成する本文の見出しは **## 1. 概要（`index` / `<term>`）**

- 手順の対象と目的を 1〜3 行で示す
- `opr-index` が実行手順の SSOT であることを明示する
- `opr-<term>` の場合は「`opr-index` の差分・具体化である」ことを 1 行で明示する

### 6.2. 手順適用範囲・前提

生成する本文の見出しは **## 2. 手順適用範囲・前提**

- 適用対象、適用外、実施可能時間帯、必要権限を明記する
- 前提（環境、ツール、連絡経路、参照先）を明記する

推奨フォーマット（表）:

| 項目       | 内容                             |
| ---------- | -------------------------------- |
| 対象       | （例：本番環境、staging）        |
| 時間帯     | （例：平日9-18、夜間可否）       |
| 必要権限   | （例：SRE権限、DB read-only 等） |
| 使用ツール | （例：監視SaaS、チケット、CLI）  |
| 連絡先     | （例：#ops、#dev、電話）         |

### 6.3. 日次/週次/月次点検手順

生成する本文の見出しは **## 3. 日次/週次/月次点検手順**

- 頻度別に手順、実施者、完了条件、証跡を定義する
- 実施漏れの検知方法とエスカレーションを明記してよい

推奨フォーマット（表）:

| 頻度 | 手順 | 実施者 | 完了条件 | 証跡 |
| ---- | ---- | ------ | -------- | ---- |

### 6.4. 障害対応手順（P1/P2…、切り分け、一次対応、復旧）

生成する本文の見出しは **## 4. 障害対応手順（P1/P2…、切り分け、一次対応、復旧）**

- 優先度別に切り分け手順、一次対応、復旧手順を明記する
- エスカレーション条件と判断者を明記する
- 停止判断・ロールバックが関わる場合は、判断条件と承認者を必ず書く

推奨フォーマット（表）:

| 優先度 | 初動SLA | 切り分け | 一次対応 | 復旧 | エスカレーション |
| ------ | ------- | -------- | -------- | ---- | ---------------- |

### 6.5. アラート対応手順（確認→暫定対応→恒久対応）

生成する本文の見出しは **## 5. アラート対応手順（確認→暫定対応→恒久対応）**

- 検知後の確認、暫定対応、恒久対応の流れを明記する
- 誤検知時の扱い（クローズ条件、閾値調整、抑止）を明記する

推奨フォーマット（表）:

| 段階 | 手順 | 完了条件 | 証跡 |
| ---- | ---- | -------- | ---- |

### 6.6. バックアップ確認・リストア手順（演習含む）

生成する本文の見出しは **## 6. バックアップ確認・リストア手順（演習含む）**

- バックアップ確認項目、リストア手順、演習頻度を明記する
- 演習結果の証跡（ログ/レポート/所要時間）を必須化する
- RTO/RPO がある場合は、達成可否の判定方法を明記する（方針は OPD、実施は OPR）

### 6.7. バッチ再実行・失敗時対応

生成する本文の見出しは **## 7. バッチ再実行・失敗時対応**

- 失敗検知、再実行条件、再実行上限、エスカレーションを明記する
- 再実行でデータ重複が起きうる場合は、冪等性/防止策（run_id 等）を明記する

### 6.8. 運用変更作業（設定変更・デプロイ・ロールバック）

生成する本文の見出しは **## 8. 運用変更作業（設定変更・デプロイ・ロールバック）**

- 変更種別、承認者、実施条件（時間帯/凍結）、ロールバック条件を明記する
- 変更の証跡（チケット、差分、承認ログ、実施ログ）を必須化する
- 重大変更は事前周知の要否と手段を明記する

### 6.9. アカウント付与/剥奪手順

生成する本文の見出しは **## 9. アカウント付与/剥奪手順**

- 申請→承認→実施→検証→記録の流れを明記する
- 棚卸し（定期）と緊急権限（ブレークグラス）がある場合は、その実施手順と証跡を明記する

### 6.10. 問い合わせ一次対応手順（テンプレ・ナレッジ）

生成する本文の見出しは **## 10. 問い合わせ一次対応手順（テンプレ・ナレッジ）**

- 問い合わせ分類、一次対応テンプレ、ナレッジ参照先を明記する
- 引き継ぎ条件（開発/業務/運用）を明記する

### 6.11. 証跡（ログ、チケット、チェックリスト、実施記録）

生成する本文の見出しは **## 11. 証跡（ログ、チケット、チェックリスト、実施記録）**

- 必須証跡、保存先、保管期間、参照権限を明記する
- 証跡は「どのURL/どのID/どのrun_id」が分かる粒度で残す

推奨フォーマット（表）:

| 証跡種別       | 保存先           | 保管期間     | 参照権限        | 最低限残す識別子 |
| -------------- | ---------------- | ------------ | --------------- | ---------------- |
| チケット       | （例：Jira）     | （例：2年）  | （例：Ops/Dev） | ticket_id        |
| 実施ログ       | （例：ログ基盤） | （例：90日） | （例：Ops）     | run_id, job_id   |
| チェックリスト | （例：Docs）     | （例：1年）  | （例：Ops）     | 実施日, 実施者   |

### 6.12. 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携）

生成する本文の見出しは **## 12. 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携）**

- `opd-index` への導線を必ず記載する
- `mip-*` / `otp-*` / `cop-*` は必要時のみ連携情報として記載する
- 分冊がない場合でも `（本書のみ）` または `（なし）` を明記する

推奨フォーマット（表）:

| 種別 | ドキュメントID | 目的 | 備考 |
| ---- | -------------- | ---- | ---- |

## 7. 禁止事項

| 禁止事項                                               | 理由                                          |
| ------------------------------------------------------ | --------------------------------------------- |
| 手順を曖昧語（適宜/必要に応じて等）で記載する          | 再現性が担保できないため                      |
| 優先度別手順（P1/P2等）を省略する                      | 障害時初動が標準化できないため                |
| 証跡要件（ログ/チケット/チェックリスト）を未定義にする | 監査性・追跡性が欠落するため                  |
| 変更作業の承認・ロールバック条件を未記載にする         | 変更統制が崩壊するため                        |
| バックアップ確認・リストア演習を手順化しない           | 復旧可能性が検証できないため                  |
| OPD と矛盾する運用手順を独自定義する                   | 方針と手順の整合が崩れ、運用品質を損なうため  |
| 長大なコマンド列や設定全文を本文に貼り付ける           | 差分管理が破綻するため（別紙/リンクに寄せる） |

## 8. サンプル（拡充）

注：以下はルール文書内の例示です。生成する `opr-index` / `opr-<term>` では `## 1...` から始まります。

### 8.1. サンプル: opr-index（全体）

```yaml
---
id: opr-index
type: operations
title: 運用手順: 全体
status: draft
based_on: []
supersedes: []
---
```

#### 8.1.1. ## 1. 概要（index）

恒常運用の実行手順を標準化し、担当者差によらず同一品質で運用できる状態を定義する（本書がSSOT）。

#### 8.1.2. ## 3. 日次/週次/月次点検手順

| 頻度 | 手順                         | 実施者   | 完了条件                           | 証跡               |
| ---- | ---------------------------- | -------- | ---------------------------------- | ------------------ |
| 日次 | 監視ダッシュ確認             | Ops当番  | P1相当の異常がない、または起票済み | 日次チェックシート |
| 週次 | 主要アラートの誤検知レビュー | Ops Lead | 誤検知が棚卸し済み                 | 週次レビュー記録   |
| 月次 | 権限棚卸しの実施確認         | Sec/Ops  | 棚卸し完了                         | 棚卸しレポート     |

#### 8.1.3. ## 11. 証跡（ログ、チケット、チェックリスト、実施記録）

| 証跡種別       | 保存先    | 保管期間 | 参照権限 | 最低限残す識別子 |
| -------------- | --------- | -------- | -------- | ---------------- |
| チケット       | Issue管理 | 2年      | Ops/Dev  | ticket_id        |
| 実施ログ       | ログ基盤  | 90日     | Ops      | run_id, job_id   |
| チェックリスト | Docs      | 1年      | Ops      | 実施日, 実施者   |

#### 8.1.4. ## 12. 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携）

| 種別 | ドキュメントID     | 目的                                  | 備考       |
| ---- | ------------------ | ------------------------------------- | ---------- |
| 方針 | opd-index          | 統制・判断基準（SLO/SLA、停止判断等） | 必須       |
| 手順 | opr-incident       | 障害対応手順（優先度別）              | 該当時     |
| 手順 | opr-monitoring     | アラート対応手順                      | 該当時     |
| 手順 | opr-backup-restore | バックアップ確認/復旧演習             | 該当時     |
| 移行 | otp-index          | ハイパーケア連携（参考）              | 必要時のみ |

---

### 8.2. サンプル: opr-incident（障害対応）

```yaml
---
id: opr-incident
type: operations
title: 運用手順: 障害対応
status: draft
based_on: [opd-incident-management]
supersedes: []
---
```

#### 8.2.1. 概要（incident）

障害対応の切り分け・一次対応・復旧・報告を `opr-index` の具体手順として定義する。

#### 8.2.2. 障害対応手順（P1/P2…、切り分け、一次対応、復旧）

| 優先度 | 初動SLA | 切り分け                   | 一次対応                  | 復旧                 | エスカレーション        |
| ------ | ------- | -------------------------- | ------------------------- | -------------------- | ----------------------- |
| P1     | 30分    | 監視→直近変更→主要依存確認 | 影響遮断（機能停止/迂回） | 復旧作業→確認        | Ops Lead→PO（停止判断） |
| P2     | 2時間   | ログ/メトリクス確認        | 回避策提示                | 恒久対応チケット起票 | Ops Lead→Dev Lead       |
| P3     | 1営業日 | 再現条件整理               | 影響が小さければ保留      | 次リリースで対応     | Ops Leadへ共有          |

#### 8.2.3. 証跡（ログ、チケット、チェックリスト、実施記録）

- 必須: ticket_id、影響範囲、発生/検知時刻、一次対応内容、復旧時刻、原因、再発防止
- 保存先: 障害チケット（template: INC-01）

#### 8.2.4. 関連ドキュメント導線

| 種別 | ドキュメントID          | 目的                     | 備考   |
| ---- | ----------------------- | ------------------------ | ------ |
| 方針 | opd-incident-management | 優先度/停止判断/周知基準 | 必須   |
| 手順 | opr-monitoring          | アラート起点の切り分け   | 該当時 |

---

### 8.3. サンプル: opr-monitoring（アラート対応）

```yaml
---
id: opr-monitoring
type: operations
title: 運用手順: 監視・アラート対応
status: draft
based_on: [opd-monitoring]
supersedes: []
---
```

#### 8.3.1. 概要（monitoring）

監視アラートの確認→暫定対応→恒久対応を `opr-index` の具体手順として定義する。

#### 8.3.2. アラート対応手順（確認→暫定対応→恒久対応）

| 段階     | 手順                             | 完了条件               | 証跡         |
| -------- | -------------------------------- | ---------------------- | ------------ |
| 確認     | アラート種別/影響/発生範囲を確認 | 優先度（P1/P2/P3）確定 | チケット起票 |
| 暫定対応 | 影響遮断（機能停止/スロットル）  | 影響拡大が止まる       | 実施ログ     |
| 恒久対応 | 原因特定→修正計画→反映           | 再発防止策が合意       | 修正チケット |
| 誤検知   | 根拠を記録し閾値/抑止を提案      | 再発防止（閾値調整）   | 設定変更記録 |

---

### 8.4. サンプル: opr-backup-restore（バックアップ/復旧演習）

```yaml
---
id: opr-backup-restore
type: operations
title: 運用手順: バックアップ確認・リストア
status: draft
based_on: [opd-index]
supersedes: []
---
```

#### 8.4.1. バックアップ確認・リストア手順（演習含む）

- 確認（毎日）:
  - 最新バックアップの生成時刻とサイズを確認
  - 失敗があればチケット起票（P2）

- 演習（四半期）:
  - staging にリストア → 主要テーブルの件数/参照整合を確認
  - 所要時間を記録し、RTO/RPO達成可否を判定する

証跡:

- 演習レポート（日時/所要時間/成功可否/ログURL）

---

### 8.5. サンプル: opr-batch（バッチ再実行）

```yaml
---
id: opr-batch
type: operations
title: 運用手順: バッチ再実行・失敗対応
status: draft
based_on: [opd-index]
supersedes: []
---
```

#### 8.5.1. バッチ再実行・失敗時対応

- 失敗検知: 監視アラート or ジョブ管理の失敗通知
- 再実行条件:
  - 同一run_idで再実行可否を確認（冪等性方式に従う）
  - 再実行上限: 1回（2回目はOps Lead判断）

- エスカレーション:
  - データ不整合の可能性がある場合は P1 として `opr-incident` に切替

---

### 8.6. サンプル: opr-change（運用変更）

```yaml
---
id: opr-change
type: operations
title: 運用手順: 運用変更（設定変更・デプロイ）
status: draft
based_on: [opd-index]
supersedes: []
---
```

#### 8.6.1. 運用変更作業（設定変更・デプロイ・ロールバック）

- 事前:
  - 変更チケット起票（承認者: Ops Lead）
  - 影響評価とロールバック方針を記載

- 実施:
  - 実施ログ（誰が/いつ/何を）を残す

- ロールバック:
  - 異常（P1/P2）発生時は即時戻し、報告

---

### 8.7. サンプル: opr-access-control（アカウント付与/剥奪）

```yaml
---
id: opr-access-control
type: operations
title: 運用手順: アカウント付与・剥奪
status: draft
based_on: [opd-access-control]
supersedes: []
---
```

#### 8.7.1. アカウント付与/剥奪手順

| 手順 | 内容                 | 実施者      | 完了条件         | 証跡          |
| ---- | -------------------- | ----------- | ---------------- | ------------- |
| 1    | 申請受付（チケット） | Support/Ops | 必要情報が揃う   | ticket_id     |
| 2    | 承認                 | Ops Lead    | 承認コメントあり | 承認ログ      |
| 3    | 付与/剥奪            | Ops         | 権限反映確認     | 実施ログ      |
| 4    | 検証                 | 申請者      | ログイン確認     | スクショ/ログ |
| 5    | 記録                 | Ops         | 台帳更新         | 台帳          |

---

### 8.8. サンプル: opr-support（問い合わせ一次対応）

```yaml
---
id: opr-support
type: operations
title: 運用手順: 問い合わせ一次対応
status: draft
based_on: [opd-index]
supersedes: []
---
```

#### 8.8.1. 問い合わせ一次対応手順（テンプレ・ナレッジ）

- 分類:
  - 仕様確認 / 障害疑い / 依頼（権限・設定） / データ修正要否

- 一次対応テンプレ（例）:
  - 受付→再現条件→影響→暫定回避→引継ぎ要否

- 引き継ぎ条件:
  - 障害疑いは `opr-incident` へ（P判定を付与）

## 9. 生成 AI への指示テンプレート

生成 AI に `opr-index` / `opr-<term>` を作らせるときの指示テンプレートは `opr-instruction.md` を参照してください。
