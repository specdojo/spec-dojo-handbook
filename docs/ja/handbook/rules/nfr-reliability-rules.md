---
id: nfr-reliability-rules
title: 非機能要件 / 信頼性 作成ルール
type: rulebook
status: draft
---

Non-Functional Requirements Reliability Documentation Rules

本ドキュメントは、非機能要件のうち信頼性（障害抑止・誤動作防止・継続稼働）を定義する `nfr-reliability` の作成ルールを定義する。
信頼性要件は、障害の予防・検知・回復を測定可能な基準で記述する。

## 1. 全体方針

- 信頼性は「壊れにくさ」と「壊れた時の影響最小化」を要求として定義する。
- 要件は対象・条件・指標・基準を明示し、合否判定可能にする。
- 設計/実装手順ではなく、結果として満たす品質基準を書く。

## 2. 位置づけと用語定義（必要に応じて）

### 2.1. 位置づけ

- `nfr-reliability`：信頼性要求の正本
- `nfr-index`：NFR全体の入口
- `sac-*` / `sts-*`：信頼性要件の検証先
- `opd-*` / `opr-*`：障害時運用方針・手順

### 2.2. 用語定義

| 用語   | 定義                                         |
| ------ | -------------------------------------------- |
| 信頼性 | 障害・誤動作を抑え、継続稼働を維持できる性質 |
| 障害率 | 処理失敗・異常終了の発生割合                 |
| MTBF   | 平均故障間隔                                 |

## 3. ファイル命名・ID規則

- ルールドキュメントIDは `nfr-reliability-rules`。
- 生成対象ドキュメントIDは `nfr-reliability` を推奨する。
- 要件IDは `nfr-rel-<連番>`（例: `nfr-rel-001`）を推奨する。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [shared/schemas/spec-frontmatter.schema.yaml](../../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目     | 説明                                | 必須 |
| -------- | ----------------------------------- | ---- |
| id       | `nfr-reliability`                   | ○    |
| type     | `architecture` など共通スキーマ準拠 | ○    |
| title    | 非機能要件: 信頼性                  | ○    |
| status   | `draft` / `ready` / `deprecated`    | ○    |
| part_of  | `nfr-index`                         | 任意 |
| based_on | 根拠仕様ID                          | 任意 |

### 4.2. 推奨ルール

- `part_of` は分冊運用時に `nfr-index` を設定する。
- `based_on` には障害履歴・業務重要度を示す仕様を列挙する。

## 5. 本文構成（標準テンプレ）

`nfr-reliability` は以下の見出し構成を **順序固定** で配置する。

| 番号 | 見出し               | 必須 |
| ---- | -------------------- | ---- |
| 1    | 概要（対象・目的）   | ○    |
| 2    | 適用範囲・前提条件   | ○    |
| 3    | 信頼性要件一覧       | ○    |
| 4    | 測定・検証方法       | ○    |
| 5    | 関連ドキュメント導線 | ○    |

## 6. 記述ガイド

### 6.1. 概要（対象・目的）

生成する本文の見出しは **## 1. 概要（対象・目的）**

- 業務継続に対する信頼性要求の目的を 1〜3文で示す。

### 6.2. 適用範囲・前提条件

生成する本文の見出しは **## 2. 適用範囲・前提条件**

- 対象システム、対象時間帯、除外条件（計画停止など）を明記する。

### 6.3. 信頼性要件一覧

生成する本文の見出しは **## 3. 信頼性要件一覧**

- 要件は表形式（`id` / `内容` / `指標` / `基準` / `備考`）で記載する。
- 指標例：障害率、MTBF、再試行成功率。

### 6.4. 測定・検証方法

生成する本文の見出しは **## 4. 測定・検証方法**

- 監視・テスト・レビューのどこで判定するかを明記する。

### 6.5. 関連ドキュメント導線

生成する本文の見出しは **## 5. 関連ドキュメント導線**

- `nfr-index`、`sac-*`、`opd-*`、`opr-*`、`adr-*` への導線を置く。

## 7. 禁止事項

| 禁止事項                             | 理由                         |
| ------------------------------------ | ---------------------------- |
| 「安定稼働する」だけで基準を書かない | 合否判定できないため         |
| 実装ライブラリ設定値を直接列挙する   | 実装依存で保守不能になるため |
| 検証方法を省略する                   | 要件が運用されないため       |

## 8. サンプル

注：以下はルール文書内の例示です。生成する `nfr-reliability` では `## 1...` から始まります。

```yaml
---
id: nfr-reliability
type: architecture
title: 非機能要件: 信頼性
status: draft
part_of: [nfr-index]
based_on: []
supersedes: []
---
```

### 8.1. 概要（対象・目的）（例）

本書は、GCS 基幹システムにおいて信頼性（障害抑止・誤動作防止・継続稼働）に
関する非機能要件を定義する。
業務影響の大きいトランザクション処理やデータ連携の障害率・復旧性を測定可能な
基準で管理し、サービス品質の維持・改善を目的とする。

### 8.2. 適用範囲・前提条件（例）

| 項目         | 内容                                              |
| ------------ | ------------------------------------------------- |
| 対象システム | GCS 基幹システム（受注・在庫・会計サブシステム）  |
| 対象時間帯   | 24 時間 365 日（計画停止を除く）                  |
| 計画停止除外 | 月次メンテナンスウィンドウ（第2日曜 02:00–06:00） |
| 外部依存     | 決済 PSP・物流 API（外部障害は指標対象外）        |
| データ量前提 | 月間トランザクション約 500 万件                   |

### 8.3. 信頼性要件一覧（例）

| id          | 内容                                         | 指標           | 基準           | 備考                      |
| ----------- | -------------------------------------------- | -------------- | -------------- | ------------------------- |
| nfr-rel-001 | 主要APIは平常時に障害率を基準内に保つ        | 障害率         | 月次 0.1% 以下 | 対象外: 計画停止          |
| nfr-rel-002 | 障害発生時に自動再試行で復旧できること       | 再試行成功率   | 95% 以上       | 3回まで再試行             |
| nfr-rel-003 | 主要バッチ処理は冪等に再実行できること       | 再実行成功率   | 100%           | run_id 単位で結果分離     |
| nfr-rel-004 | 非同期メッセージ処理は重複排除を保証すること | 重複処理件数   | 0 件/月        | event_id による排除       |
| nfr-rel-005 | 基幹サービスの MTBF は基準以上を維持すること | MTBF           | 720 時間以上   | 四半期ローリング計測      |
| nfr-rel-006 | DLQ 滞留メッセージは基準時間内に解消すること | DLQ 滞留時間   | 4 時間以内     | OPR エスカレーション対象  |
| nfr-rel-007 | 障害切り分けに必要なログが欠落しないこと     | 必須ログ欠落率 | 0%             | flow_id/request_id/result |

### 8.4. 測定・検証方法（例）

| 要件ID      | 測定方法                                       | 判定タイミング   | 判定者   |
| ----------- | ---------------------------------------------- | ---------------- | -------- |
| nfr-rel-001 | APM ダッシュボードで月次障害率を集計           | 月次運用レビュー | SRE      |
| nfr-rel-002 | 再試行ログから成功率を算出                     | 月次運用レビュー | SRE      |
| nfr-rel-003 | ITS 再実行テストケースで検証                   | リリース前試験   | QA       |
| nfr-rel-004 | 重複メッセージ検知アラートのカウント           | リアルタイム監視 | SRE      |
| nfr-rel-005 | インシデント記録から MTBF を計算               | 四半期レビュー   | SRE / PM |
| nfr-rel-006 | DLQ モニタリングダッシュボード                 | リアルタイム監視 | Ops      |
| nfr-rel-007 | ログ監査スクリプトで必須フィールドの欠落を検出 | CI / 月次監査    | QA / SRE |

### 8.5. 関連ドキュメント導線（例）

| 種別         | ドキュメントID | 目的                         | 備考 |
| ------------ | -------------- | ---------------------------- | ---- |
| NFR 入口     | nfr-index      | 非機能要件全体の俯瞰         | 必須 |
| 受入条件     | sac-\*         | 信頼性要件の合否判定基準     | 必須 |
| システム試験 | sts-\*         | 信頼性観点の E2E 試験        | 必須 |
| 運用設計     | opd-\*         | 監視閾値・アラート設計       | 必須 |
| 運用手順     | opr-\*         | DLQ 対応・再実行手順         | 必須 |
| 判断記録     | adr-\*         | 信頼性に関する設計判断の追跡 | 任意 |

## 9. 生成 AI への指示テンプレート

生成 AI に `nfr-reliability` を作成させるときの指示テンプレートは [`nfr-reliability-instruction.md`](../instructions/nfr-reliability-instruction.md) を参照してください。
