# 総合テスト設計 − 個別設計（STD-D）作成ルール

本ドキュメントは、
**総合テスト設計（STD）で定義したテスト構成・分割方針を、
実際にテスト実施可能な単位まで具体化する設計書**
を統一形式で記述するための標準ルールです。

STD-D は、

- 総合テスト仕様（STS / STS-D）で定義された保証内容を前提に
- **どの観点を、どのテスト構成で、どの粒度まで確認するか**
- **テストケースに落とすための設計上の判断**

を明確にします。

---

## 0. 位置づけ（必読）

```plaintext
TSP（テスト戦略・方針）
 └ STS（総合テスト仕様）
    └ STS-D（総合テスト仕様・個別）
       └ STD（総合テスト設計）
          └ STD-D（総合テスト設計・個別）  ← 本書
             └ テスト実行・結果
```

| 観点   | STD        | STD-D                    |
| ------ | ---------- | ------------------------ |
| 粒度   | 全体設計   | 個別設計                 |
| 主語   | テスト全体 | 1業務シナリオ／1構成単位 |
| 内容   | 分割方針   | 分割結果                 |
| ケース | 書かない   | **まだ書かない**         |

---

## 1. 全体方針

- STD-D は **1つのテスト構成単位**（原則 1 業務シナリオ）につき 1 ファイル作成します。
- STD-D は **テストケースの前段階**です。
- STD-D では以下を明確にします：
  - 対象となる業務シナリオ／テスト構成単位
  - 確認すべき観点の適用範囲
  - ケース設計における分割方針（データ × 機能 等）

- 具体的な入力値・期待値・手順は **記載しません**。

---

## 2. 作成単位

STD-D の作成単位は、STD で定義した分割単位に従います。

代表例：

- 業務シナリオ単位（例：受注〜出荷）
- 業務フローの代表パターン単位
- 非機能確認の横断単位（性能・監査など）

---

## 3. ファイル命名・ID規則

### ファイル名（推奨）

```sh
010-総合テスト設計-受注〜出荷.md
020-総合テスト設計-在庫不足対応.md
```

### ID ルール

| 項目   | ルール                                 |
| ------ | -------------------------------------- |
| prefix | `std-`                                 |
| id     | `std-order-flow`, `std-stock-shortage` |

※ ID は **業務用語ベースで安定した名前**を用いる（用語集参照）

---

## 4. 推奨 Frontmatter 項目

| 項目       | 説明                           | 必須     |
| ---------- | ------------------------------ | -------- |
| id         | STD-D ID（`std-*`）            | ○        |
| type       | `test` 固定                    | ○        |
| title      | 総合テスト設計: <対象名>       | ○        |
| status     | `draft / ready / deprecated`   | ○        |
| owners     | 担当                           | 任意     |
| tags       | `system-test` 等               | 任意     |
| depends_on | `std-main`, `sts-*`, `sts-d-*` | **必須** |
| tests      | 実装・実行記録 ID              | 任意     |
| supersedes | 置換関係                       | 任意     |

---

## 5. 本文構成（標準テンプレ）

STD-D は以下の見出しを **必ずこの順序**で記述します。

1. 概要
2. 対象テスト構成
3. 適用するテスト観点
4. ケース分割方針
5. テスト実施上の前提・制約
6. 合否判断の観測点
7. 対象外
8. メモ / 将来課題

---

## 6. 記述ガイド詳細

### 6.1 概要

- 本 STD-D が **どのテスト構成単位を扱うか** を簡潔に記述します。

例：

> 本設計は、受注から出荷までの業務シナリオに対する総合テストの個別設計を定義する。

---

### 6.2 対象テスト構成（必須）

- 対象となる業務シナリオや利用状況を要約します。
- UI 操作や API 呼び出しの逐語列挙は禁止。

例：

- 受注登録
- 在庫引当
- 出荷確定
- 出荷完了

---

### 6.3 適用するテスト観点（必須）

STS-D で定義した観点を **この構成単位に適用した形**で整理します。

| 観点カテゴリ | 観点                     |
| ------------ | ------------------------ |
| 業務         | フローが中断なく完了する |
| データ       | 在庫数が正しく更新される |
| 連携         | 外部出荷連携が成功する   |
| 非機能       | 応答時間が許容範囲内     |

---

### 6.4 ケース分割方針（必須）

STD-D の**中核**です。

- ケースは **データ × 機能（処理分岐）** の組み合わせで分割する方針を示します。
- 実際のケース一覧は書きません。

例：

| 分割軸   | 考え方                  |
| -------- | ----------------------- |
| データ   | 通常在庫 / 在庫不足     |
| 処理分岐 | 正常完了 / 外部連携失敗 |
| 業務状態 | 初回処理 / 再処理       |

---

### 6.5 テスト実施上の前提・制約（必須）

- テスト実施に必要な前提条件や制約を記述します。

例：

- 外部連携はスタブを使用する
- 初期データは共通データセットを使用する
- 並列実行は行わない

---

### 6.6 合否判断の観測点（必須）

- 合否判断の **観測ポイント**を列挙します。

例：

- 業務結果が参照可能である
- エラー時に業務が中断されない
- 監査ログが出力されている

※ 数値・閾値は NFR / SAC に委ねる

---

### 6.7 対象外

- 本設計で扱わない例外や境界条件

---

### 6.8 メモ / 将来課題

- 将来追加予定のケース分割
- 未確定事項

---

## 7. 禁止事項

| 禁止事項              | 理由                 |
| --------------------- | -------------------- |
| テストケースの列挙    | 実装レベルの責務     |
| 入力値・期待値の明示  | テストコードに委ねる |
| UI操作の逐語列挙      | UI変更に弱い         |
| 実装クラス・SQLの記載 | 実装依存             |

---

## 8. サンプル（最小）

```yaml
---
id: std-order-flow
type: test
title: 総合テスト設計: 受注〜出荷
status: draft
depends_on:
  - std-main
  - sts-order-flow
---
```

---

## 9. 生成AI向け指示テンプレート

> - 以下のルールに従って **総合テスト設計 − 個別設計（STD-D）** を 1 ファイル作成してください。
> - 対象は **1つの業務シナリオ** としてください。
> - ケース分割方針（データ × 処理分岐）を明示してください。
> - 入力値・期待値・UI操作の逐語列挙は禁止です。
> - 実装依存情報は記載しないでください。
