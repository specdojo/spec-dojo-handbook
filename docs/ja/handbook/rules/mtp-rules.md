---
id: mtp-rules
title: 移行テスト計画 作成ルール
type: rulebook
status: draft
---

Migration Test Plan (MTP) Documentation Rules

本ドキュメントは、移行テスト計画（リハーサル計画）ドキュメント（`mtp-index` / `mtp-<term>`）を統一形式で記述するためのルールです。
移行手順と結果の妥当性を事前に検証し、当日の失敗確率を下げるための内容を定義します。

## 1. 全体方針

`mtp-index`（必要に応じて `mtp-<term>`）は、移行リハーサルの計画と評価基準を **再現可能** な形で整理し、GO/NO-GO判断の根拠を提供する。

- リハーサル回数とスケジュールを明確にする
- テスト環境/データ準備を事前に固定する
- 検証観点（件数/差分/業務シナリオ）と合否基準を明記する
- 差異発生時の扱い（許容/修正/再実行）を明文化する
- 結果報告フォーマットとGO/NO-GO判断プロセスを定義する

運用方針:

- 原則 `mtp-index` を作成し、全体の計画（SSOT）を1つにまとめる
- `mtp-<term>` は、ウェーブ分割・責任分界・対象の独立性が高い場合に限り追加する
- `mtp-<term>` を追加する場合でも、共通方針・全体日程・GO/NO-GOの基準点は `mtp-index` を正とする

## 2. 位置づけ

`mtp-index` / `mtp-<term>` と他ドキュメントの関係を示します。必要に応じて Mermaid による図を使用してよい。

- `mip-index`：移行の合意・判断のSSOT（成功条件・カットオーバー骨格を含む）
- `dmd-index` / `dmd-<term>`：データ移行の詳細設計（マッピング/変換/検証）
- **`mtp-index` / `mtp-<term>`：リハーサル計画・検証設計（観点/手順/証跡）**
- `cop-index` / `cop-<term>`：当日実行の詳細手順（Runbook）
- `otp-index` / `otp-<term>`：運用切替の詳細（監視設定/運用手順/窓口）

## 3. ファイル命名・ID規則

- `id` は `mtp-index` または `mtp-<term>`（kebab-case。例: `mtp-cutover-rehearsal`）。
- ファイル名は `mtp-010-移行テスト計画.md` / `mtp-020-移行テスト計画-<term>.md` 等、プロジェクト内で一意になるように命名する。
- `<term>` は用語集(GL)の論理名キー（英小文字kebab-case）を用いる（表示名は title / ファイル名で日本語を使用してよい）。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [docs/shared/schemas/spec-frontmatter.schema.yaml](../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目       | 説明                                         | 必須 |
| ---------- | -------------------------------------------- | ---- |
| id         | MTP ID（`mtp-index` または `mtp-<term>`）    | ○    |
| type       | `migration` 固定                             | ○    |
| title      | 移行テスト計画: <対象名>                     | ○    |
| status     | `draft` / `ready` / `deprecated`             | ○    |
| based_on   | 根拠となる仕様ID（ID配列。未指定は `[]` 可） | 任意 |
| supersedes | 置き換え関係（ID配列。未指定は `[]` 可）     | 任意 |

### 4.2. 推奨ルール

- `based_on` には移行判断に直接利用した成果物（例: `br-*` / `nfr-*` / `issue-*`）のみ列挙する
- `based_on` / `supersedes` は ID 配列（未指定は `[]` 可）

## 5. 本文構成（標準テンプレ）

`mtp-index` / `mtp-<term>` は以下の見出し構成を **順序固定** で配置します。

| 番号 | 見出し                               | 必須 |
| ---- | ------------------------------------ | ---- |
| 1    | 概要（`index` / `<term>`）           | ○    |
| 2    | リハーサル回数とスケジュール         | ○    |
| 3    | テスト環境/データ準備                | ○    |
| 4    | 検証観点（件数/差分/業務シナリオ）   | ○    |
| 5    | 合否基準                             | ○    |
| 6    | 差異発生時の扱い（許容/修正/再実行） | ○    |
| 7    | 結果報告フォーマット                 | ○    |
| 8    | GO/NO-GO判断プロセス                 | ○    |
| 9    | 関連ドキュメント                     | ○    |

補足:

- `mtp-index` は「全体」を扱い、複数 `mtp-<term>` がある場合は各termの位置づけと差分を示す
- `mtp-<term>` は term固有の内容に寄せ、共通方針や全体基準の重複記載を避ける（必要なら `mtp-index` へ参照する）
- 「関連ドキュメント」セクションは **必須** とし、分冊が無い場合でも `（なし）` または `（本書のみ）` を明記して空欄にしない

## 6. 記述ガイド

### 6.1. 概要（`index` / `<term>`）

生成する本文の見出しは **## 1. 概要（`index` / `<term>`）**

- 何のリハーサルを、どの目的で行うかを 1〜3 行で示す
- `mip-index` と整合すること
- `mtp-<term>` の場合は「term固有の目的・範囲（何を含み、何を含まないか）」を明記する

### 6.2. リハーサル回数とスケジュール

生成する本文の見出しは **## 2. リハーサル回数とスケジュール**

- 実施回数、実施日程、実施目的を明記する
- `mtp-<term>` の場合は、term固有の日程と全体日程の関係（ウェーブ順/前提）を明記する

推奨フォーマット（表）:

| 回数 | 予定日 | 目的 | 完了条件 |
| ---- | ------ | ---- | -------- |

### 6.3. テスト環境/データ準備

生成する本文の見出しは **## 3. テスト環境/データ準備**

- 環境（staging/検証環境等）と前提設定を明記する
- データ準備（データセットID、初期化/後始末）を明記する
- 可能なら、データ準備の責任者と手順参照先（runbook等）を示す

### 6.4. 検証観点（件数/差分/業務シナリオ）

生成する本文の見出しは **## 4. 検証観点（件数/差分/業務シナリオ）**

- 件数照合、差分検知、業務シナリオ検証の観点を整理する
- `dmd-*` で定義した検証（件数/重要値/許容差）と整合すること

推奨フォーマット（表）:

| 観点 | 方法 | 期待値 |
| ---- | ---- | ------ |

### 6.5. 合否基準

生成する本文の見出しは **## 5. 合否基準**

- 合格基準、許容誤差、判断者を明記する
- 重要な合否基準（停止許容/差分許容/重大障害）を最低限含める

推奨フォーマット（表）:

| 項目 | 基準 | 判定者 |
| ---- | ---- | ------ |

### 6.6. 差異発生時の扱い（許容/修正/再実行）

生成する本文の見出しは **## 6. 差異発生時の扱い（許容/修正/再実行）**

- 許容できる差異、修正が必要な差異、再実行条件を明記する
- 再実行の上限（回数/期限）と判断者を可能な限り明記する

### 6.7. 結果報告フォーマット

生成する本文の見出しは **## 7. 結果報告フォーマット**

- 報告に必要な項目（日時/結果/差異/証跡）を明記する
- 報告先（チケット/共有フォルダ/リポジトリ）を可能な限り明記する

推奨フォーマット（表）:

| 項目 | 記載内容 |
| ---- | -------- |

### 6.8. GO/NO-GO判断プロセス

生成する本文の見出しは **## 8. GO/NO-GO判断プロセス**

- 判断プロセス、判断主体、必要な証跡を明記する
- `mtp-index` は「全体のGO/NO-GO判断」を定義する
- `mtp-<term>` は term固有の判定点がある場合のみ追記し、全体判断の正は `mtp-index` とする

### 6.9. 関連ドキュメント

生成する本文の見出しは **## 9. 関連ドキュメント**

- `mtp-index` の場合：各 `mtp-<term>`（分冊）への導線を必ず記載する
- `mtp-<term>` の場合：`mtp-index` への導線（本体SSOT）を必ず記載する
- 分冊が無い場合でも `（なし）` または `（本書のみ）` を明記する

推奨フォーマット（箇条書き）:

- `<doc-id>`：<説明>
- `<doc-id>`：<説明>

## 7. 禁止事項

| 禁止事項                                                      | 理由                               |
| ------------------------------------------------------------- | ---------------------------------- |
| リハーサル回数/日程を曖昧に書く                               | 実行計画が不明確になるため         |
| 合否基準を曖昧にする                                          | GO/NO-GO判断ができないため         |
| 差異発生時の扱いを未定義にする                                | 再実行判断がぶれるため             |
| 結果報告フォーマットを省略する                                | 合意形成と追跡が困難になるため     |
| `mtp-<term>` に共通方針を重複記載し、`mtp-index` と矛盾させる | SSOTが崩れ、判断根拠が分散するため |
| 「関連ドキュメント」セクションを省略する                      | 導線が失われ、参照先が分散するため |

## 8. サンプル（最小・整合版）

注：以下はルール文書内の例示です。生成する `mtp-index` / `mtp-<term>` では `## 1...` から始まります。

### 8.1. `mtp-index`（全体SSOT・入口）

```yaml
---
id: mtp-index
type: migration
title: 移行テスト計画: 全体
status: draft
based_on: []
supersedes: []
---

```

#### 8.1.1. 概要（index）

移行リハーサルを通じて、移行手順と結果の妥当性を事前に検証し、本番切替の失敗確率を下げる。
本書は移行テスト計画のSSOTであり、term固有の詳細は `mtp-<term>` に分離する。

#### 8.1.2. リハーサル回数とスケジュール

| 回数 | 予定日     | 目的                         | 完了条件                       |
| ---- | ---------- | ---------------------------- | ------------------------------ |
| 1    | 2026-03-01 | カットオーバー手順の実行確認 | 全工程完了（所要時間計測含む） |
| 2    | 2026-03-15 | 差異検知と再現確認           | 差異0または許容内              |

#### 8.1.3. テスト環境/データ準備

- 環境: staging
- データ: 受注データセット `DS-ORDER-01`
- 初期化/後始末: リハーサル前に staging を初期化し、終了後は run_id 単位でログを保全する

#### 8.1.4. 検証観点（件数/差分/業務シナリオ）

| 観点         | 方法                      | 期待値            |
| ------------ | ------------------------- | ----------------- |
| 件数照合     | 旧/新件数比較             | 差分0             |
| 差分検知     | 重要項目の差分抽出        | 許容差内          |
| 業務シナリオ | 代表シナリオ（受注→請求） | 成功（重大障害0） |

#### 8.1.5. 合否基準

| 項目       | 基準           | 判定者     |
| ---------- | -------------- | ---------- |
| 件数差異   | 0              | 業務責任者 |
| 重要値差異 | 許容差内       | 業務責任者 |
| 所要時間   | 停止許容時間内 | 運用責任者 |
| 重大障害   | 0              | PO         |

#### 8.1.6. 差異発生時の扱い（許容/修正/再実行）

- 許容差内の差異：許容として記録し、原因は追跡（本番影響なしであることを確認）
- 許容差超の差異：原因を修正し再実行（再実行は最大 1 回、判断者は移行責任者）
- 重大障害：即時にNO-GO候補として扱い、POへエスカレーション

#### 8.1.7. 結果報告フォーマット

| 項目     | 記載内容                             |
| -------- | ------------------------------------ |
| 日時     | 実施日/開始終了時刻                  |
| 結果     | 合格/不合格                          |
| 差異     | 差分件数・重要値差分・原因/対応      |
| 所要時間 | 全体/主要工程別                      |
| 証跡     | ログ/レポート参照先（run_id, URL等） |
| 判断     | GO/NO-GO案、未解決事項               |

#### 8.1.8. GO/NO-GO判断プロセス

- 判定主体: PO（最終）/ 移行責任者（提案・取りまとめ）
- 判断入力: リハーサル結果報告、差分一覧、重大障害一覧、所要時間計測
- 判断結果: GO / 条件付きGO / NO-GO（延期）

#### 8.1.9. 関連ドキュメント

- `mtp-cutover-rehearsal`：カットオーバーリハーサルの詳細（term固有の判定点/ロールバック前提）
- （必要に応じて追加）`mtp-wave1`：ウェーブ1のリハーサル計画（環境/データセット/合否基準の差分）
- （必要に応じて追加）`mtp-wave2`：ウェーブ2のリハーサル計画（環境/データセット/合否基準の差分）

---

### 8.2. `mtp-<term>`（個別：例）

```yaml
---
id: mtp-cutover-rehearsal
type: migration
title: 移行テスト計画: カットオーバーリハーサル
status: draft
based_on:
  - mip-index
  - dmd-order-data
supersedes: []
---
```

#### 8.2.1. 概要（cutover-rehearsal）

本番切替当日の主要工程（受付停止〜差分抽出〜投入〜接続切替〜利用開始）をリハーサルし、手順と所要時間、判定点の妥当性を確認する。
共通の合否基準とGO/NO-GO判断は `mtp-index` を正とし、本書は term 固有の詳細のみを扱う。

#### 8.2.2. リハーサル回数とスケジュール

| 回数 | 予定日     | 目的               | 完了条件          |
| ---- | ---------- | ------------------ | ----------------- |
| 1    | 2026-03-01 | 手順の実行確認     | 全工程完了        |
| 2    | 2026-03-15 | 差異検知と再現確認 | 差異0または許容内 |

#### 8.2.3. テスト環境/データ準備

- 環境: staging
- データ: `DS-ORDER-01`
- 実行前条件: 旧系相当データが投入済みであること、外部I/Fは sandbox 接続であること

#### 8.2.4. 検証観点（件数/差分/業務シナリオ）

| 観点           | 方法                           | 期待値   |
| -------------- | ------------------------------ | -------- |
| 判定点の成立性 | GO1〜GO5での完了条件チェック   | 全て成立 |
| スモーク       | 切替後に代表API/画面を確認     | 成功     |
| 差分検知       | 抽出〜投入ログと差分一覧の確認 | 許容差内 |

#### 8.2.5. 合否基準

| 項目                      | 基準           | 判定者     |
| ------------------------- | -------------- | ---------- |
| GO4（接続切替）後スモーク | 全項目成功     | 運用責任者 |
| 主要工程所要時間          | 停止許容時間内 | 運用責任者 |
| 重大障害                  | 0              | PO         |

#### 8.2.6. 差異発生時の扱い（許容/修正/再実行）

- GO2/GO3で失敗：原因修正の上、再実行（最大1回）。不可ならNO-GO（延期）案。
- GO4で失敗：接続先を旧系へ戻す（ロールバック）→ NO-GO（延期）案。
- 軽微な差異：許容差内なら記録し、次回までに原因調査。

#### 8.2.7. 結果報告フォーマット

`mtp-index` のフォーマットに従い、term固有として以下を追加する。

| 項目         | 記載内容                                     |
| ------------ | -------------------------------------------- |
| 判定点       | GO1〜GO5の結果（完了条件/実績時刻/所要時間） |
| ロールバック | 実施の有無、実施理由、復旧完了時刻           |

#### 8.2.8. GO/NO-GO判断プロセス

term固有の判定点（GO1〜GO5）については本書に記録し、全体判断は `mtp-index` のプロセスに従う。

#### 8.2.9. 関連ドキュメント

- `mtp-index`：移行テスト計画のSSOT（全体方針/合否基準/判断プロセス）
- `cop-cutover-runbook`：当日手順の詳細（分単位の作業/チェックリスト）
- `dmd-order-data`：データ移行設計（抽出/変換/検証の詳細）

## 9. 生成 AI への指示テンプレート

生成 AI に `mtp-index` / `mtp-<term>` を作らせるときの指示テンプレートは `mtp-instruction.md` を参照してください。
