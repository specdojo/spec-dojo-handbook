---
id: tsp-rules
title: テスト戦略・方針 作成ルール
type: rulebook
status: draft
---

Test Strategy and Policy (TSP) Documentation Rules

本ドキュメントは、品質保証・テスト設計のために **テスト戦略・方針を統一形式で記述する標準ルール**です。
TSP は「全体として、どのようにテストで品質を担保するか」を明文化し、テスト設計・実施・受入判断の認識ズレを防ぎます。

TSP は「個別のテストケース集」ではありません。
各テストレベル（単体/内部結合/外部結合/総合/受入など）の **目的・範囲・体制**、および **フェーズ間の入口／出口条件（品質ゲート）** を合意することが主目的です。

## 1. 全体方針

- TSP は **プロジェクト/システムのテストの全体像**（考え方）を定義します。
  - 例: 「ドメインロジックは単体〜結合まで自動化し、UI は主要シナリオのみ E2E を行う」
- TSP は下位成果物（テスト観点・テスト条件（TPC）、各レベルのテスト仕様（*S）/テスト設計（*D）、受入条件（SAC/BAC））を導く **上位方針**です。
  - 下位成果物に“何をどこまで書くか”の境界も TSP で定義します。
- 曖昧な表現（例: 「十分にテストする」「品質を確保する」）は禁止し、
  - スコープ（対象/対象外）
  - 品質ゲート（入口/出口条件）
  - エビデンス（何をもって合否判断するか）
    を明確に書きます。
- クリック手順の逐語列挙は避け、**業務行為/入力/期待結果**として要約します。
- 実装詳細（例: 物理テーブル名、SQL全文、実装クラス/関数名、特定ライブラリの設定値）は記載しません。
- TSP は原則 **`tsp-overview` 1本** に統一します。下位のテスト観点・条件（TPC）は `tpc-<term>` で分割可能です。
  - TSP を分割する場合は、以下の要件**すべて**を満たす場合に限定し、`part_of` で集約ドキュメントへの所属を明示します（根拠の参照は `based_on`）。
    - 回帰/自動化の範囲や優先度を詳細化する必要があり、全体方針に収まらないとき（例: `tsp-regression`）
    - 非機能（性能/可用性/セキュリティ等）の環境・計測・合否基準が厚く、独立した方針が必要なとき（例: `tsp-nfr-testing`）
    - ドメインや外部IFごとに戦略が大きく異なり、1ファイルだと可読性が著しく低下するとき（例: 決済/帳票/分析基盤など）
  - 分割不要な場合は、`tsp-overview` に本文テンプレ（セクション 5 参照）の 9 項目すべて記載してください。

## 2. 位置づけ（他ドキュメントとの関係） / 用語定義

### 2.1. 位置づけ

`tsp-overview` と他ドキュメントの関係を示します。

```mermaid
flowchart BT
  TSP["**tsp-overview<br>テスト戦略・方針**"]
  TPC["tpc-&lt;term&gt;<br>テスト観点・条件"]

  subgraph xTS[*TS]
  direction RL
    xTSIndex["*ts-index<br>テスト仕様-全体構成"]
    xTSDetail["*ts-&lt;term&gt;<br>テスト仕様-個別仕様"]
    xTSDetail -->|part_of| xTSIndex
  end

  subgraph xTD[*TD]
  direction RL
    xTDIndex["*td-index<br>テスト設計-全体構成"]
    xTDDetail["*td-&lt;term&gt;<br>テスト設計-個別設計"]
    xTDDetail -->|part_of| xTDIndex
  end

  TC["テストコード<br>JUnit 等"]

  TPC -->|based_on| TSP
  xTD -->|based_on| xTS
  TC -->|based_on| xTD
  xTS -->|based_on| TSP
  xTS -->|based_on| TPC

  classDef target stroke-width:4px
  class TSP target
```

\*はテストレベル（U:単体テスト、I:内部結合テスト、S:システムテスト、A:受け入れテストなど）

### 2.2. 用語定義

| 用語                   | 定義                                                                                       |
| ---------------------- | ------------------------------------------------------------------------------------------ |
| TSP                    | テスト戦略・方針。プロジェクト全体のテストの考え方（目的/範囲/体制/ゲート）                |
| テストレベル           | 単体/内部結合/外部結合/総合/受け入れ等、段階別のテスト区分                                 |
| スコープ               | テスト対象（含む）と対象外（除外）                                                         |
| 入口条件               | そのテストレベルを開始してよい状態（前提、準備完了条件）                                   |
| 出口条件               | そのテストレベルを完了（合格）してよい条件（合格基準、残課題扱い）                         |
| エビデンス             | 合否判定の根拠（レポート、メトリクス、ログ、記録、承認など）                               |
| 回帰（リグレッション） | 変更により既存機能が壊れていないことを確認する試験                                         |
| 自動化                 | テスト実行・検証をツールで繰り返し可能にすること（どこまで自動化するかが方針）             |
| 重大度                 | 不具合の影響度（業務影響/停止有無/回避可否など）                                           |
| スタブ                 | テスト対象外の依存を置き換え、決め打ちの応答を返すことでテスト対象を動かすための代替実装   |
| モック                 | スタブの一種で、依存がどのように呼び出されたか（回数・引数・順序など）を検証できる代替実装 |

## 3. ファイル命名・ID規則

ID 命名ルールは [meta-id-naming-rules.md](meta-id-naming-rules.md) に従います。

- `id`: 小文字ハイフン形式で `tsp-<body>` の構造とします。
  - **デフォルト: `tsp-overview`** （全体方針の入口・概説）
  - 分割が必要な場合：方針の対象範囲が分かる ID を使用
    - 例: `tsp-nfr-testing`（非機能試験方針）
    - 例: `tsp-regression`（回帰方針）
  - 個別方針が多数になった場合：`tsp-index` を別途置きナビゲーション用とする（オプション）
- ファイル名: `tsp-<番号>-<短い日本語名>.md`（例: `tsp-0010-全体方針.md`）

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は `docs/handbook/shared/schemas/spec-frontmatter.schema.yaml` の制約に従います。

| 項目       | 説明                                               | 必須 |
| ---------- | -------------------------------------------------- | ---- |
| id         | TSP ID（`tsp-...`）                                | ○    |
| type       | `test` 固定                                        | ○    |
| title      | 方針名（例: テスト戦略・方針: 全体）               | ○    |
| status     | `draft`/`ready`/`deprecated`                       | ○    |
| part_of    | 集約ドキュメントへの所属（例: `tsp-overview`）     | 任意 |
| based_on   | 参照する仕様ID（BAC/NFR/SAC/ADR/TSL/UIS/EAPIS 等） | 任意 |
| supersedes | 置き換え関係（古仕様→新仕様）                      | 任意 |

### 4.2. 推奨ルール

- `based_on` に、方針の根拠となる主要仕様（例: `bac-...`, `nfr-...`, `adr-...`）を列挙し、スコープを明確にします。
- 方針を複数ファイルに分割する場合、各ファイルは `part_of` で集約ドキュメント（例: `tsp-overview`）への所属を明示します。

## 5. 本文構成（標準テンプレ）

各 TSP は以下の見出しを **この順で** 記載します。

1. 概要
2. テストレベル一覧（目的/範囲/体制）
3. スコープ（対象/対象外）
4. テスト環境・テストデータ（スタブ/モック方針を含む）
5. 入口／出口条件（品質ゲート）
6. 自動化・回帰方針（任意だが推奨）
7. 不具合管理方針（任意）
8. 品質メトリクス（任意）
9. メモ / 将来課題

## 6. 記述ガイド

テストドキュメント間の責務分離（TSP/TPC/各レベルの仕様/設計）は、[テストドキュメントスコープ定義ルール](meta-test-document-scope-rules.md)に従います。

### 6.1. 概要

- 1〜3文で「何の品質を、どの範囲に対して、どのように担保するか（全体方針）」を書きます。
- 可能なら対象仕様（BAC/NFR/主要機能）を言及し、`based_on` と整合させます。

### 6.2. テストレベル一覧

テストレベルは **一覧表** で定義します。

最小の列は次を推奨します。

| 列             | 目的                                          |
| -------------- | --------------------------------------------- |
| テストレベル   | 単体/結合/システム/受け入れ等                 |
| 目的           | そのレベルで何を保証したいか                  |
| 範囲           | 対象（例: モジュール/画面/API/バッチ/外部IF） |
| 実施体制・備考 | 実施主体、ツール、自動化方針、除外など        |

記述のコツ:

- “何をそのレベルで確認し、何を下位/上位に委ねるか”の境界をはっきりさせます。
- 「範囲」は成果物（モジュール/画面/API/バッチ等）で書き、個別ケースは下位文書に委ねます。

### 6.3. スコープ（対象/対象外）

TSP は必ず「どこまでがテスト対象か」を定義します。

- 対象（含む）
- 対象外（除外）
- 除外の理由（任意）

例:

- 対象: 主要業務フロー（販売/発注/入荷/棚卸）、主要 API、主要バッチ
- 対象外: 外部サービス自体の SLA（外部契約に委ねる）、外部端末の物理故障

### 6.4. テスト環境・テストデータ

環境やデータの前提が曖昧だと、試験結果が比較できません。
次を“方針”として定義します。

- 環境区分（例: 開発/内部結合/外部結合/総合/受入）と用途
- データ方針（匿名化、代表データ量、マスタの扱い）
- 外部IFの扱い（実接続/スタブ/モック、切り替え方針）
- スタブ/モック選択基準（共通戦略）
  - 外部I/Fは原則スタブ（契約確認目的ならサンドボックス優先）
  - 内部依存はテストレベルに応じて、単体/内部結合はモック・限定実接続、総合/受入は実接続を優先
  - タイミング/リトライ/冪等性の検証が目的なら、実接続または動的挙動を再現できるスタブを使用
  - 性能・スループット検証では実接続を基本とし、代替する場合は計測対象・誤差許容を明記

### 6.5. 入口／出口条件（品質ゲート）

フェーズ間の入口／出口条件は、**合否判定できる形**で書きます。

推奨の書き方（表）:

| フェーズ/テストレベル | 入口条件（開始条件） | 出口条件（完了条件） | エビデンス（根拠） |
| --------------------- | -------------------- | -------------------- | ------------------ |
| 単体テスト            | …                    | …                    | …                  |
| 内部結合テスト        | …                    | …                    | …                  |
| 外部結合テスト        | …                    | …                    | …                  |
| 総合テスト            | …                    | …                    | …                  |
| 受け入れテスト        | …                    | …                    | …                  |

記述のコツ:

- 出口条件には「未解決不具合の扱い（重大度別の許容）」を含めます。
- 非機能の出口条件は、可能なら NFR/SAC と接続します（例: 「全 NFR を満たす」）。

### 6.6. 自動化・回帰方針（任意）

自動化は “やる/やらない” ではなく、**どこを自動化し、どこを手動で補うか** を決めます。

- 自動化の優先領域（例: ドメインロジック、計算、バリデーション、回帰）
- 手動で行う領域（例: UX の探索、端末差異、教育/運用リハーサル）
- 回帰の基本方針（例: 変更影響のある領域は自動回帰を必須）

### 6.7. 不具合管理方針（任意）

不具合管理は、テスト成果の解釈ブレを防ぐために記載してよいです。

- 重大度（例: Blocker/Critical/Major/Minor）と判断観点（業務影響/回避可否）
- 収束基準（出口条件との関係）
- 既知不具合の扱い（残課題/例外承認/ロールバック条件）

### 6.8. 品質メトリクス（任意）

合意が必要な場合のみ、最小限のメトリクスを定義します。

- 例: 自動テストの実行結果（Pass率）、主要シナリオの実施状況、重大不具合件数、性能の合否（NFR達成状況）

### 6.9. メモ / 将来課題

- 未確定の前提（例: ピーク時の定義、想定データ量、外部依存の SLA）
- 将来追加したい試験（例: DR 訓練、長期運用での監査手順、非機能の拡充）

## 7. 禁止事項

| 項目                                            | 理由                                                |
| ----------------------------------------------- | --------------------------------------------------- |
| 物理テーブル名・物理カラム名・SQL全文           | 実装依存で変更に弱い                                |
| 実装クラス/関数名、特定ライブラリの設定値の列挙 | 実装依存で変更に弱い                                |
| クリック/画面遷移の逐語列挙                     | UI変更に弱い・本質が埋もれる                        |
| 個別テストケースの大量列挙                      | 下位文書（各レベルのテスト設計（\*D））に分解すべき |
| 「十分」「適切」「問題ない」等の曖昧表現        | 合否判定不能                                        |
| 前提なしの数値（条件が不明）                    | 合意不能、再現不能                                  |

## 8. よくある誤りと対策

| 誤り                         | 対策                                           |
| ---------------------------- | ---------------------------------------------- |
| テストレベルの役割分担が曖昧 | 「目的/範囲/体制」を表で固定する               |
| スコープが書かれていない     | 対象/対象外と除外理由を必ず明記する            |
| 入口/出口条件がない          | 品質ゲート（開始/完了条件）を表で定義する      |
| 自動化の範囲が不明           | 自動化領域と手動領域を分けて記述する           |
| 不具合が残ったまま“完了”扱い | 重大度別許容と例外承認ルールを出口条件に含める |

## 9. サンプル（最小）

### 9.1. メタ情報

```yaml
---
id: tsp-overview
type: test
title: テスト戦略・方針: 全体（駄菓子屋販売管理システム）
status: draft
part_of: []
based_on:
  - bac-sale-checkout
  - bac-inventory-replenishment
  - nfr-performance
  - nfr-security
  - sac-performance
  - sac-disaster-recovery
supersedes: []
---
```

### 9.2. 概要

駄菓子屋販売管理システムの主要業務（販売/在庫/発注・入荷/棚卸/レポート）と外部決済・帳票I/F境界、および主要非機能（性能/可用性/セキュリティ）を対象に品質を担保する。
担保方法は、単体→内部結合→外部結合→総合→受入の順に確認し、入口／出口条件（品質ゲート）とエビデンス（BAC/SAC含む）で合否を判定する。

### 9.3. テストレベル一覧

| テストレベル   | 目的                         | 範囲                                           | 実施体制・備考                                           |
| -------------- | ---------------------------- | ---------------------------------------------- | -------------------------------------------------------- |
| 単体テスト     | ドメインロジックの正確性担保 | 計算・バリデーション・分岐                     | 開発者。自動化必須。外部I/Fはモック                      |
| 内部結合テスト | 社内モジュール連携の担保     | 画面→API→サービス→DB（テスト用）               | 開発者。主要フローの最短経路を確認                       |
| 外部結合テスト | 外部I/F境界の担保            | 決済I/F、ファイル連携（スタブ/サンドボックス） | 開発者・テスト担当。タイムアウト/リトライ/重複防止を重視 |
| 総合テスト     | E2E成立の確認                | 販売→在庫→発注→入荷→棚卸→レポート              | テスト担当・業務担当。代表データ量で実運用相当を確認     |
| 受け入れテスト | BAC/SACで合否判定            | 受入シナリオ（BAC/SAC準拠）                    | 業務担当。承認をもって完了                               |

補足: 結合テストは「社内境界（内部）」と「外部境界（外部）」で分け、切り分け容易性を上げる。

### 9.4. スコープ（対象/対象外）

- 対象（含む）
  - 販売（会計確定/取消/返品）、在庫（引当/減算/不足判定/補充/棚卸差異）、発注・入荷、レポート
  - 外部決済・帳票I/Fの正常系と代表エラー系
  - 主要非機能（性能/可用性/セキュリティ）は NFR を根拠に確認する
- 対象外（除外）
  - 外部決済事業者自体の品質（SLA/障害そのもの）
  - 端末・回線の物理故障
  - 画面文言・見た目の網羅

### 9.5. テスト環境・テストデータ（方針）

- 環境
  - 開発: 単体/一部結合（モック中心）
  - 結合: テスト用DB＋外部I/Fスタブ
  - 総合/受入: 本番相当＋外部I/Fサンドボックス（または合意した代替）
- テストデータ
  - 個人情報を含む実データは使用しない（匿名化/ダミー）
  - 総合テストで代表データ量を使用（例: 商品1,000、在庫10,000、日次売上1,000取引）
  - マスタは固定スナップショットで再現性を担保

### 9.6. 入口／出口条件（例）

| フェーズ/テストレベル | 入口条件（開始条件）                                 | 出口条件（完了条件）                                                               | エビデンス（根拠）               |
| --------------------- | ---------------------------------------------------- | ---------------------------------------------------------------------------------- | -------------------------------- |
| 単体テスト            | 対象機能の実装が完了しレビュー済                     | 失敗 0 件、Blocker/Critical 0 件                                                   | CIの単体テストレポート           |
| 内部結合テスト        | 単体テストが安定している                             | 主要フロー（販売/在庫/発注）が成立し、Blocker/Critical 0 件                        | 結合テスト結果レポート           |
| 外部結合テスト        | 外部I/F仕様が確定し、スタブ/サンドボックスが利用可能 | 正常系＋代表エラー系（タイムアウト/リトライ/重複防止）が成立し、観測点が揃っている | I/F試験結果、ログ/監視記録       |
| 総合テスト            | 結合テストが完了している                             | BACに紐づく主要シナリオが完了し、重大不具合 0 件、NFR/SACに紐づく非機能が合格      | 総合テスト結果、性能試験レポート |
| 受け入れテスト        | 総合テストの出口条件を満たす                         | 受入条件（BAC/SAC）が承認される                                                    | 受入判定記録、指摘一覧           |

### 9.7. 自動化・回帰方針（例）

- 自動化の中心は単体テストと内部結合の主要経路とする
- 販売（会計確定）/在庫引当/発注点判定は変更時の自動回帰を必須とする
- UIのE2Eは主要シナリオ最小限＋探索で補完する

### 9.8. 成果物（エビデンス）の最小セット（例）

- CIのテスト結果（単体/結合）
- 総合テスト結果（主要シナリオの結果）
- NFR/SACに対応する試験レポート（性能/可用性/セキュリティの合否）
- 受入判定記録（承認、残課題の扱い）

### 9.9. メモ / 将来課題

- ピーク時条件（同時数・データ量）の確定
- 外部決済の障害時（代替運用/ロールバック）の合意

## 10. 生成 AI への指示テンプレート

生成 AI に TSP を作らせるときの指示テンプレートは [tsp-instruction.md](../instructions/tsp-instruction.md) を参照してください。
