# テスト観点・条件（TPC）作成ルール

本ドキュメントは、テスト設計のために **テスト観点・テスト条件（Test Perspectives and Conditions: TPC）を統一形式で記述する標準ルール**です。
TPC は「**何を確認すべきか（観点）**」と「**どのような状態・条件で確認するか（条件）**」を整理し、
テスト仕様・テスト設計・テスト実装への **分解の起点**となることを目的とします。

TPC は **テスト戦略・方針（TSP）を具体化する中間成果物**であり、
個別のテストケースやテストコードを直接列挙するものではありません。

---

## 1. 全体方針

- TPC は **「何をテストすべきか」を網羅的・構造的に整理するドキュメント**です。
  - 機能・業務・例外・非機能などの観点を明示します。

- TPC は **TSP の下位、各テスト仕様（単体/結合/システム/受入）の上位**に位置づけられます。
  - TSP: 「どういう考え方で品質を担保するか」
  - TPC: 「その考え方に基づき、何を確認対象とするか」

- TPC は **テストケースを直接書きません**。
  - テストケースは下位文書（テスト仕様・テスト設計・コード）に委ねます。

- 観点・条件は **トレース可能**でなければなりません。
  - 要件・仕様・受入条件・非機能要件と対応付けます。

- 曖昧な表現は禁止します。
  - 「正常系を確認する」「例外も考慮する」などは禁止
  - **何を、どの状態で、何を確認するか**を明示します。

- 1ファイル = 1 つの観点整理単位を原則とします。
  - 肥大化する場合は分割し、`depends_on` で関係を明示します。

---

## 2. 用語定義

| 用語       | 定義                                                            |
| ---------- | --------------------------------------------------------------- |
| TPC        | テスト観点・テスト条件。何を・どの状態で確認するかの整理        |
| テスト観点 | 確認すべき品質・振る舞いの切り口（機能、業務、例外、非機能 等） |
| テスト条件 | 観点を確認するために必要な前提状態・入力状態・環境条件          |
| トレース   | 要件・仕様・受入条件などとの対応関係                            |
| 下位成果物 | テスト仕様、テスト設計、テスト実装（コード）                    |

---

## 3. ファイル命名・ID規則

- ファイル名: `tpc-<番号>-<短い日本語名>.md`
  - 例: `tpc-0010-受注処理.md`

- Frontmatter:
  - `id`: `tpc-order-process` のように小文字ハイフン形式
  - `title`: 「テスト観点・条件: <対象>」

---

## 4. 推奨 Frontmatter 項目

Frontmatter は共通スキーマに従います。

| 項目       | 説明                                            | 必須 |
| ---------- | ----------------------------------------------- | ---- |
| id         | TPC ID（`tpc-...`）                             | ○    |
| type       | `test` 固定                                     | ○    |
| title      | ドキュメント名                                  | ○    |
| status     | `draft` / `ready` / `deprecated`                | ○    |
| version    | バージョン（SemVer）                            | 任意 |
| owners     | 担当者                                          | 任意 |
| tags       | タグ・分類                                      | 任意 |
| depends_on | 上位仕様（TSP / BAC / NFR / SAC / BPS / BR 等） | 任意 |
| tests      | 下位テスト仕様 ID（uts-/its-/sts-/ats- 等）     | 任意 |
| supersedes | 置き換え関係                                    | 任意 |

推奨:

- `depends_on` には **観点の根拠となる仕様**を必ず入れます。
- `tests` で、どのテスト仕様に展開されるかを明示します。

---

## 5. 本文構成（標準テンプレ）

TPC ファイルは以下の見出しを **必ずこの順で**記載します。

1. 概要
2. テスト観点
3. テスト条件
4. トレース
5. メモ / 留意事項

---

## 6. 記述ガイド詳細

### 6.1 概要

- 1〜3文で **対象範囲と目的**を記載します。
- 「どの業務・機能・品質を対象とする観点整理か」を明確にします。

例:

> 本ドキュメントは、受注処理機能に対するテスト観点およびテスト条件を整理し、
> 各テストレベルの仕様・設計への分解指針を提供する。

---

### 6.2 テスト観点（必須）

テスト観点は **一覧表** で整理します。

#### 推奨カラム

| 観点ID | 観点分類 | 観点名     | 確認したいこと                       | 備考 |
| ------ | -------- | ---------- | ------------------------------------ | ---- |
| TP-01  | 機能     | 正常処理   | 正しい入力で正しい結果が得られること |      |
| TP-02  | 業務     | 業務ルール | ビジネスルールが守られていること     | BR-  |
| TP-03  | 例外     | 入力不正   | 不正入力時に適切なエラーとなること   |      |
| TP-04  | 非機能   | 性能       | 規定時間内に処理が完了すること       | NFR  |

記述のコツ:

- 「正常/異常」だけで終わらせず、**何の品質か**を明確にします。
- 観点は **ケース数を意識せず、切り口として整理**します。

---

### 6.3 テスト条件（必須）

テスト条件は、観点ごとに **どのような状態・条件で確認するか**を定義します。

#### 推奨カラム

| 観点ID | 条件ID | 条件内容       | 前提状態 / 入力状態  | 期待される振る舞い |
| ------ | ------ | -------------- | -------------------- | ------------------ |
| TP-01  | TC-01  | 正常な受注入力 | 有効な商品・在庫あり | 受注が確定する     |
| TP-03  | TC-05  | 在庫不足時     | 在庫数 < 注文数      | エラーとなる       |
| TP-04  | TC-08  | 最大件数処理   | 注文数が最大値       | 規定時間内に完了   |

記述のコツ:

- **データ × 状態 × 振る舞い**が読み取れるように書きます。
- 実際のテストデータ値やコードは書きません。

---

### 6.4 トレース（必須）

観点・条件は必ず **上位仕様と紐づけ**ます。

#### 例

| 観点ID | 関連仕様ID              |
| ------ | ----------------------- |
| TP-01  | bps-order-flow, bac-01  |
| TP-04  | nfr-performance, sac-02 |

---

### 6.5 メモ / 留意事項

- 未確定条件
- 環境依存事項
- 将来追加予定の観点

---

## 7. 禁止事項

| 項目                           | 理由                   |
| ------------------------------ | ---------------------- |
| テストコードの記載             | 実装に委ねるべき       |
| SQL / クラス名 / メソッド名    | 実装依存で変更に弱い   |
| クリック操作の逐語列挙         | UI変更に弱い           |
| ケース番号の大量列挙           | 設計・実装で展開すべき |
| 「適切」「十分」などの曖昧表現 | 合否判定不能           |

---

## 8. よくある誤りと対策

- 観点と条件が混在している
  → 観点＝切り口、条件＝状態・前提 と役割を分離する
- 条件がテストケース化している
  → 値や手順は書かず、状態レベルで留める
- トレースがない
  → 必ず上位仕様 ID を紐付ける

---

## 9. サンプル（最小）

### メタ情報

```yaml
---
id: tpc-order-process
type: test
title: テスト観点・条件: 受注処理
status: draft
version: '1.0.0'
owners: []
tags: [test, quality]
depends_on: [tsp-overview, bps-order-flow, bac-order]
tests: [uts-order, its-order-api, sts-order-flow]
supersedes: []
---
```

---

## 10. 生成 AI への指示テンプレート

> 以下のルールに従って **テスト観点・テスト条件（TPC）** を 1 ファイル作成してください。
>
> - 目的: テスト設計の起点となる観点と条件を整理し、テスト仕様への分解を容易にする
> - 禁止: テストコード、SQL、クラス名、クリック手順、具体的数値の列挙
>
> ## 出力フォーマット
>
> - YAML Frontmatter（`id` / `type=test` / `title` / `status` 必須）
> - 見出し順:
>   1. 概要
>   2. テスト観点
>   3. テスト条件
>   4. トレース
>   5. メモ / 留意事項
>
> ## 記述ルール
>
> - 観点は「何を確認するか」
> - 条件は「どの状態で確認するか」
> - 上位仕様と必ずトレース可能にする
