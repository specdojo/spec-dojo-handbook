---
id: nfr-performance-rules
title: 非機能要件 / 性能 作成ルール
type: rulebook
status: draft
---

Non-Functional Requirements Performance Documentation Rules

本ドキュメントは、非機能要件のうち性能（応答性・処理能力・資源効率）を定義する `nfr-performance` の作成ルールを定義する。
性能要件は、平常時・ピーク時の条件下で測定可能な指標と基準を定める。

## 1. 全体方針

- 性能は応答時間・スループット・同時実行数の観点で定義する。
- 条件（負荷・時間帯・データ量）を明示し、再現可能にする。
- 平均値より P95/P99 等の分位値を優先して評価する。

## 2. 位置づけと用語定義（必要に応じて）

### 2.1. 位置づけ

- `nfr-performance`：性能要求の正本
- `nfr-index`：NFR全体の入口
- `sac-*` / `sts-*`：性能受入・試験仕様
- `opd-*`：運用時監視閾値

### 2.2. 用語定義

| 用語     | 定義                              |
| -------- | --------------------------------- |
| P95/P99  | 応答時間分布の95/99パーセンタイル |
| RPS      | 秒間処理件数                      |
| ピーク時 | 事前合意した高負荷条件            |

## 3. ファイル命名・ID規則

- ルールドキュメントIDは `nfr-performance-rules`。
- 生成対象ドキュメントIDは `nfr-performance` を推奨する。
- 要件IDは `nfr-perf-<連番>` を推奨する。

## 4. 推奨 Frontmatter 項目

### 4.1. 設定内容

Frontmatter は共通スキーマに従います（参照: [shared/schemas/spec-frontmatter.schema.yaml](../../../../shared/schemas/spec-frontmatter.schema.yaml) / [meta-document-metadata-rules.md](meta-document-metadata-rules.md)）。

| 項目    | 説明                                | 必須 |
| ------- | ----------------------------------- | ---- |
| id      | `nfr-performance`                   | ○    |
| type    | `architecture` など共通スキーマ準拠 | ○    |
| title   | 非機能要件: 性能                    | ○    |
| status  | `draft` / `ready` / `deprecated`    | ○    |
| part_of | `nfr-index`                         | 任意 |

### 4.2. 推奨ルール

- 平常時とピーク時の条件を分離して記載する。
- 外部依存の遅延切り分け条件を備考で明記する。

## 5. 本文構成（標準テンプレ）

`nfr-performance` は以下の見出し構成を **順序固定** で配置する。

| 番号 | 見出し               | 必須 |
| ---- | -------------------- | ---- |
| 1    | 概要（対象・目的）   | ○    |
| 2    | 適用範囲・負荷条件   | ○    |
| 3    | 性能要件一覧         | ○    |
| 4    | 測定・検証方法       | ○    |
| 5    | 関連ドキュメント導線 | ○    |

## 6. 記述ガイド

### 6.1. 概要（対象・目的）

生成する本文の見出しは **## 1. 概要（対象・目的）**

- どの処理をどの業務価値のために最適化するかを示す。

### 6.2. 適用範囲・負荷条件

生成する本文の見出しは **## 2. 適用範囲・負荷条件**

- 同時接続数、RPS、データ量、時間帯を明記する。

### 6.3. 性能要件一覧

生成する本文の見出しは **## 3. 性能要件一覧**

- 表形式（`id` / `内容` / `指標` / `基準` / `備考`）で記述する。
- 指標例：P95、P99、RPS、バッチ完了時間。

### 6.4. 測定・検証方法

生成する本文の見出しは **## 4. 測定・検証方法**

- 負荷試験と運用監視の双方で判定できる形にする。

### 6.5. 関連ドキュメント導線

生成する本文の見出しは **## 5. 関連ドキュメント導線**

- `sac-*`、`sts-*`、`opd-*`、`adr-*` への導線を記載する。

## 7. 禁止事項

| 禁止事項                   | 理由                 |
| -------------------------- | -------------------- |
| 負荷条件なしで閾値だけ書く | 再現不能のため       |
| 平均値のみで評価する       | 体感性能を見逃すため |
| 単位なしの数値を記載する   | 判定不能のため       |

## 8. サンプル

注：以下はルール文書内の例示です。生成する `nfr-performance` では `## 1...` から始まります。

```yaml
---
id: nfr-performance
type: architecture
title: 非機能要件: 性能
status: draft
part_of: [nfr-index]
based_on: []
supersedes: []
---
```

### 8.1. 概要（対象・目的）（例）

本書は、GCS 基幹システムにおいて性能（応答性・処理能力・資源効率）に関する
非機能要件を定義する。
平常時およびピーク時の条件下で応答時間・スループットを測定可能な
基準で管理し、利用者体感と業務処理の品質を維持することを目的とする。

### 8.2. 適用範囲・負荷条件（例）

| 項目         | 内容                                             |
| ------------ | ------------------------------------------------ |
| 対象システム | GCS 基幹システム（受注・在庫・会計 API・バッチ） |
| 平常時負荷   | 20 RPS・同時接続 200                             |
| ピーク時負荷 | 100 RPS・同時接続 1,000（16–18 時台）            |
| データ量前提 | 受注テーブル 500 万件・在庫テーブル 300 万件     |
| バッチ前提   | 日次売上集計対象約 10 万件                       |
| 除外条件     | 外部 PSP / 物流 API の応答遅延は指標対象外       |

### 8.3. 性能要件一覧（例）

| id           | 内容                                            | 指標                 | 基準             | 備考                 |
| ------------ | ----------------------------------------------- | -------------------- | ---------------- | -------------------- |
| nfr-perf-001 | 在庫照会 API は平常時に応答時間を満たす         | 応答時間（P95）      | 500 ms 以内      | 20 RPS               |
| nfr-perf-002 | 会計確定 API はピーク時に基準を満たす           | 応答時間（P95）/ RPS | 800 ms / 100 RPS | 16–18 時相当         |
| nfr-perf-003 | 受注一覧検索は P99 で基準内                     | 応答時間（P99）      | 2,000 ms 以内    | 複合検索条件         |
| nfr-perf-004 | 日次売上集計バッチは基準時間内に完了する        | バッチ完了時間       | 60 分以内        | 対象 10 万件         |
| nfr-perf-005 | DB コネクションプール使用率はピーク時でも基準内 | プール使用率         | 80% 以下         | コネクション枯渇防止 |
| nfr-perf-006 | フロントエンドの初回表示は基準時間内            | LCP                  | 2.5 秒以内       | Core Web Vitals 準拠 |
| nfr-perf-007 | イベントバスのスループットは基準以上            | メッセージ処理速度   | 500 msg/s 以上   | 非同期メッセージ基盤 |

### 8.4. 測定・検証方法（例）

| 要件ID       | 測定方法                                             | 判定タイミング   | 判定者    |
| ------------ | ---------------------------------------------------- | ---------------- | --------- |
| nfr-perf-001 | 負荷試験（k6 / Gatling）で P95 を計測                | リリース前試験   | QA / SRE  |
| nfr-perf-002 | ピーク負荷シナリオで P95 および RPS を計測           | リリース前試験   | QA / SRE  |
| nfr-perf-003 | APM ダッシュボードで P99 を監視                      | リアルタイム監視 | SRE       |
| nfr-perf-004 | バッチジョブ監視ダッシュボードで完了時間を計測       | 日次確認         | Ops / SRE |
| nfr-perf-005 | DB 監視エージェントでプール使用率を取得              | リアルタイム監視 | SRE       |
| nfr-perf-006 | Lighthouse CI で LCP を計測                          | merge 毎         | フロント  |
| nfr-perf-007 | メッセージブローカーモニタリングでスループットを確認 | リアルタイム監視 | SRE       |

### 8.5. 関連ドキュメント導線（例）

| 種別         | ドキュメントID | 目的                       | 備考 |
| ------------ | -------------- | -------------------------- | ---- |
| NFR 入口     | nfr-index      | 非機能要件全体の俯瞰       | 必須 |
| 受入条件     | sac-\*         | 性能要件の合否判定基準     | 必須 |
| システム試験 | sts-\*         | 負荷試験・性能回帰試験     | 必須 |
| 運用設計     | opd-\*         | 監視閾値・アラート設計     | 必須 |
| 判断記録     | adr-\*         | 性能に関する設計判断の追跡 | 任意 |

## 9. 生成 AI への指示テンプレート

生成 AI に `nfr-performance` を作成させるときの指示テンプレートは [`nrf-instruction.md`](../instructions/nrf-instruction.md) を参照してください。
