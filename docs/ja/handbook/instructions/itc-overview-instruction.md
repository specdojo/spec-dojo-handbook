# 内部結合テストカタログ 概要 作成の指示テンプレート

以下のルールに従って、**内部結合テストカタログ-概要（`itc-overview`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `itc-overview` は内部結合テストの **共通ルール（SSOT）** を定義します（考え方・共通方針・共通定義）。
- 個別の観点・条件・ケースは **`itc-<term>` に集約**し、詳細は **テストコード／CI証跡** に寄せます。
- 記述は **レビュー可能**であることを優先し、長文化を避けてください（方針は箇条書き中心）。
- 「例外」や「対象外」を明示し、内部結合テストの責任境界（何をやらないか）を固定します。
- 関係の表現は **`based_on` と `supersedes` のみ**を使います（他の関係タイプを増やしません）。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `itc-overview` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象システム/プロダクトの概要
- 上位方針: `tsp-overview`
- 関連する仕様/ルール（必要に応じて）: `bac-*` / `br-*` / `nfr-*`
- 内部結合テスト対象の候補（結合単位の切り方の案）
- 依存（DB、外部 API、時刻、メッセージ基盤等）と環境方針
- テストコード/CI での証跡の参照先（レポート保存場所など）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `test` 固定）。

```yaml
---
id: itc-overview
type: test
title: 内部結合テストカタログ: 概要（<システム名>）
status: draft # draft / ready / deprecated
based_on:
 - tsp-overview
supersedes: []
---
```

- `based_on` には **必ず** `tsp-overview` を含めてください（追跡の起点）。
- `bac-*` / `br-*` / `nfr-*` は、共通方針の判断に **直接利用したものだけ**を列挙してください。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 本ドキュメントの目的と適用対象
2. テスト対象の括り方と分割基準
3. 対象外・除外理由（共通）
4. 観点の立て方（共通）
5. 条件の立て方（共通）
6. 内部結合テスト共通の境界/依存の扱い
7. テスト環境・データの共通方針
8. ケース表の共通カラム
9. メモ / 将来課題

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 内部結合テストの共通方針、分割基準、観点/条件の立て方、境界/依存の扱い、環境/データ方針、合格基準、証跡方針
- 書かない: 個別ケースの列挙、個別の詳細条件、テスト手順の逐語列挙、テストコードの構造、個別 `itc-<term>` の内容

### 追跡可能性（TSP からの派生）

- `itc-overview` は `tsp-overview` を根拠にします。
- 追跡は Frontmatter の `based_on` で担保してください。

### 代表ケース/具体値の扱い（ドキュメント最小化）

- 代表ケースの **考え方**（境界、重大例外、環境条件の比重など）は方針として書いてよい。
- ただし `itc-overview` では **ケースの具体的な列挙はしない**。
- 具体値・実施結果は `itc-<term>` とテストコード/CI成果物に委譲する。

## 各セクションの書き方

### 1. 本ドキュメントの目的と適用対象

- `itc-overview` の目的と適用対象を明確に書く。
- 成果物の位置づけ（`itc-overview` / `itc-<term>` / テストコード/CI）の役割を明示する。
- ITで保証する範囲（結合境界、永続化、トランザクション等）を簡潔に示す。

### 2. テスト対象の括り方と分割基準

- `itc-<term>` の `<term>` をどう切るかを定義する。
- 分割基準（結合境界、データ境界、I/F境界、変更影響、担当境界）を明記する。
- 過分割と肥大化の抑制基準を具体化する。

### 3. 対象外・除外理由（共通）

- 「対象外」「除外理由」「代替レベル/代替手段」「例外（あれば）」の形式で示す。
- 代替レベル/代替手段は **必ず** 記載する。
- 例外は乱用せず、判断基準と再現性担保の条件を明記する。

### 4. 観点の立て方（共通）

- 観点の型（I/F契約、永続化整合、トランザクション境界、依存障害時の挙動、状態遷移、セキュリティ境界）を示す。
- 命名規則（名詞 + 品質/振る舞い）と粒度基準を示す。
- 観点の重複を避けるルールを書く。

### 5. 条件の立て方（共通）

- 条件を「入力」「状態」「環境」に分解する前提を書く（ITでは環境/データ条件の比重が上がる）。
- 組合せを増やし過ぎないルール（代表→境界→重大例外）を示す。

### 6. 内部結合テスト共通の境界/依存の扱い

- UTでMockしていた境界の一部を **実装に近づけて** 検証することを明記する。
- DB、マイグレーション/スキーマ、外部API、時刻、非同期/メッセージングの扱いを共通方針として記載する。
- Mock/Stub/Fake の使い分け方針を簡潔に示す。

### 7. テスト環境・データの共通方針

- 環境はCIで再現可能にする（固定バージョン/固定設定）。
- データは独立・最小化し、並列実行時の干渉を避ける。
- ログ/観測の取得方針（秘匿情報のマスクを含む）を示す。

### 8. ケース表の共通カラム

- `itc-<term>` における共通カラムを **具体的に** 明記する。
- 必須カラムと推奨カラムを区別し、表の1行=1テストの原則を明記する。
- **必須カラム**（順序固定）:
  - `case_id`（対象別に一意。`<level>-<term>-<perspective_key>-<nnn>` を推奨、`nnn` は 3 桁・10刻み）
  - `条件`（入力/状態/環境の要点。`入力:` `状態:` `環境:` の形を推奨）
  - `手順（最小）`（クリック列挙は禁止。抽象化した最小手順）
  - `期待値`（判定可能な合格条件。観測点を含める）
- **推奨カラム**（運用必須）:
  - `観測点（アサーション）`
  - `境界/依存`（DB種別、ブローカ、Stub等の扱い）
  - `トレース`
  - `優先度`（P0/P1/P2）
  - `自動化`（manual/automated/mixed）
  - `証跡`（テストコード/CI/レポート参照先）

### 9. メモ / 将来課題

- 未確定事項や将来の改善点を箇条書きで記載する。
- 運用上必須になったら本文へ昇格させる方針を明記してよい。

## 最終チェック（自己検査）

- `id: itc-overview` / `type: test` / `status` が設定されている
- `based_on` に `tsp-overview` が入っている
- 見出しが指定順序で揃っている（欠落なし）
- 個別ケースの列挙がない（`itc-<term>` に委譲できている）
- 対象外・除外理由に代替レベル/手段が書けている
- 関係タイプは `based_on` / `supersedes` のみ（他を増やしていない）
