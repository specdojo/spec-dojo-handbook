# 内部結合テストカタログ 対象別 作成の指示テンプレート

以下のルールに従って、**内部結合テストカタログ-対象別（`itc-<term>`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `itc-<term>` は **対象固有の情報のみ**を記述し、共通ルールは `itc-overview` を参照します（重複記述しない）。
- 内部結合テストの目的は「**複数コンポーネントの結合としての振る舞い**を決定的に検証すること」です。外部要因（外部サービス実疎通／実ユーザUI）は原則排除します。
- ケースは「表の1行＝1テスト」とし、手順と期待値は **判定可能**な粒度で簡潔に書きます。
- 詳細な操作列挙やデータ大量列挙は避け、必要な詳細は **テストコード／CI証跡** へ寄せます。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `itc-<term>` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象システム/プロダクトの概要
- 上位方針: `tsp-overview`
- `itc-overview`（共通方針）
- 対象 `term` の責務、結合境界、主要I/F（API、ユースケースI/F 等）
- 参照すべき上位仕様（`br-*` / `bac-*` / `spec-*` / `nfr-*` 等）
- 依存（DB、外部 API、時刻、乱数、メッセージング等）と扱いの方針
- テストコード/CI での証跡参照先

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `test` 固定）。

```yaml
---
id: itc-<term>
type: test
title: 内部結合テストカタログ: <対象名>
status: draft # draft / ready / deprecated
part_of: []
based_on:
 - tsp-overview
 - itc-overview
supersedes: []
---
```

- `based_on` には **最低限** `tsp-overview` と `itc-overview` を含めてください。
- 対象固有の根拠（`br-*` / `bac-*` / `spec-*` / `nfr-*` 等）は、本文の **トレース表** に集約します。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 概要（`<term>`）
2. 責務（結合として保証）
3. 対象外
4. 結合境界/依存/環境前提
5. トレース
6. テスト観点とケース

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 対象固有の責務・結合境界・依存・環境前提、観点×条件＝ケース、トレース、証跡
- 書かない: `itc-overview` にある共通方針の再掲、詳細な操作の逐語列挙、データ大量列挙

### 追跡可能性（トレース）

- 本ドキュメントの **トレース表が一次情報（SSOT）** です。
- 観点/ケース表では **仕様IDを直書きせず** `TR-xx` のみ参照します。

### ケース/具体値の扱い

- ケース表の 1 行は 1 テスト（条件×期待値が一意）とします。
- 具体値や詳細手順は最小限に抑え、必要な詳細はテストコードに委譲します。

## 各セクションの書き方

### 1. 概要（`<term>`）

- 対象が何であり、どの結合単位を本カタログで扱うかを 1〜3 行で書く。
- `itc-overview` の分割基準に従い、過分割／肥大化を避ける。

### 2. 責務（結合として保証）

- 「この結合対象が何を保証すべきか」を **動詞で始まる箇条書き** で 3〜7 個程度示す。
- 例外・異常系の責務も含める。

### 3. 対象外

- 対象外は理由と代替レベル/代替手段を併記する（例: 「xxx（理由: yyy、代替: ET）」）。
- `itc-overview` の対象外と矛盾しない。

### 4. 結合境界/依存/環境前提

- 結合境界（入口/出口）を明記する。
- 結合対象（コンポーネント）を列挙する。
- 依存はカテゴリごとに列挙し、扱い（実/スタブ/モック/固定化）を決める。
- 環境前提（DB初期化、seed、タイムアウト基準、ログ取得方針等）を明記する。

### 5. トレース

- 仕様IDに対応する **トレース表** を作成する。
- 各行に `trace_key`（`TR-01` 形式）を付与し、観点/ケース表では `TR-xx` のみ参照する。

### 6. テスト観点とケース

- 観点（見出し）→ 意図 → 条件・ケース表の順で構成する。
- `case_id` は `<level>-<term>-<perspective_key>-<nnn>` を推奨し変更しない。
- `条件` は「入力/状態/環境」で表現する。
- `手順（最小）` は抽象化した最小手順に留める。
- `期待値` は判定可能に書く（観測点を含める）。

## ケース表の共通カラム（必須）

`itc-overview` の定義に従い、以下のカラムを **順序固定** で使用します。

- **必須カラム**: `case_id` / `条件` / `手順（最小）` / `期待値`
- **推奨カラム**: `観測点（アサーション）` / `境界/依存` / `トレース` / `優先度` / `自動化` / `証跡`

## 最終チェック（自己検査）

- `id: itc-<term>` / `type: test` / `status` が設定されている
- `based_on` に `tsp-overview` と `itc-overview` が入っている
- 見出しが指定順序で揃っている（欠落なし）
- トレース表が SSOT になっている（`TR-xx` 参照で統一）
- ケース表のカラムが `itc-overview` と一致している
