# 外部結合テストカタログ 概要 作成の指示テンプレート

以下のルールに従って、**外部結合テストカタログ-概要（`etc-overview`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `etc-overview` は外部結合テストの **共通ルール（SSOT）** を定義します（考え方・共通方針・共通定義）。
- 個別の観点・条件・ケースは **`etc-<term>` に集約**し、詳細は **テストコード／CI証跡** に寄せます。
- 記述は **レビュー可能**であることを優先し、長文化を避けてください（方針は箇条書き中心）。
- 「例外」や「対象外」を明示し、外部結合テストの責任境界（何をやらないか）を固定します。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `etc-overview` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象システム/プロダクトの概要
- 上位方針: `tsp-overview`
- 関連する仕様/ルール（必要に応じて）: `bac-*` / `br-*` / `nfr-*`
- 外部結合テスト対象の候補（外部境界の分割案、対象単位の切り方の案）
- 外部依存（外部サービス、外部端末、ネットワーク、認証情報等）と境界の前提
- テストコード/CI での証跡の参照先（ログ相関キー等）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `test` 固定）。

```yaml
---
id: etc-overview
type: test
title: 外部結合テストカタログ: 概要（<システム名>）
status: draft # draft / ready / deprecated
based_on:
 - tsp-overview
supersedes: []
---
```

- `based_on` には **必ず** `tsp-overview` を含めてください（追跡の起点）。
- `bac-*` / `br-*` / `nfr-*` は、共通方針の判断に **直接利用したものだけ**を列挙してください。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 本ドキュメントの目的と適用対象
2. テスト対象の括り方と分割基準
3. 対象外・除外理由（共通）
4. 観点の立て方（共通）
5. 条件の立て方（共通）
6. 外部結合テスト共通の境界/依存/環境の扱い
7. ケース表の共通カラム
8. メモ / 将来課題

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 外部結合テストの共通方針、分割基準、観点/条件の立て方、共通の境界/依存/環境の扱い、合格基準、証跡方針
- 書かない: 個別ケースの列挙、個別の詳細条件、テスト手順の逐語列挙、テストコードの構造、個別 `etc-<term>` の内容

### 追跡可能性（TSP からの派生）

- `etc-overview` は `tsp-overview` を根拠にします。
- 追跡は Frontmatter の `based_on` で担保してください。

### 代表ケース/具体値の扱い（ドキュメント最小化）

- 代表ケースの **考え方**（境界値、失敗モード、再送、例外種別など）は方針として書いてよい。
- ただし `etc-overview` では **ケースの具体的な列挙はしない**。
- 具体値・実施結果は `etc-<term>` とテストコード/CI成果物に委譲する。

## 各セクションの書き方

### 1. 本ドキュメントの目的と適用対象

- `etc-overview` の目的と適用対象を明確に書く。
- 成果物の位置づけ（`etc-overview` / `etc-<term>` / テストコード/CI）の役割を明示する。
- 本書が扱う粒度（判断基準・共通ルールまで）を明記する。

### 2. テスト対象の括り方と分割基準

- `etc-<term>` の `<term>` をどう切るかを定義する。
- 分割基準（外部I/F境界、失敗モード、合格基準、運用責任）を明記する。
- 過分割と肥大化の抑制基準を具体化する。

### 3. 対象外・除外理由（共通）

- 「対象外（やらないこと）」「除外理由」「代替レベル/代替手段」「例外（ETで扱う条件）」の形式で示す。
- 代替レベル/代替手段は **必ず** 記載する。
- 例外は乱用せず、判断基準を明記する。

### 4. 観点の立て方（共通）

- 観点の型（外部I/F契約、認証/認可、失敗モード、データ整合性、運用性、ET範囲の非機能）を示す。
- 命名規則（名詞 + 品質/振る舞い）と粒度基準を示す。
- 観点の重複を避けるルールを書く。

### 5. 条件の立て方（共通）

- 条件を「入力」「状態」「環境」に分解する前提を書く。
- 組合せを増やし過ぎないルール（代表→境界→重大例外）を示す。

### 6. 外部結合テスト共通の境界/依存/環境の扱い

- 外部サービス接続（sandbox/スタブ/モックの使い分け）を共通方針として記載する。
- 認証情報/秘密情報の取り扱いを明記する。
- タイムアウト/リトライ境界、冪等性/再送、環境分離、証跡の扱いを明記する。

### 7. ケース表の共通カラム

- `etc-<term>` における共通カラムを **具体的に** 明記する。
- 必須カラムと推奨カラムを区別し、表の1行=1テストの原則を明記する。
- **必須カラム**（順序固定）:
  - `case_id`（対象別に一意。`<level>-<term>-<perspective_key>-<nnn>` を推奨、`nnn` は 3 桁）
  - `条件`（入力/状態/環境の要点。`入力:` `状態:` `環境:` の形を推奨）
  - `手順（最小）`（クリック列挙は禁止。抽象化した最小手順）
  - `期待値`（判定可能な合格条件。観測点を含める）
- **推奨カラム**（運用必須）:
  - `観測点（アサーション）`
  - `境界/依存`（sandbox/スタブ、タイムアウト設定、リトライ設定等）
  - `トレース`（req/spec/ac/issue 等のID）
  - `優先度`（P0/P1/P2）
  - `自動化`（manual/automated/mixed）
  - `証跡`（テストコード/CI/外部リクエストID/ログ検索キー等）

### 8. メモ / 将来課題

- 未確定事項や将来の改善点を箇条書きで記載する。
- 運用上必須になったら本文へ昇格させる方針を明記してよい。

## 最終チェック（自己検査）

- `id: etc-overview` / `type: test` / `status` が設定されている
- `based_on` に `tsp-overview` が入っている
- 見出しが指定順序で揃っている（欠落なし）
- 個別ケースの列挙がない（`etc-<term>` に委譲できている）
- 対象外・除外理由に代替レベル/手段が書けている
