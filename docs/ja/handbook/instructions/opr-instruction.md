# 運用手順 作成の指示テンプレート

以下のルールに従って、**運用手順（`opr-index` / `opr-<term>`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `opr-index` は恒常運用の実行手順と証跡ルールの入口（全体SSOT）です。
- `opr-<term>` は必要時のみ作成し、term固有の内容に限定してください。
- 誰が実施しても同じ結果になる再現可能な手順として整理し、属人化を防止してください。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `opr-index` または `opr-<term>` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象運用ドメイン（全体/term）と手順の目的
- 適用範囲（対象環境、適用外、実施時間帯、必要権限）
- 日次/週次/月次の点検項目、実施者、完了条件
- 障害対応優先度（P1/P2/P3等）、初動SLA、エスカレーション基準
- アラート対応フロー（確認/暫定対応/恒久対応）と誤検知時の扱い
- バックアップ確認/リストア手順、演習頻度、RTO/RPO（ある場合）
- バッチ再実行条件、再実行上限、冪等性方針
- 変更作業（設定変更/デプロイ/ロールバック）の承認・実施条件
- アカウント付与/剥奪手順、棚卸し/緊急権限運用
- 問い合わせ一次対応テンプレ、引き継ぎ条件、ナレッジ参照先
- 証跡要件（保存先、保管期間、参照権限、識別子）
- 関連ドキュメント（`opd-*` / `mip-*` / `otp-*` / `cop-*` など）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `operations` 固定）。

#### `opr-index` を作る場合

```yaml
---
id: opr-index
type: operations
title: 運用手順: 全体
status: draft # draft / ready / deprecated
based_on: []
supersedes: []
---
```

#### `opr-<term>` を作る場合

```yaml
---
id: opr-<term>
type: operations
title: 運用手順: <対象名>
status: draft # draft / ready / deprecated
based_on: []
supersedes: []
---
```

- `based_on` には手順判断に直接利用した成果物のみを列挙してください（例: `opd-*` / `nfr-*` / `issue-*`）。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 概要（`index` / `<term>`）
2. 手順適用範囲・前提
3. 日次/週次/月次点検手順
4. 障害対応手順（P1/P2…、切り分け、一次対応、復旧）
5. アラート対応手順（確認→暫定対応→恒久対応）
6. バックアップ確認・リストア手順（演習含む）
7. バッチ再実行・失敗時対応
8. 運用変更作業（設定変更・デプロイ・ロールバック）
9. アカウント付与/剥奪手順
10. 問い合わせ一次対応手順（テンプレ・ナレッジ）
11. 証跡（ログ、チケット、チェックリスト、実施記録）
12. 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携）

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 再現可能な実行手順、優先度別対応、承認・判断条件、証跡要件
- 書かない: 方針文書（OPD）の内容の再定義、長大なコマンド列・設定全文（必要なら別紙/リンク化）

### SSOTと分冊ルール

- `opr-index` は共通手順規約（証跡、承認、優先度定義、エスカレーション基準、テンプレ）の正とする。
- `opr-<term>` は term固有の差分に寄せ、共通規約を重複記載しない。
- `opr-<term>` の全体運用判断は `opr-index` に従う。

### 手順の再現可能性

- 曖昧表現（例: 「適宜」「必要に応じて」「問題ない」）は禁止し、実施者が判定できる条件で記述する。
- 優先度別手順（P1/P2等）、承認者、ロールバック条件、証跡を必ず明記する。

## 各セクションの書き方

### 1. 概要（`index` / `<term>`）

- 手順の対象と目的を 1〜3 行で示す。
- `opr-index` が実行手順のSSOTであることを明記する。
- `opr-<term>` では `opr-index` の差分・具体化であることを明記する。

### 2. 手順適用範囲・前提

- 適用対象、適用外、実施可能時間帯、必要権限を明記する。
- 前提（環境、ツール、連絡経路、参照先）を明記する。

推奨フォーマット（表）:

| 項目 | 内容 |
| ---- | ---- |
| 対象 | （例：本番環境、staging） |
| 時間帯 | （例：平日9-18、夜間可否） |
| 必要権限 | （例：SRE権限、DB read-only 等） |
| 使用ツール | （例：監視SaaS、チケット、CLI） |
| 連絡先 | （例：#ops、#dev、電話） |

### 3. 日次/週次/月次点検手順

- 頻度別に手順、実施者、完了条件、証跡を定義する。
- 実施漏れの検知方法とエスカレーションを必要に応じて明記する。

推奨フォーマット（表）:

| 頻度 | 手順 | 実施者 | 完了条件 | 証跡 |
| ---- | ---- | ------ | -------- | ---- |

### 4. 障害対応手順（P1/P2…、切り分け、一次対応、復旧）

- 優先度別に切り分け、一次対応、復旧手順を明記する。
- エスカレーション条件と判断者を明記する。
- 停止判断・ロールバックが関わる場合は、判断条件と承認者を必ず明記する。

推奨フォーマット（表）:

| 優先度 | 初動SLA | 切り分け | 一次対応 | 復旧 | エスカレーション |
| ------ | ------- | -------- | -------- | ---- | ---------------- |

### 5. アラート対応手順（確認→暫定対応→恒久対応）

- 検知後の確認、暫定対応、恒久対応の流れを明記する。
- 誤検知時の扱い（クローズ条件、閾値調整、抑止）を明記する。

推奨フォーマット（表）:

| 段階 | 手順 | 完了条件 | 証跡 |
| ---- | ---- | -------- | ---- |

### 6. バックアップ確認・リストア手順（演習含む）

- バックアップ確認項目、リストア手順、演習頻度を明記する。
- 演習結果の証跡（ログ/レポート/所要時間）を必須化する。
- RTO/RPO がある場合は、達成可否の判定方法を明記する（方針はOPD、実施はOPR）。

### 7. バッチ再実行・失敗時対応

- 失敗検知、再実行条件、再実行上限、エスカレーションを明記する。
- 再実行でデータ重複が起きうる場合は、冪等性/防止策（run_id 等）を明記する。

### 8. 運用変更作業（設定変更・デプロイ・ロールバック）

- 変更種別、承認者、実施条件（時間帯/凍結）、ロールバック条件を明記する。
- 変更の証跡（チケット、差分、承認ログ、実施ログ）を必須化する。
- 重大変更は事前周知の要否と手段を明記する。

### 9. アカウント付与/剥奪手順

- 申請→承認→実施→検証→記録の流れを明記する。
- 棚卸し（定期）と緊急権限（ブレークグラス）がある場合は、実施手順と証跡を明記する。

### 10. 問い合わせ一次対応手順（テンプレ・ナレッジ）

- 問い合わせ分類、一次対応テンプレ、ナレッジ参照先を明記する。
- 引き継ぎ条件（開発/業務/運用）を明記する。

### 11. 証跡（ログ、チケット、チェックリスト、実施記録）

- 必須証跡、保存先、保管期間、参照権限を明記する。
- 証跡は「どのURL/どのID/どのrun_id」が分かる粒度で残す。

推奨フォーマット（表）:

| 証跡種別 | 保存先 | 保管期間 | 参照権限 | 最低限残す識別子 |
| -------- | ------ | -------- | -------- | ---------------- |
| チケット | （例：Jira） | （例：2年） | （例：Ops/Dev） | ticket_id |
| 実施ログ | （例：ログ基盤） | （例：90日） | （例：Ops） | run_id, job_id |
| チェックリスト | （例：Docs） | （例：1年） | （例：Ops） | 実施日, 実施者 |

### 12. 関連ドキュメント導線（`opd` 参照、`mip` / `otp` / `cop` 連携）

- `opd-index` への導線を必ず記載する。
- `mip-*` / `otp-*` / `cop-*` は必要時のみ連携情報として記載する。
- 分冊がない場合でも `（本書のみ）` または `（なし）` を明記する。

推奨フォーマット（表）:

| 種別 | ドキュメントID | 目的 | 備考 |
| ---- | -------------- | ---- | ---- |

## 最終チェック（自己検査）

- `id` が `opr-index` または `opr-<term>` である
- `type: operations` / `status` が設定されている
- 見出しが指定順序で揃っている（欠落なし）
- 優先度別障害対応（P1/P2等）と初動SLAが明記されている
- アラート対応、バックアップ/リストア、バッチ再実行、運用変更、権限管理、問い合わせ対応が定義されている
- 証跡要件（保存先/保管期間/参照権限/識別子）が明記されている
- `関連ドキュメント導線` が空欄でない（`（なし）` / `（本書のみ）` でも可）
- `opr-<term>` の場合、`opr-index` への参照関係が明記されている
