# 単体テスト仕様 全体構成 作成の指示テンプレート

以下のルールに従って、**単体テスト仕様（全体構成）（`uts-index`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `uts-index` は、単体テストの責務（対象・境界・共通合格基準）と、TPC の観点・条件を `uts-<term>` に分配する **入口（ナビゲーション）** です。
- `uts-index` は **方針・基準・分配**までを扱い、個別の詳細条件やテストケースの列挙は扱いません（個別は `uts-<term>`、詳細なケース/具体値/実行結果はテストコードおよび CI アーティファクトへ）。
- エビデンスは TSP の品質ゲートと整合させ、`uts-index` では **単体テストのエビデンス参照先（CI 成果物）** を定義します。
- 自動化方針（どこまで自動化し、結果をどこで確認するか）を定義します。
- 関係の表現は **`part_of` と `based_on` のみ**を使います（他の関係タイプを増やしません）。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `uts-index` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象システム/プロダクトの概要
- 上位方針: `tsp-overview`
- テスト観点・条件: 関連する `tpc-*`（観点/条件、適用テストレベル、トレース）
- 関連する仕様/ルール（必要に応じて）: `bac-*` / `br-*` / `nfr-*`
- 単体テスト対象の候補（論理対象のリストや責務の分割案）
- 外部依存（DB、外部 API、時刻、乱数、ファイル等）と、単体の境界の前提
- CI/テスト実行の入口（コマンド、レポートの保存場所等）が分かる情報（不明なら「未確定」）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `test` 固定）。

```yaml
---
id: uts-index
type: test
title: 単体テスト仕様: 全体構成（<システム名>）
status: draft # draft / ready / deprecated
part_of: []
based_on:
  - tsp-overview
  - tpc-<...>
supersedes: []
---
```

- `based_on` には **必ず** 関連する `tpc-*` を含めてください（追跡の起点）。
- `bac-*` / `br-*` / `nfr-*` は、単体テストの境界・分配・共通合格基準の判断に **直接利用したものだけ**を列挙してください。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 概要
2. 対象単位の定義
3. 単体テストの対象範囲と境界（モック/スタブ方針）
4. 分配方針（TPC → `uts-<term>`）
5. 対象単位一覧（統合表）
6. 合格基準とエビデンス（共通）
7. 対象外・除外理由
8. メモ / 将来課題

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 単体テストの責務、境界、分配ルール、共通合格基準、共通エビデンスの参照方法、自動化方針
- 書かない: テストケース（手順/入力/期待結果）の逐語列挙、具体値の総当たり、テスト実行結果の貼り付け、テストコードのクラス/メソッド構造、TPC の観点・条件表の再掲

### 追跡可能性（TPC からの派生）

- `uts-index` は、TPC の観点・条件を `uts-<term>` に分配できる必要があります。
- 追跡は次で担保してください。
  - Frontmatter の `based_on`（必須: `tsp-overview` と関連 `tpc-*`）
  - 統合表の「担当するTPC（例）」列（どの観点範囲をどの `uts-<term>` が受け持つか）

### 代表ケース/具体値の扱い（ドキュメント最小化）

- 代表ケースの考え方（境界値、同値分割、状態遷移の分岐、例外種別など）は **方針として**書いてよい。
- ただし、`uts-index` では **ケース表の作成・網羅列挙はしない**。
- 代表ケースの具体的な列挙や具体値、実施結果は、テストコードと CI のレポート/アーティファクトで管理する。

## 各セクションの書き方

### 1. 概要

- 1〜4 文で「単体テストで何をどこまで保証するか」と「TPC を `uts-<term>` に分配する入口である」ことを書いてください。

### 2. 対象単位の定義

- `uts-<term>` の粒度（1ドキュメント=1論理対象）と、分割/統合の判断基準（責務・状態・境界）を書いてください。
- 実装構造（クラス/モジュール名）への直接依存は避けてください。

### 3. 単体テストの対象範囲と境界（モック/スタブ方針）

- 単体として担保する範囲と、結合以降へ委譲する範囲を明確にしてください。
- 外部依存（DB、外部 API、時刻、乱数、ファイル等）の扱いを **方針として**書いてください。
- 再現性のため、時刻/乱数/UUID 等の非決定要因の固定方針（注入・固定化）を含めてください。
- 自動化方針（例: 単体は原則自動実行し、CI で継続実行する。結果はテストレポートとして参照できる）を明記してください。

### 4. 分配方針（TPC → `uts-<term>`）

- `uts-<term>` ごとに担当する TPC（または観点IDの範囲）が追跡できる方針を示してください。
- 抜け/重複を防ぐ取り扱い（例外系、境界条件、依存失敗の扱い）を方針として明確にしてください。
- 分配理由（責務/境界/関心分離）は必須ではありません（必要な場合のみ補足）。
- ここでも、ケース一覧や具体値は書きません。

### 5. 対象単位一覧（統合表）

- `uts-<term>`、対象の要約、担当する TPC、境界（単体で切るもの）を **1 表**に集約してください（SSOT）。
- この表は運用上の更新漏れ防止のための **単一ソース**です。本文に同種の一覧を重複させないでください。

### 6. 合格基準とエビデンス（共通）

- 合格基準（例: 失敗 0 件、重大不具合 0 件など）を判定可能な形で定義してください。
- エビデンスは、TSP の品質ゲートと整合する形で、テストコードの実行結果（CI のレポート、ログ、カバレッジ等）を **参照できる形**で示してください。
- 実行の入口（例: `npm test` 等）は、コマンドそのものの羅列ではなく「どこを見れば分かるか」も含め、最小限で書いてください（不明なら未確定）。

### 7. 対象外・除外理由

- 単体で担保しない事項を列挙し、どのレベル（内部結合/外部結合/総合/非機能等）で担保するかを明記してください。

### 8. メモ / 将来課題

- 未確定事項や今後の見直しポイントを箇条書きで記載してください。
- 合否に影響する内容はここに置かず、本文に反映してください。

## 最終チェック（自己検査）

- `id: uts-index` / `type: test` / `status` が設定されている
- `based_on` に `tsp-overview` と関連 `tpc-*` が入っている
- 見出しが指定順序で揃っている（欠落なし）
- 統合表（対象単位一覧）が SSOT になっている（重複管理していない）
- 自動化方針とエビデンス参照先（CI 成果物）が書けている
- ケース/具体値/手順の大量列挙がない
- TPC の観点・条件表の再掲がない（ID/範囲の参照に留める）
- 関係タイプは `part_of` / `based_on` のみ（他を増やしていない）
