# カットオーバー計画 作成の指示テンプレート

以下のルールに従って、**カットオーバー計画（`cop-index` / `cop-<term>`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `cop-index` は本番切替手順の入口（全体SSOT）です。
- `cop-<term>` は必要時のみ作成し、term固有の手順・判定・責務に限定してください。
- 当日の切替を分単位で実行可能にし、責任分界とロールバック方針を明確にしてください。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `cop-index` または `cop-<term>` を生成してください（不明な場合は「未確定」として明記してよい）。

- 切替対象範囲（全体/term）と目的
- 当日タイムライン（相対時刻、イベント、完了条件、判定点）
- 作業手順チェックリスト（実施者、証跡）
- 担当者/連絡系統（エスカレーション含む）
- 実施条件（事前完了条件）
- 切替判定ポイント（GO/NO-GO）
- ロールバック発動条件と復旧方針
- 障害時判断・エスカレーション基準
- 周知計画（ユーザ通知/停止告知、手段、タイミング、証跡）
- 関連ドキュメント（`mip-index` / `mtp-index` / `dmd-*` / `otp-*` / `cop-*`）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `migration` 固定）。

#### `cop-index` を作る場合

```yaml
---
id: cop-index
type: migration
title: カットオーバー計画: 全体
status: draft # draft / ready / deprecated
based_on: []
supersedes: []
---
```

#### `cop-<term>` を作る場合

```yaml
---
id: cop-<term>
type: migration
title: カットオーバー計画: <対象名>
status: draft # draft / ready / deprecated
based_on: []
supersedes: []
---
```

- `based_on` には切替判断に直接利用した成果物のみを列挙してください（例: `mip-index` / `mtp-index` / `dmd-*` / `issue-*`）。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 概要（`index` / `<term>`）
2. 当日タイムライン
3. 作業手順チェックリスト
4. 担当者/連絡系統
5. 実施条件（事前完了条件）
6. 切替判定ポイント（GO/NO-GO）
7. ロールバック手順
8. 障害時判断・エスカレーション
9. 周知（ユーザ通知/停止告知）
10. 関連ドキュメント

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 当日実行・判断に必要な最小情報（分単位タイムライン、判定点、ロールバック、責務、連絡系統、周知、証跡）
- 書かない: 実装コード、長大SQL、下位設計書に置くべき詳細（必要なら参照リンク）

### SSOTと分冊ルール

- `cop-index` は全体前提・共通ルール・GO/NO-GO枠組みの正とする。
- `cop-<term>` は term固有の手順/判定/責務に寄せ、共通方針を重複記載しない。
- `cop-<term>` の判断体系は `cop-index` に従う。

### 実行可能性と判定可能性

- 曖昧表現（例: 「適宜」「問題なければ」）は禁止し、実行条件と判定条件を明確にする。
- 失敗時の扱いは **ロールバック / 延期（Go-Live中止）/ 代替手順** のいずれかを必ず明記する。
- `mip-index` の成功条件・GO/NO-GO最低条件と矛盾させない。

## 各セクションの書き方

### 1. 概要（`index` / `<term>`）

- 当日の切替対象と目的を 1〜3 行で示す。
- `mip-index` のカットオーバー概要（骨格/判定点/ロールバック方針）と整合させる。
- `cop-<term>` では対象範囲（含む/含まない）と責務境界を明記する。

### 2. 当日タイムライン

- 分単位の時刻で時系列に記載する（相対時刻を推奨）。
- 完了条件と判定点（GO1/GO2...）を明記する。
- `cop-index` は主要マイルストーン中心、`cop-<term>` は実作業に必要な粒度で記載する。

推奨フォーマット（表）:

| 時刻（相対） | イベント | 完了条件 | 判定点 |
| ------------ | -------- | -------- | ------ |

### 3. 作業手順チェックリスト

- 作業を順序付きで列挙する。
- 実施者と証跡（ログ/チケット/チェック欄）を明記する。
- 必要なら備考に実行コマンド/手順書リンクを記載する（本文に長大なコマンド列は貼らない）。

推奨フォーマット（表）:

| 手順 | 作業内容 | 実施者 | 証跡 | 備考 |
| ---- | -------- | ------ | ---- | ---- |

### 4. 担当者/連絡系統

- 担当者、責務、連絡経路、エスカレーション先を明記する。
- 個人名が出せない場合は、ロール名＋窓口（チャネル/電話/当番表）で表現する。

推奨フォーマット（表）:

| 役割 | 担当 | 連絡先 | 備考 |
| ---- | ---- | ------ | ---- |

### 5. 実施条件（事前完了条件）

- 実施前に完了しているべき条件を列挙する（例: リハーサル合格、バックアップ完了、監視準備完了）。
- 未達時の扱い（延期/代替手順/判断者）を明記する。

### 6. 切替判定ポイント（GO/NO-GO）

- 判定点、判断基準、判断者を列挙する。
- 失敗時の扱い（ロールバック/延期/代替手順）を判定点ごとに明記する。

推奨フォーマット（表）:

| 判定点 | 条件 | 判断者 | 失敗時の扱い（ロールバック/延期/代替手順） |
| ------ | ---- | ------ | ------------------------------------------ |

### 7. ロールバック手順

- 発動条件（どの判定点で何が起きたら）を明記する。
- 復旧方針（旧系復帰/接続戻し/投入データ無効化等）を明記する。
- 実行可能な粒度（責務・証跡・完了条件）で記述する。

### 8. 障害時判断・エスカレーション

- 障害時の判断フローと連絡経路を明記する。
- エスカレーション先と判断基準（重大度、SLO逸脱、復旧見込み等）を明記する。

### 9. 周知（ユーザ通知/停止告知）

- 通知対象、通知手段、通知タイミングを明記する。
- 周知内容に停止時間、影響範囲、問い合わせ先を含める。
- 証跡（配信ログ/掲載URL/チケット）を明記する。

### 10. 関連ドキュメント

- `cop-index` の場合: 各 `cop-<term>` への導線を必ず記載する。
- `cop-<term>` の場合: `cop-index` への導線を必ず記載する。
- 分冊が無い場合でも `（本書のみ）` を明記し、空欄にしない。

推奨フォーマット（箇条書き）:

- `<doc-id>`：<説明>
- `<doc-id>`：<説明>

## 最終チェック（自己検査）

- `id` が `cop-index` または `cop-<term>` である
- `type: migration` / `status` が設定されている
- 見出しが指定順序で揃っている（欠落なし）
- 当日タイムラインが分単位で記載され、完了条件と判定点がある
- 切替判定ポイントに判断者と失敗時の扱いがある
- ロールバックに発動条件・復旧方針・完了条件がある
- 担当者/連絡系統と障害時エスカレーションがある
- 周知に通知対象・手段・タイミング・証跡がある
- `関連ドキュメント` が空欄でない（`（本書のみ）` でも可）
- `cop-<term>` の場合、`cop-index` への導線が記載されている
