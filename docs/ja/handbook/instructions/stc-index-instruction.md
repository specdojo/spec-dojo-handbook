# 総合テストカタログ 概要 作成の指示テンプレート

以下のルールに従って、**総合テストカタログ-概要（`stc-index`）** を 1 ファイル作成してください。出力は **Markdown** とします。

- `stc-index` は総合テストの **共通ルール（SSOT）** を定義します（考え方・共通方針・共通定義）。
- 個別の観点・条件・ケースは **`stc-<term>` に集約**し、詳細は **テストコード／CI／レポート等の証跡** に寄せます。
- 記述は **レビュー可能**であることを優先し、長文化を避けてください（方針は箇条書き中心）。
- 「例外」や「対象外」を明示し、総合テストの責任境界（何をやらないか）を固定します。

## 事前に与えられる情報（入力）

次の情報が与えられている前提で、それに整合する `stc-index` を生成してください（不明な場合は「未確定」として明記してよい）。

- 対象システム/プロダクトの概要
- 上位方針: `tsp-index`
- 関連する仕様/ルール（必要に応じて）: `bac-*` / `br-*` / `nfr-*`
- 総合テスト対象の候補（業務/シナリオの分割案、対象単位の切り方の案）
- 環境前提（staging相当の前提、外部I/Fのsandbox/スタブ方針）
- テストコード/CI/レポート での証跡の参照先（ログ相関キー等）

## 出力フォーマット（必須）

### YAML Frontmatter（必須）

先頭に YAML Frontmatter を付与し、以下の形式で記述してください（`id` / `type` / `title` / `status` は必須、`type` は `test` 固定）。

```yaml
---
id: stc-index
type: test
title: 総合テストカタログ: 概要（<システム名>）
status: draft # draft / ready / deprecated
based_on:
 - tsp-index
supersedes: []
---
```

- `based_on` には **必ず** `tsp-index` を含めてください（追跡の起点）。
- `bac-*` / `br-*` / `nfr-*` は、共通方針の判断に **直接利用したものだけ**を列挙してください。

### 本文の見出し（必須・順序固定）

本文は次の見出し（日本語）をこの順序で必ず含めてください。

1. 本ドキュメントの目的と適用対象
2. テスト対象の括り方と分割基準
3. 対象外・除外理由（共通）
4. 観点の立て方（共通）
5. 条件の立て方（共通）
6. 観点/条件の採用基準と対象別への分配方針（共通）
7. 総合テスト共通の境界/環境の扱い
8. ケース表の共通カラム
9. メモ / 将来課題

## 記述ルール（重要）

### スコープ（書く / 書かない）

- 書く: 総合テストの共通方針、対象分割、観点/条件の立て方、環境/外部依存の扱い、合格基準、証跡方針
- 書かない: 個別ケースの列挙、詳細な操作列挙、テストコードの構造、個別 `stc-<term>` の内容

### 追跡可能性（TSP からの派生）

- `stc-index` は `tsp-index` を根拠にします。
- 追跡は Frontmatter の `based_on` で担保してください。

### 代表ケース/具体値の扱い（ドキュメント最小化）

- 代表シナリオの **考え方**（主要分岐、例外/リカバリ、重大失敗）を方針として書いてよい。
- ただし `stc-index` では **ケースの具体的な列挙はしない**。
- 具体値・実施結果は `stc-<term>` とテストコード/CI/レポートに委譲する。

## 各セクションの書き方

### 1. 本ドキュメントの目的と適用対象

- `stc-index` の目的と適用対象を明確に書く。
- 成果物の位置づけ（`stc-index` / `stc-<term>` / テストコード/CI/レポート）の役割を明示する。
- 本書が扱う粒度（判断基準・共通ルールまで）を明記する。

### 2. テスト対象の括り方と分割基準

- `stc-<term>` の `<term>` をどう切るかを定義する。
- 分割基準（業務/価値境界、境界横断、データ境界、運用境界）を明記する。
- 過分割と肥大化の抑制基準を具体化する。

### 3. 対象外・除外理由（共通）

- 「対象外」「除外理由」「代替レベル/代替手段」「例外（STで扱う条件）」の形式で示す。
- 代替レベル/代替手段は **必ず** 記載する。
- 例外は乱用せず、判断基準を明記する。

### 4. 観点の立て方（共通）

- 観点の型（業務フロー成立、例外/リカバリ、データ整合性、監視/運用観測、ST範囲の非機能）を示す。
- 命名規則（名詞 + 品質/振る舞い）と粒度基準を示す。
- 観点の重複を避けるルールを書く。

### 5. 条件の立て方（共通）

- 条件を「入力」「状態」「環境」「経路」に分解する前提を書く。
- 組合せを増やし過ぎないルール（代表→重要分岐→重大例外）を示す。

### 6. 観点/条件の採用基準と対象別への分配方針（共通）

- 採用基準は「業務影響」「運用影響」「シナリオ頻度」「障害再発傾向」で定義する。
- `stc-index` には共通ルール（採否・優先度・分配境界）を記載し、対象別の具体化は `stc-<term>` に委譲する。
- 観点→条件→ケースの追跡を維持するため、ID付番・根拠リンク・証跡紐づけの最小ルールを定義する。

### 7. 総合テスト共通の境界/環境の扱い

- 環境（staging相当）の固定ルール、データ初期化・後始末方針を明記する。
- 外部依存はSTで無理に網羅せず、sandbox/スタブで代表ケースを再現する方針を書く。
- UI操作は高位の行動記述に留める方針と、証跡の標準（ログ相関ID等）を明記する。
- 合格基準（P0必須、P1/P2の扱い）を共通ルールとして示す。

### 8. ケース表の共通カラム

- `stc-<term>` における共通カラムを **具体的に** 明記する。
- 必須カラムと推奨カラムを区別し、表の1行=1テストの原則を明記する。
- **必須カラム**（順序固定）:
  - `case_id`（対象別に一意。`<level>-<term>-<perspective_key>-<nnn>` を推奨、`level` は `st`）
  - `条件`（`入力:` `状態:` `環境:` `経路:` の要点。必要なものだけ記載）
  - `手順（最小）`（高位の最小手順。クリック列挙禁止）
  - `期待値`（判定可能な合格条件。観測点を含める）
- **推奨カラム**（運用必須）:
  - `観測点（アサーション）`
  - `環境/依存`（sandbox/スタブ、設定、データnamespace 等）
  - `トレース`（req/spec/ac/issue 等のID）
  - `優先度`（P0/P1/P2）
  - `自動化`（manual/automated/mixed）
  - `証跡`（CI/レポート/スクショ/動画/ログ相関キー等）

### 9. メモ / 将来課題

- 未確定事項や将来の改善点を箇条書きで記載する。
- 運用上必須になったら本文へ昇格させる方針を明記してよい。

## 最終チェック（自己検査）

- `id: stc-index` / `type: test` / `status` が設定されている
- `based_on` に `tsp-index` が入っている
- 見出しが指定順序で揃っている（欠落なし）
- 個別ケースの列挙がない（`stc-<term>` に委譲できている）
- 対象外・除外理由に代替レベル/手段が書けている
