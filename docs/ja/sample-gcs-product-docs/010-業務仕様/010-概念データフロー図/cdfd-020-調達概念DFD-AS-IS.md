# 調達概念データフロー（現状）

凡例と記号の意味は[cdfd-mermaid-rules.md](../../../handbook/rules/cdfd-mermaid-rules.md)を参照してください。

## 調達プロセス概要

| プロセス | 業務内容                                                                         | 担当 | 業務が発生するイベント   | インプット                 | アウトプット                                               |
| -------- | -------------------------------------------------------------------------------- | ---- | ------------------------ | -------------------------- | ---------------------------------------------------------- |
| 発注     | 問屋・メーカーに商品を注文する。必要数量・品目を決定。                           | 店主 | 在庫が足りなくなった     | 在庫商品数量、販売商品数量 | 発注書                                                     |
| 受入     | 納品物を受け取る。                                                               | 店主 | 商品が納入された         | 納入商品、納品書           | 受入情報                                                   |
| 検品     | 数量・品質・価格を確認し、問題がなければ在庫へ回す。不良があれば返品処理を行う。 | 店主 | 商品を受け取った         | 納入商品、納品書           | 検品済み商品、検品済み商品情報、不良時は返品商品・返品伝票 |
| 返品処理 | 不良品・数量違いの商品を仕入先に返送する。                                       | 店主 | 不良・数量違いを発見した | 検品結果                   | 返品商品、返品伝票                                         |
| 在庫保管 | 商品をバックヤードに保管し、賞味期限・残数を管理。                               | 店主 | 検品が完了した           | 検品済み商品               | 在庫商品                                                   |

## 発注、受入、検品、在庫保管

```mermaid
flowchart LR

  %% プロセス
  発注("発注<br>（担当: 店主）")
  受入("受入<br>（担当: 店主）")
  検品("検品<br>（担当: 店主）")
  在庫保管("在庫保管<br>（担当: 店主）")
  %% イベント
  在庫不足{{"在庫が足りなくなった"}}
  商品納入{{"商品が納入された"}}
  商品受取{{"商品を受け取った"}}
  検品完了{{"検品が完了した"}}

  %% 外部主体
  仕入先[仕入先]

  %% データストア
  商品一覧表[(商品一覧表)]
  仕入台帳[(仕入台帳)]
  在庫台帳[(在庫台帳)]

  %% 物理保管
  バックヤード([バックヤード])

  %% 発注
  在庫不足 --> 発注
  在庫台帳 -->|在庫数量| 発注
  商品一覧表 -->|商品情報| 発注
  発注 -->|発注情報| 仕入台帳
  発注 -->|発注書| 仕入先

  %% 受入
  仕入先-->商品納入 --> 受入
  仕入先 ==>|納入商品| 受入
  仕入先 -->|納品書| 受入
  受入 -->|受入情報| 仕入台帳

  %% 検品
  受入 --> 商品受取 --> 検品
  受入 ==>|納入商品| 検品
  受入 -->|納品書| 検品
  検品 -->|"入庫数量、仕入金額確定"| 仕入台帳
  検品 -->|入庫数量| 在庫台帳

  %% 在庫保管
  検品 --> 検品完了 --> 在庫保管
  検品 ==>|検品済み商品| 在庫保管
  在庫保管 -->|在庫数量| 在庫台帳
  在庫保管 ==>|在庫商品| バックヤード
```

## 返品

```mermaid
flowchart LR

  %% プロセス
  検品("検品<br>（担当: 店主）")
  返品処理("返品処理<br>（担当: 店主）")

  %% イベント
  不良発覚{{"不良・数量違いを発見した"}}

  %% 外部主体
  仕入先[仕入先]

  %% データストア
  仕入台帳[(仕入台帳)]
  在庫台帳[(在庫台帳)]

  %% 検品 → 不良発覚
  検品 --> 不良発覚 --> 返品処理
  検品 ==>|納入商品| 返品処理

  %% 返品処理（仕入先へ返送）
  返品処理 -->|返品伝票| 仕入先
  返品処理 ==>|返品商品| 仕入先

  %% 在庫台帳の反映（仕入れ取消）
  返品処理 -->|仕入れ取り消し| 仕入台帳
  返品処理 -->|入庫取消| 在庫台帳
```
