$schema: 'http://json-schema.org/draft-07/schema#'
title: External System Interface List Schema
type: object
additionalProperties: false

required:
  - id
  - type
  - title
  - status
  - interfaces

definitions:
  idRef:
    type: string
    pattern: '^[a-z0-9][a-z0-9-]*$'
    description: '英小文字・数字・ハイフンのみ。先頭は英小文字または数字。'
  idRefArray:
    type: array
    items:
      $ref: '#/definitions/idRef'
    uniqueItems: true
  semver:
    type: string
    # SemVer 2.0.0（prerelease / build metadata も許容）
    pattern: "^\\d+\\.\\d+\\.\\d+(?:-[0-9A-Za-z-.]+)?(?:\\+[0-9A-Za-z-.]+)?$"

properties:
  id:
    type: string
    pattern: '^esil-[a-z0-9-]+$'
    description: '一意なID（esil-...）'
  type:
    type: string
    const: 'api'
  title:
    type: string
    minLength: 1
  status:
    type: string
    enum: ['draft', 'ready', 'deprecated']
  version:
    $ref: '#/definitions/semver'
  owners:
    type: array
    items:
      type: string
      format: email
    uniqueItems: true

  tags:
    type: array
    items:
      type: string
      minLength: 1
    uniqueItems: true

  depends_on:
    $ref: '#/definitions/idRefArray'
    default: []
  implements:
    $ref: '#/definitions/idRefArray'
    default: []
  tests:
    $ref: '#/definitions/idRefArray'
    default: []
  supersedes:
    $ref: '#/definitions/idRefArray'
    default: []

  interfaces:
    type: array
    default: []
    minItems: 1
    items:
      type: object
      additionalProperties: false
      required:
        - name
        - source
        - target
        - direction
        - kind
        - format
        - timing
      properties:
        name:
          type: string
          minLength: 1
          description: '連携名'
        source:
          type: string
          minLength: 1
          description: '連携元（システム/コンテナ/コンポーネントなど）'
        target:
          type: string
          minLength: 1
          description: '連携先（外部システム名など）'
        direction:
          type: string
          enum:
            - source_to_target
            - target_to_source
            - bidirectional
          description: '方向（source/targetに基づく）'
        kind:
          type: string
          enum:
            - API
            - ファイル
            - メッセージ
          description: '連携の種別'
        format:
          type: string
          enum:
            - CSV
            - JSON
            - XML
            - その他
            - TBD
          description: 'データ形式（限定列挙）'
        timing:
          type: string
          minLength: 1
          description: '連携タイミング'
        error_handling:
          type: string
          description: 'エラー処理・備考'
        spec_ref:
          type: string
          pattern: '^(?:eapis|efes|ems)-[a-z0-9-]+$|^TBD$'
          description: '詳細仕様ドキュメントのid（eapis-/efes-/ems-...）または TBD'
